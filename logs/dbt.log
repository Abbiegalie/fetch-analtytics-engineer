[0m09:04:05.042667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b4700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106253f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106253be0>]}


============================== 09:04:05.045676 | bb69b13f-6acc-4e24-a2c8-1037920b9bf3 ==============================
[0m09:04:05.045676 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:04:05.046127 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'debug': 'False', 'log_path': 'logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt init my_dbt_project', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:04:05.055038 [error] [MainThread]: Encountered an error:
'NoneType' object is not subscriptable
[0m09:04:05.064262 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/cli/main.py", line 477, in init
    results = task.run()
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/task/init.py", line 319, in run
    profile_name = self.get_profile_name_from_current_project()
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/task/init.py", line 140, in get_profile_name_from_current_project
    return dbt_project["profile"]
TypeError: 'NoneType' object is not subscriptable

[0m09:04:05.092218 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": false, "command_wall_clock_time": 0.09744554, "process_in_blocks": "0", "process_kernel_time": 0.128132, "process_mem_max_rss": "89948160", "process_out_blocks": "0", "process_user_time": 0.832709}
[0m09:04:05.092664 [debug] [MainThread]: Command `dbt init` failed at 09:04:05.092580 after 0.10 seconds
[0m09:04:05.092951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b4700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062ba6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061ec340>]}
[0m09:04:05.093236 [debug] [MainThread]: Flushing usage events
[0m09:04:05.419221 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:06:46.989347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075a23a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108434ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108434be0>]}


============================== 09:06:46.992544 | 5fe95ab2-385e-4841-a2e5-040c01323ccb ==============================
[0m09:06:46.992544 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:06:46.992895 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt init fetch_analytics', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:06:47.004420 [error] [MainThread]: Encountered an error:
'profile'
[0m09:06:47.011573 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/cli/requires.py", line 153, in wrapper
    result, success = func(*args, **kwargs)
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/cli/requires.py", line 103, in wrapper
    return func(*args, **kwargs)
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/cli/main.py", line 477, in init
    results = task.run()
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/task/init.py", line 319, in run
    profile_name = self.get_profile_name_from_current_project()
  File "/Users/abbiegalie/fetch-analytics-project/venv/lib/python3.9/site-packages/dbt/task/init.py", line 140, in get_profile_name_from_current_project
    return dbt_project["profile"]
KeyError: 'profile'

[0m09:06:47.012483 [debug] [MainThread]: Resource report: {"command_name": "init", "command_success": false, "command_wall_clock_time": 0.06548925, "process_in_blocks": "0", "process_kernel_time": 0.139027, "process_mem_max_rss": "87457792", "process_out_blocks": "0", "process_user_time": 0.685368}
[0m09:06:47.012735 [debug] [MainThread]: Command `dbt init` failed at 09:06:47.012680 after 0.07 seconds
[0m09:06:47.012949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075a23a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108426700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10849b1c0>]}
[0m09:06:47.013175 [debug] [MainThread]: Flushing usage events
[0m09:06:47.178850 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:10:06.794559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aee3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105983ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105983bb0>]}


============================== 09:10:06.797779 | b4276c88-255f-497b-ba25-659606f638f2 ==============================
[0m09:10:06.797779 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:10:06.798156 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --profile dev', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:10:06.798905 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'dev'
[0m09:10:06.800240 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.04914925, "process_in_blocks": "0", "process_kernel_time": 0.138628, "process_mem_max_rss": "87621632", "process_out_blocks": "0", "process_user_time": 0.676268}
[0m09:10:06.800524 [debug] [MainThread]: Command `dbt run` failed at 09:10:06.800467 after 0.05 seconds
[0m09:10:06.800727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aee3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10597d580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10597d880>]}
[0m09:10:06.800925 [debug] [MainThread]: Flushing usage events
[0m09:10:07.034590 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:10:21.699134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c123d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054aaf70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054aac40>]}


============================== 09:10:21.702351 | 37fd5d14-d262-4d5e-bfc6-98fe64be0e1b ==============================
[0m09:10:21.702351 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:10:21.702734 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:10:21.703561 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /Users/abbiegalie/fetch-analytics-project/profiles.yml
  
[0m09:10:21.704501 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.047532126, "process_in_blocks": "0", "process_kernel_time": 0.094651, "process_mem_max_rss": "86409216", "process_out_blocks": "0", "process_user_time": 0.676514}
[0m09:10:21.704758 [debug] [MainThread]: Command `dbt run` failed at 09:10:21.704699 after 0.05 seconds
[0m09:10:21.704968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c123d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054a3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054a3580>]}
[0m09:10:21.705158 [debug] [MainThread]: Flushing usage events
[0m09:10:21.789469 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:13:19.332087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d82400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1201b49d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1201c48e0>]}


============================== 09:13:19.335589 | 2b0cb719-134d-4754-a826-ebdec0a40185 ==============================
[0m09:13:19.335589 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:13:19.336073 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:13:19.336906 [error] [MainThread]: Encountered an error:
Runtime Error
  
  dbt encountered an error while trying to read your profiles.yml file.
  
  Runtime Error
    Syntax error near line 11
    ------------------------------
    8  |       schema: raw
    9  |       schemas_and_paths:
    10 |         main: 'fetch-analytics-project/dbt_dev.db"
    11 |       schema_directory: 'fetch-analytics-project'
    12 | 
    
    Raw Error:
    ------------------------------
    while parsing a block mapping
      in "<unicode string>", line 10, column 9
    did not find expected key
      in "<unicode string>", line 11, column 26
  
[0m09:13:19.338287 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.019130543, "process_in_blocks": "0", "process_kernel_time": 0.142174, "process_mem_max_rss": "85180416", "process_out_blocks": "0", "process_user_time": 0.655727}
[0m09:13:19.338585 [debug] [MainThread]: Command `dbt run` failed at 09:13:19.338527 after 0.02 seconds
[0m09:13:19.338803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d82400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1201b48e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1201ec160>]}
[0m09:13:19.339012 [debug] [MainThread]: Flushing usage events
[0m09:13:19.529941 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:16:12.108427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103636460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104672880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104683940>]}


============================== 09:16:12.111538 | c4f950c1-ea08-45de-bc36-fcc1d04907db ==============================
[0m09:16:12.111538 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:16:12.111898 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:16:12.112657 [error] [MainThread]: Encountered an error:
Runtime Error
  
  dbt encountered an error while trying to read your profiles.yml file.
  
  Runtime Error
    Syntax error near line 11
    ------------------------------
    8  |       schema: raw
    9  |       schemas_and_paths:
    10 |         main: 'fetch-analytics-project/dbt_dev.db"
    11 |       schema_directory: 'fetch-analytics-project'
    12 | 
    
    Raw Error:
    ------------------------------
    while parsing a block mapping
      in "<unicode string>", line 10, column 9
    did not find expected key
      in "<unicode string>", line 11, column 26
  
[0m09:16:12.113972 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.018866291, "process_in_blocks": "0", "process_kernel_time": 0.136251, "process_mem_max_rss": "85032960", "process_out_blocks": "0", "process_user_time": 0.652213}
[0m09:16:12.114234 [debug] [MainThread]: Command `dbt run` failed at 09:16:12.114177 after 0.02 seconds
[0m09:16:12.114425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103636460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046ac1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046ac850>]}
[0m09:16:12.114621 [debug] [MainThread]: Flushing usage events
[0m09:16:12.221813 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:16:22.727810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031423d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fd6f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fd6c40>]}


============================== 09:16:22.730783 | 41283716-739e-4532-8909-483a84b91c13 ==============================
[0m09:16:22.730783 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:16:22.731114 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:16:22.731924 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /Users/abbiegalie/fetch-analytics-project/profiles.yml
  
[0m09:16:22.732841 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.047077376, "process_in_blocks": "0", "process_kernel_time": 0.095241, "process_mem_max_rss": "86605824", "process_out_blocks": "0", "process_user_time": 0.682823}
[0m09:16:22.733090 [debug] [MainThread]: Command `dbt run` failed at 09:16:22.733036 after 0.05 seconds
[0m09:16:22.733290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031423d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fcf4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fcf5b0>]}
[0m09:16:22.733482 [debug] [MainThread]: Flushing usage events
[0m09:16:22.804106 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:18:50.387830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e62370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cf4f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cf4c10>]}


============================== 09:18:50.391028 | 8ad924fa-5b8a-4bc3-bbae-6b1dc7305775 ==============================
[0m09:18:50.391028 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:18:50.391389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:18:50.392223 [error] [MainThread]: Encountered an error:
Runtime Error
  dbt cannot run because no profile was specified for this dbt project.
  To specify a profile for this project, add a line like the this to
  your dbt_project.yml file:
  
  profile: [profile name]
  
  Here, [profile name] should be replaced with a profile name
  defined in your profiles.yml file. You can find profiles.yml here:
  
  /Users/abbiegalie/fetch-analytics-project/profiles.yml
  
[0m09:18:50.393368 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.048272625, "process_in_blocks": "0", "process_kernel_time": 0.133562, "process_mem_max_rss": "86343680", "process_out_blocks": "0", "process_user_time": 0.674446}
[0m09:18:50.393631 [debug] [MainThread]: Command `dbt run` failed at 09:18:50.393578 after 0.05 seconds
[0m09:18:50.393834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e62370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cef610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cef6d0>]}
[0m09:18:50.394034 [debug] [MainThread]: Flushing usage events
[0m09:18:50.472078 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:19:14.565063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a92430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118b2bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118b2bbe0>]}


============================== 09:19:14.568612 | d09089c0-4f4a-4246-9327-217699cfbe18 ==============================
[0m09:19:14.568612 [info ] [MainThread]: Running with dbt=1.9.3
[0m09:19:14.569025 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:19:14.707745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd09089c0-4f4a-4246-9327-217699cfbe18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067fa880>]}
[0m09:19:14.739565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd09089c0-4f4a-4246-9327-217699cfbe18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107df8190>]}
[0m09:19:14.740266 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m09:19:14.858271 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m09:19:14.858718 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m09:19:14.858946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd09089c0-4f4a-4246-9327-217699cfbe18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118db1730>]}
[0m09:19:15.300554 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models
[0m09:19:15.303549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd09089c0-4f4a-4246-9327-217699cfbe18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118b8b490>]}
[0m09:19:15.329348 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m09:19:15.331217 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m09:19:15.346672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd09089c0-4f4a-4246-9327-217699cfbe18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119875ca0>]}
[0m09:19:15.346982 [info ] [MainThread]: Found 413 macros
[0m09:19:15.347175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd09089c0-4f4a-4246-9327-217699cfbe18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119845e80>]}
[0m09:19:15.347773 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m09:19:15.348070 [debug] [MainThread]: Command end result
[0m09:19:15.360727 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m09:19:15.361626 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m09:19:15.363452 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m09:19:15.364425 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.84528315, "process_in_blocks": "0", "process_kernel_time": 0.168795, "process_mem_max_rss": "97746944", "process_out_blocks": "0", "process_user_time": 1.293836}
[0m09:19:15.364673 [debug] [MainThread]: Command `dbt run` succeeded at 09:19:15.364626 after 0.85 seconds
[0m09:19:15.364894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a92430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118f4abe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118f4a130>]}
[0m09:19:15.365103 [debug] [MainThread]: Flushing usage events
[0m09:19:15.454135 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:47:38.572846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072313d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c4f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080c4c10>]}


============================== 10:47:38.576236 | 62e2e0eb-4e88-4b55-9dd6-11abbcb5ef49 ==============================
[0m10:47:38.576236 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:47:38.576599 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt seed', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:47:38.662336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '62e2e0eb-4e88-4b55-9dd6-11abbcb5ef49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073db9a0>]}
[0m10:47:38.693423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '62e2e0eb-4e88-4b55-9dd6-11abbcb5ef49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bb3190>]}
[0m10:47:38.694096 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:47:38.780874 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:47:38.837051 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m10:47:38.837388 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://models/staging/staging_brands.sql
[0m10:47:38.983729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '62e2e0eb-4e88-4b55-9dd6-11abbcb5ef49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086bb130>]}
[0m10:47:39.021199 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:47:39.023473 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:47:39.036620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '62e2e0eb-4e88-4b55-9dd6-11abbcb5ef49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086e3af0>]}
[0m10:47:39.036933 [info ] [MainThread]: Found 1 model, 413 macros
[0m10:47:39.037139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62e2e0eb-4e88-4b55-9dd6-11abbcb5ef49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108260ee0>]}
[0m10:47:39.037862 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:47:39.038169 [debug] [MainThread]: Command end result
[0m10:47:39.051188 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:47:39.052473 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:47:39.054774 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m10:47:39.054965 [info ] [MainThread]: 
[0m10:47:39.055219 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:47:39.055473 [info ] [MainThread]: 
[0m10:47:39.055710 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=0 SKIP=0 TOTAL=0
[0m10:47:39.058609 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 0.5326294, "process_in_blocks": "0", "process_kernel_time": 0.215168, "process_mem_max_rss": "103170048", "process_out_blocks": "0", "process_user_time": 1.061756}
[0m10:47:39.058869 [debug] [MainThread]: Command `dbt seed` succeeded at 10:47:39.058816 after 0.53 seconds
[0m10:47:39.059105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072313d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081a22b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081a2d00>]}
[0m10:47:39.059322 [debug] [MainThread]: Flushing usage events
[0m10:47:39.233451 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:51:29.816363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075543d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105ecf70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105ecc40>]}


============================== 10:51:29.819574 | 5dc2622f-9759-49fa-9366-02ae31936e9a ==============================
[0m10:51:29.819574 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:51:29.819934 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:51:29.915266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5dc2622f-9759-49fa-9366-02ae31936e9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11064e940>]}
[0m10:51:29.946957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5dc2622f-9759-49fa-9366-02ae31936e9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110453af0>]}
[0m10:51:29.947638 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:51:30.033008 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:51:30.099711 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:51:30.100008 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:51:30.118518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5dc2622f-9759-49fa-9366-02ae31936e9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a66fa0>]}
[0m10:51:30.162260 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:51:30.164923 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:51:30.178618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5dc2622f-9759-49fa-9366-02ae31936e9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a904c0>]}
[0m10:51:30.179058 [info ] [MainThread]: Found 1 model, 413 macros
[0m10:51:30.179269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5dc2622f-9759-49fa-9366-02ae31936e9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a6e2b0>]}
[0m10:51:30.179978 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:51:30.181033 [debug] [MainThread]: Command end result
[0m10:51:30.193143 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:51:30.194309 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:51:30.196392 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m10:51:30.196575 [info ] [MainThread]: 
[0m10:51:30.196821 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:51:30.196998 [info ] [MainThread]: 
[0m10:51:30.197179 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=0 SKIP=0 TOTAL=0
[0m10:51:30.198422 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 0.4240386, "process_in_blocks": "0", "process_kernel_time": 0.208493, "process_mem_max_rss": "95535104", "process_out_blocks": "0", "process_user_time": 0.970866}
[0m10:51:30.198645 [debug] [MainThread]: Command `dbt seed` succeeded at 10:51:30.198600 after 0.42 seconds
[0m10:51:30.198854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075543d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a904c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105c8e20>]}
[0m10:51:30.199055 [debug] [MainThread]: Flushing usage events
[0m10:51:30.360764 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:53:32.552095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fe43d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e78f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e78c40>]}


============================== 10:53:32.555357 | ce341fcf-6809-404a-b72a-28f18c81bb4d ==============================
[0m10:53:32.555357 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:53:32.555730 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:53:32.647834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce341fcf-6809-404a-b72a-28f18c81bb4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ed9940>]}
[0m10:53:32.682939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce341fcf-6809-404a-b72a-28f18c81bb4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cdfaf0>]}
[0m10:53:32.683895 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:53:32.773173 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:53:32.839709 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:53:32.839972 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:53:32.858169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce341fcf-6809-404a-b72a-28f18c81bb4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082f2fa0>]}
[0m10:53:32.897960 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:53:32.900698 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:53:32.917629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce341fcf-6809-404a-b72a-28f18c81bb4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10831c4c0>]}
[0m10:53:32.917974 [info ] [MainThread]: Found 1 model, 413 macros
[0m10:53:32.918186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce341fcf-6809-404a-b72a-28f18c81bb4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082fa2b0>]}
[0m10:53:32.918953 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:53:32.920036 [debug] [MainThread]: Command end result
[0m10:53:32.932373 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:53:32.933627 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:53:32.935696 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m10:53:32.935887 [info ] [MainThread]: 
[0m10:53:32.936144 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:53:32.936321 [info ] [MainThread]: 
[0m10:53:32.936504 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=0 SKIP=0 TOTAL=0
[0m10:53:32.937861 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 0.42963934, "process_in_blocks": "0", "process_kernel_time": 0.210029, "process_mem_max_rss": "96829440", "process_out_blocks": "0", "process_user_time": 0.964998}
[0m10:53:32.938160 [debug] [MainThread]: Command `dbt seed` succeeded at 10:53:32.938097 after 0.43 seconds
[0m10:53:32.938410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fe43d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10831c4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e54e20>]}
[0m10:53:32.938652 [debug] [MainThread]: Flushing usage events
[0m10:53:33.246629 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:53:35.850181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105409400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10629bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10629bbb0>]}


============================== 10:53:35.852656 | 649cb585-1b6d-4309-8bc4-f37bb76ed6c1 ==============================
[0m10:53:35.852656 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:53:35.852996 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging_brands', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:53:35.926032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '649cb585-1b6d-4309-8bc4-f37bb76ed6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10449c220>]}
[0m10:53:35.957447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '649cb585-1b6d-4309-8bc4-f37bb76ed6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d0d130>]}
[0m10:53:35.957903 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:53:36.038922 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:53:36.093917 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:53:36.094181 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:53:36.111880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '649cb585-1b6d-4309-8bc4-f37bb76ed6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106717130>]}
[0m10:53:36.150439 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:53:36.152174 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:53:36.160249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '649cb585-1b6d-4309-8bc4-f37bb76ed6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067402e0>]}
[0m10:53:36.160583 [info ] [MainThread]: Found 1 model, 413 macros
[0m10:53:36.160799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '649cb585-1b6d-4309-8bc4-f37bb76ed6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066f03a0>]}
[0m10:53:36.161442 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:53:36.162536 [debug] [MainThread]: Command end result
[0m10:53:36.176165 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:53:36.177147 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:53:36.179510 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m10:53:36.180343 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.36720857, "process_in_blocks": "0", "process_kernel_time": 0.140811, "process_mem_max_rss": "98910208", "process_out_blocks": "0", "process_user_time": 0.948838}
[0m10:53:36.180585 [debug] [MainThread]: Command `dbt run` succeeded at 10:53:36.180536 after 0.37 seconds
[0m10:53:36.180819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105409400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067291c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106729850>]}
[0m10:53:36.181039 [debug] [MainThread]: Flushing usage events
[0m10:53:36.298486 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:54:42.111338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037e9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10468c0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10468c400>]}


============================== 10:54:42.114560 | 2df2209e-49a5-4af7-8d1c-24243a074f36 ==============================
[0m10:54:42.114560 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:54:42.114901 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select staging_brands', 'send_anonymous_usage_stats': 'True'}
[0m10:54:42.209101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2df2209e-49a5-4af7-8d1c-24243a074f36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104141490>]}
[0m10:54:42.241537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2df2209e-49a5-4af7-8d1c-24243a074f36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104134610>]}
[0m10:54:42.242393 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:54:42.328431 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:54:42.393622 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:54:42.393974 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m10:54:42.515801 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a source named 'seeds.brands' which was not found
[0m10:54:42.517818 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.45584837, "process_in_blocks": "0", "process_kernel_time": 0.208462, "process_mem_max_rss": "97927168", "process_out_blocks": "0", "process_user_time": 1.003129}
[0m10:54:42.518124 [debug] [MainThread]: Command `dbt run` failed at 10:54:42.518065 after 0.46 seconds
[0m10:54:42.518435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037e9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104af4be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104af4790>]}
[0m10:54:42.518727 [debug] [MainThread]: Flushing usage events
[0m10:54:42.719433 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:55:14.134185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107150460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fe90d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fe9400>]}


============================== 10:55:14.137943 | 9e9000ee-3f5b-4d02-b372-e92218c89ad5 ==============================
[0m10:55:14.137943 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:55:14.138504 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m10:55:14.223897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9e9000ee-3f5b-4d02-b372-e92218c89ad5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108057250>]}
[0m10:55:14.256290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9e9000ee-3f5b-4d02-b372-e92218c89ad5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fc0730>]}
[0m10:55:14.257153 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:55:14.345580 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:55:14.408530 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:55:14.408958 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m10:55:14.515335 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a source named 'seeds.brands' which was not found
[0m10:55:14.516734 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.4309089, "process_in_blocks": "0", "process_kernel_time": 0.202168, "process_mem_max_rss": "98828288", "process_out_blocks": "0", "process_user_time": 0.988486}
[0m10:55:14.516982 [debug] [MainThread]: Command `dbt seed` failed at 10:55:14.516930 after 0.43 seconds
[0m10:55:14.517205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107150460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fa84f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10845cd30>]}
[0m10:55:14.517416 [debug] [MainThread]: Flushing usage events
[0m10:55:14.681747 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:56:37.610510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104759370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067ecf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067ecc10>]}


============================== 10:56:37.613765 | fcc60c95-816a-439f-bba3-2da9320a5278 ==============================
[0m10:56:37.613765 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:56:37.614141 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:56:37.710876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fcc60c95-816a-439f-bba3-2da9320a5278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b66a30>]}
[0m10:56:37.742991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fcc60c95-816a-439f-bba3-2da9320a5278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107073c40>]}
[0m10:56:37.743752 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:56:37.831544 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:56:37.898327 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:56:37.898701 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m10:56:38.002534 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m10:56:38.003880 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.43680784, "process_in_blocks": "0", "process_kernel_time": 0.214553, "process_mem_max_rss": "97796096", "process_out_blocks": "0", "process_user_time": 0.997441}
[0m10:56:38.004122 [debug] [MainThread]: Command `dbt seed` failed at 10:56:38.004071 after 0.44 seconds
[0m10:56:38.004343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104759370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107559520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107565c10>]}
[0m10:56:38.004553 [debug] [MainThread]: Flushing usage events
[0m10:56:38.118936 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:56:51.210545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a153a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cabee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cabbb0>]}


============================== 10:56:51.213776 | 26118366-aa1e-4287-a4db-abe89567d420 ==============================
[0m10:56:51.213776 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:56:51.214176 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt seed', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:56:51.392635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '26118366-aa1e-4287-a4db-abe89567d420', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d032b0>]}
[0m10:56:51.426386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '26118366-aa1e-4287-a4db-abe89567d420', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d33e80>]}
[0m10:56:51.427161 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:56:51.526808 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:56:51.592980 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:56:51.593390 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m10:56:51.702838 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands.json' which was not found
[0m10:56:51.704259 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.5448938, "process_in_blocks": "0", "process_kernel_time": 0.202907, "process_mem_max_rss": "92700672", "process_out_blocks": "0", "process_user_time": 1.103385}
[0m10:56:51.704531 [debug] [MainThread]: Command `dbt seed` failed at 10:56:51.704476 after 0.55 seconds
[0m10:56:51.704775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a153a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d0d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072190d0>]}
[0m10:56:51.704992 [debug] [MainThread]: Flushing usage events
[0m10:56:51.780349 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:59:03.210178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104314400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053adf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053adbe0>]}


============================== 10:59:03.213345 | 27ddad40-2559-443a-88f5-88774eb7ce23 ==============================
[0m10:59:03.213345 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:59:03.213708 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt seed', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:59:03.312020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27ddad40-2559-443a-88f5-88774eb7ce23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105402400>]}
[0m10:59:03.343804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27ddad40-2559-443a-88f5-88774eb7ce23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e50d90>]}
[0m10:59:03.344500 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:59:03.430486 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:59:03.498895 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:59:03.499301 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m10:59:03.603049 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a source named 'seeds.brands' which was not found
[0m10:59:03.604410 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.43534008, "process_in_blocks": "0", "process_kernel_time": 0.173103, "process_mem_max_rss": "98484224", "process_out_blocks": "0", "process_user_time": 0.983178}
[0m10:59:03.604652 [debug] [MainThread]: Command `dbt seed` failed at 10:59:03.604601 after 0.44 seconds
[0m10:59:03.604874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104314400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106124ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106124c70>]}
[0m10:59:03.605086 [debug] [MainThread]: Flushing usage events
[0m10:59:03.849438 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:59:25.384012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107545400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108eebf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108eebbe0>]}


============================== 10:59:25.387143 | 3a35ef0e-49ab-44d0-80d6-ca625bcc38d0 ==============================
[0m10:59:25.387143 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:59:25.387523 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:59:25.473170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a35ef0e-49ab-44d0-80d6-ca625bcc38d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f43400>]}
[0m10:59:25.504882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a35ef0e-49ab-44d0-80d6-ca625bcc38d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f90d90>]}
[0m10:59:25.505827 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m10:59:25.596905 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:59:25.658972 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:59:25.659356 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m10:59:25.764961 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a source named 'seeds.brands.json' which was not found
[0m10:59:25.766665 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.42638588, "process_in_blocks": "0", "process_kernel_time": 0.163975, "process_mem_max_rss": "94863360", "process_out_blocks": "0", "process_user_time": 1.003215}
[0m10:59:25.766972 [debug] [MainThread]: Command `dbt seed` failed at 10:59:25.766907 after 0.43 seconds
[0m10:59:25.767250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107545400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b64ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b64c70>]}
[0m10:59:25.767488 [debug] [MainThread]: Flushing usage events
[0m10:59:25.921800 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:10:37.400494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff8400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078b3070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078b33a0>]}


============================== 11:10:37.403796 | d7c0b95b-a047-47dd-b806-d5eee754608e ==============================
[0m11:10:37.403796 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:10:37.404167 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt seed', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:10:37.498396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd7c0b95b-a047-47dd-b806-d5eee754608e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785b340>]}
[0m11:10:37.529779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd7c0b95b-a047-47dd-b806-d5eee754608e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107363eb0>]}
[0m11:10:37.530457 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:10:37.616647 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:10:37.662301 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading fetch_analytics: properties.yml - Runtime Error
    Syntax error near line 3
    ------------------------------
    1  | version 2
    2  | 
    3  | seeds:
    4  |   - name: brands
    5  |     file: brands.json
    6  |     primary_key: _id
    
    Raw Error:
    ------------------------------
    mapping values are not allowed in this context
      in "<unicode string>", line 3, column 6
[0m11:10:37.663793 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.30734333, "process_in_blocks": "0", "process_kernel_time": 0.19017, "process_mem_max_rss": "92930048", "process_out_blocks": "0", "process_user_time": 0.866286}
[0m11:10:37.664039 [debug] [MainThread]: Command `dbt seed` failed at 11:10:37.663986 after 0.31 seconds
[0m11:10:37.664268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff8400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110e5cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110e5b20>]}
[0m11:10:37.664485 [debug] [MainThread]: Flushing usage events
[0m11:10:37.921100 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:12:21.613621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c04430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a9d100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a9d430>]}


============================== 11:12:21.616882 | 92e8c2fd-6188-46ce-b63c-1e42ddf5fdc3 ==============================
[0m11:12:21.616882 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:12:21.617248 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:12:21.710447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '92e8c2fd-6188-46ce-b63c-1e42ddf5fdc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a87280>]}
[0m11:12:21.742195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '92e8c2fd-6188-46ce-b63c-1e42ddf5fdc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b20880>]}
[0m11:12:21.742868 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:12:21.830496 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:12:21.896790 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m11:12:21.897215 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://seeds/properties.yml
[0m11:12:21.897450 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m11:12:22.021953 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:22.027764 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:22.030881 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:22.031322 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a source named 'seeds.brands.json' which was not found
[0m11:12:22.033060 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.46069193, "process_in_blocks": "0", "process_kernel_time": 0.210012, "process_mem_max_rss": "96829440", "process_out_blocks": "0", "process_user_time": 1.015179}
[0m11:12:22.033466 [debug] [MainThread]: Command `dbt seed` failed at 11:12:22.033349 after 0.46 seconds
[0m11:12:22.033772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c04430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a5c910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10409d100>]}
[0m11:12:22.034033 [debug] [MainThread]: Flushing usage events
[0m11:12:22.191051 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:12:39.553490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053413a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061d4ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061d4bb0>]}


============================== 11:12:39.556532 | 7d38428f-c62d-4ff8-8f3b-e83f649d114b ==============================
[0m11:12:39.556532 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:12:39.556906 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m11:12:39.632796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d38428f-c62d-4ff8-8f3b-e83f649d114b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10622a2b0>]}
[0m11:12:39.664315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7d38428f-c62d-4ff8-8f3b-e83f649d114b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10625ae80>]}
[0m11:12:39.665105 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:12:39.817690 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:12:39.879520 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m11:12:39.879967 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://seeds/properties.yml
[0m11:12:39.880221 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m11:12:40.006290 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:40.011838 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:40.014991 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:40.015435 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:12:40.016970 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.5039254, "process_in_blocks": "0", "process_kernel_time": 0.201649, "process_mem_max_rss": "97222656", "process_out_blocks": "0", "process_user_time": 1.013425}
[0m11:12:40.017318 [debug] [MainThread]: Command `dbt seed` failed at 11:12:40.017255 after 0.50 seconds
[0m11:12:40.017588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053413a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10449f250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066397c0>]}
[0m11:12:40.017821 [debug] [MainThread]: Flushing usage events
[0m11:12:40.097535 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:12:57.145498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a7d3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f2df40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f2dc10>]}


============================== 11:12:57.148661 | 4f1047e0-127f-4ab0-897e-e51638dea474 ==============================
[0m11:12:57.148661 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:12:57.149059 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:12:57.240396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f1047e0-127f-4ab0-897e-e51638dea474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c269a0>]}
[0m11:12:57.271832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f1047e0-127f-4ab0-897e-e51638dea474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10591b190>]}
[0m11:12:57.272475 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:12:57.361324 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:12:57.428770 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m11:12:57.429179 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://seeds/properties.yml
[0m11:12:57.429410 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m11:12:57.566221 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:57.571915 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:57.575394 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:12:57.576163 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:12:57.579386 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.47536892, "process_in_blocks": "0", "process_kernel_time": 0.197845, "process_mem_max_rss": "97992704", "process_out_blocks": "0", "process_user_time": 1.014429}
[0m11:12:57.579769 [debug] [MainThread]: Command `dbt seed` failed at 11:12:57.579680 after 0.48 seconds
[0m11:12:57.580036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a7d3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103bd9280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b917c0>]}
[0m11:12:57.580271 [debug] [MainThread]: Flushing usage events
[0m11:12:57.655026 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:18:38.406977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10693c400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077d3f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077d3bb0>]}


============================== 11:18:38.410251 | f51e4f14-8cdf-4d76-bcbb-93d0663221c8 ==============================
[0m11:18:38.410251 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:18:38.410621 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:18:38.511253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f51e4f14-8cdf-4d76-bcbb-93d0663221c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107857c70>]}
[0m11:18:38.544159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f51e4f14-8cdf-4d76-bcbb-93d0663221c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f36d0>]}
[0m11:18:38.545064 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:18:38.632819 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:18:38.675592 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:18:38.675910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f51e4f14-8cdf-4d76-bcbb-93d0663221c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072882e0>]}
[0m11:18:39.211073 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:18:39.216792 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:18:39.219528 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:18:39.219889 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:18:39.221145 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.85750276, "process_in_blocks": "0", "process_kernel_time": 0.2108, "process_mem_max_rss": "97796096", "process_out_blocks": "0", "process_user_time": 1.399757}
[0m11:18:39.221376 [debug] [MainThread]: Command `dbt seed` failed at 11:18:39.221326 after 0.86 seconds
[0m11:18:39.221594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10693c400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d4b220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d56160>]}
[0m11:18:39.221870 [debug] [MainThread]: Flushing usage events
[0m11:18:39.315850 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:19:08.050775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066953a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10772eee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10772eb50>]}


============================== 11:19:08.054507 | 8641f633-a134-4713-979c-32d8dd923c80 ==============================
[0m11:19:08.054507 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:19:08.054889 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt seed', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:19:08.153706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8641f633-a134-4713-979c-32d8dd923c80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076e02b0>]}
[0m11:19:08.185650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8641f633-a134-4713-979c-32d8dd923c80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a3a070>]}
[0m11:19:08.186428 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:19:08.345692 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:19:08.389084 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:19:08.389429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8641f633-a134-4713-979c-32d8dd923c80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071e3640>]}
[0m11:19:08.391935 [error] [MainThread]: Encountered an error:
Parsing Error
  The schema file at seeds/seeds.yml is invalid because the value of 'seeds' is not a list
[0m11:19:08.393251 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.38385192, "process_in_blocks": "0", "process_kernel_time": 0.206134, "process_mem_max_rss": "90095616", "process_out_blocks": "0", "process_user_time": 0.880295}
[0m11:19:08.393520 [debug] [MainThread]: Command `dbt seed` failed at 11:19:08.393461 after 0.38 seconds
[0m11:19:08.393746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066953a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11155eeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11155e940>]}
[0m11:19:08.393964 [debug] [MainThread]: Flushing usage events
[0m11:19:08.475877 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:29:47.629836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e84400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e320d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e32460>]}


============================== 11:29:47.634627 | 6c493af8-02e3-42dd-bf71-44bc92e34caf ==============================
[0m11:29:47.634627 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:29:47.635072 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:29:47.744465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6c493af8-02e3-42dd-bf71-44bc92e34caf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105eb3c70>]}
[0m11:29:47.777781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6c493af8-02e3-42dd-bf71-44bc92e34caf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10582c610>]}
[0m11:29:47.778614 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:29:47.874843 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:29:47.920374 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:29:47.920743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6c493af8-02e3-42dd-bf71-44bc92e34caf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057cf2e0>]}
[0m11:29:48.471926 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:29:48.473169 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:29:48.473672 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:29:48.474022 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:29:48.476167 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.9031738, "process_in_blocks": "0", "process_kernel_time": 0.315452, "process_mem_max_rss": "94765056", "process_out_blocks": "0", "process_user_time": 1.62888}
[0m11:29:48.476434 [debug] [MainThread]: Command `dbt seed` failed at 11:29:48.476375 after 0.90 seconds
[0m11:29:48.476648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e84400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064a7bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064a7880>]}
[0m11:29:48.476867 [debug] [MainThread]: Flushing usage events
[0m11:29:48.571532 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:31:56.622602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077a93a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10863eee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10863eb50>]}


============================== 11:31:56.625983 | eccb0de3-bc4e-4184-9c8c-81c8d92e0003 ==============================
[0m11:31:56.625983 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:31:56.626350 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m11:31:56.719060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eccb0de3-bc4e-4184-9c8c-81c8d92e0003', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085ee2b0>]}
[0m11:31:56.750778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eccb0de3-bc4e-4184-9c8c-81c8d92e0003', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b4e070>]}
[0m11:31:56.751476 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:31:56.838192 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:31:56.881783 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:31:56.882153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'eccb0de3-bc4e-4184-9c8c-81c8d92e0003', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080f4640>]}
[0m11:31:57.417330 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:31:57.475424 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:31:57.476862 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.8966624, "process_in_blocks": "0", "process_kernel_time": 0.179223, "process_mem_max_rss": "97959936", "process_out_blocks": "0", "process_user_time": 1.441823}
[0m11:31:57.477126 [debug] [MainThread]: Command `dbt seed` failed at 11:31:57.477069 after 0.90 seconds
[0m11:31:57.477342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077a93a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10899c970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bba8e0>]}
[0m11:31:57.477564 [debug] [MainThread]: Flushing usage events
[0m11:31:57.576506 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:37:18.707266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b813d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a18fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a18c10>]}


============================== 11:37:18.710651 | 4d842839-1131-4c63-b59e-2f062e33c81a ==============================
[0m11:37:18.710651 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:37:18.711023 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m11:37:18.803174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4d842839-1131-4c63-b59e-2f062e33c81a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d2b9a0>]}
[0m11:37:18.835688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4d842839-1131-4c63-b59e-2f062e33c81a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074cc160>]}
[0m11:37:18.836491 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:37:18.922969 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:37:18.966252 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:37:18.966610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4d842839-1131-4c63-b59e-2f062e33c81a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074cc3d0>]}
[0m11:37:19.515095 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:37:19.572563 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:37:19.574182 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.91310126, "process_in_blocks": "0", "process_kernel_time": 0.215011, "process_mem_max_rss": "96862208", "process_out_blocks": "0", "process_user_time": 1.460529}
[0m11:37:19.574450 [debug] [MainThread]: Command `dbt seed` failed at 11:37:19.574397 after 0.91 seconds
[0m11:37:19.574665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b813d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107eb0070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f921c0>]}
[0m11:37:19.574889 [debug] [MainThread]: Flushing usage events
[0m11:37:19.687852 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:39:13.693420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031f9370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10408ff70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10408fbe0>]}


============================== 11:39:13.696682 | 4cf28375-aee0-4403-8848-82c25f18bd4d ==============================
[0m11:39:13.696682 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:39:13.697052 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m11:39:13.789781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4cf28375-aee0-4403-8848-82c25f18bd4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10355ebb0>]}
[0m11:39:13.822652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4cf28375-aee0-4403-8848-82c25f18bd4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104075460>]}
[0m11:39:13.823449 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:39:13.912288 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:39:13.955218 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:39:13.955543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4cf28375-aee0-4403-8848-82c25f18bd4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b44640>]}
[0m11:39:14.486555 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:39:14.487777 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:39:14.488275 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:39:14.488631 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:39:14.490080 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.8404262, "process_in_blocks": "0", "process_kernel_time": 0.213859, "process_mem_max_rss": "97550336", "process_out_blocks": "0", "process_user_time": 1.411217}
[0m11:39:14.490344 [debug] [MainThread]: Command `dbt seed` failed at 11:39:14.490271 after 0.84 seconds
[0m11:39:14.490565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031f9370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045550a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104607b80>]}
[0m11:39:14.490782 [debug] [MainThread]: Flushing usage events
[0m11:39:14.745055 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:46:39.621764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1183d4430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f750d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f75460>]}


============================== 11:46:39.625023 | e749915a-ddff-4148-bebe-27d01186c53a ==============================
[0m11:46:39.625023 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:46:39.625412 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m11:46:39.720256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e749915a-ddff-4148-bebe-27d01186c53a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119fe1700>]}
[0m11:46:39.752513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e749915a-ddff-4148-bebe-27d01186c53a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f221f0>]}
[0m11:46:39.753241 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:46:39.838790 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:46:39.882184 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:46:39.882506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e749915a-ddff-4148-bebe-27d01186c53a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118e31b80>]}
[0m11:46:40.426224 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:46:40.426960 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:46:40.427507 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:46:40.427838 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:46:40.430012 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.8646891, "process_in_blocks": "0", "process_kernel_time": 0.215921, "process_mem_max_rss": "95567872", "process_out_blocks": "0", "process_user_time": 1.429762}
[0m11:46:40.430255 [debug] [MainThread]: Command `dbt seed` failed at 11:46:40.430204 after 0.86 seconds
[0m11:46:40.430463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1183d4430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b5e9160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b537880>]}
[0m11:46:40.430676 [debug] [MainThread]: Flushing usage events
[0m11:46:40.615537 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:48:15.596201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037ed340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104685fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104685c10>]}


============================== 11:48:15.600865 | 15df9dc7-7536-4b7d-97e9-eb4378685937 ==============================
[0m11:48:15.600865 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:48:15.601368 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:48:15.698499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '15df9dc7-7536-4b7d-97e9-eb4378685937', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10473f940>]}
[0m11:48:15.733405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '15df9dc7-7536-4b7d-97e9-eb4378685937', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040ff4f0>]}
[0m11:48:15.734191 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:48:15.823786 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:48:15.869582 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:48:15.869917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '15df9dc7-7536-4b7d-97e9-eb4378685937', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104137700>]}
[0m11:48:16.401461 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:48:16.402229 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:48:16.402774 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:48:16.403113 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:48:16.404358 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.85758287, "process_in_blocks": "0", "process_kernel_time": 0.215921, "process_mem_max_rss": "95125504", "process_out_blocks": "0", "process_user_time": 1.39913}
[0m11:48:16.404589 [debug] [MainThread]: Command `dbt seed` failed at 11:48:16.404537 after 0.86 seconds
[0m11:48:16.404798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037ed340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049a9910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bfda60>]}
[0m11:48:16.405010 [debug] [MainThread]: Flushing usage events
[0m11:48:16.656393 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:49:09.889140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105499400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106331f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106331bb0>]}


============================== 11:49:09.892305 | 4448f136-b27e-404f-b88c-05da3481c81c ==============================
[0m11:49:09.892305 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:49:09.892680 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt seed', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:49:09.988698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4448f136-b27e-404f-b88c-05da3481c81c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10452c220>]}
[0m11:49:10.020970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4448f136-b27e-404f-b88c-05da3481c81c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106176d30>]}
[0m11:49:10.021688 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:49:10.107846 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:49:10.151308 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:49:10.151667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4448f136-b27e-404f-b88c-05da3481c81c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105de42e0>]}
[0m11:49:10.683422 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:49:10.684104 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:49:10.684633 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:49:10.684946 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:49:10.686218 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.8387114, "process_in_blocks": "0", "process_kernel_time": 0.204463, "process_mem_max_rss": "96747520", "process_out_blocks": "0", "process_user_time": 1.380286}
[0m11:49:10.686445 [debug] [MainThread]: Command `dbt seed` failed at 11:49:10.686394 after 0.84 seconds
[0m11:49:10.686649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105499400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068a9820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068a9880>]}
[0m11:49:10.686863 [debug] [MainThread]: Flushing usage events
[0m11:49:10.759917 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:50:14.532575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105308430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061a3f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061a3bb0>]}


============================== 11:50:14.535875 | acd62255-a6bd-4303-aa30-55999bfb1db1 ==============================
[0m11:50:14.535875 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:50:14.536250 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed -m seed_table --full-refresh', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:50:14.630596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acd62255-a6bd-4303-aa30-55999bfb1db1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061369d0>]}
[0m11:50:14.664229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'acd62255-a6bd-4303-aa30-55999bfb1db1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106184550>]}
[0m11:50:14.665199 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:50:14.755765 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:50:14.798869 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:50:14.799195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'acd62255-a6bd-4303-aa30-55999bfb1db1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c61b80>]}
[0m11:50:15.346989 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:50:15.347721 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:50:15.348259 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:50:15.348582 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:50:15.349898 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.8678392, "process_in_blocks": "0", "process_kernel_time": 0.154249, "process_mem_max_rss": "100466688", "process_out_blocks": "0", "process_user_time": 1.419415}
[0m11:50:15.350159 [debug] [MainThread]: Command `dbt seed` failed at 11:50:15.350108 after 0.87 seconds
[0m11:50:15.350372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105308430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106344a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106722b50>]}
[0m11:50:15.350622 [debug] [MainThread]: Flushing usage events
[0m11:50:15.514932 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:51:26.662478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f203d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db8f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db8be0>]}


============================== 11:51:26.665617 | d7083e95-5fd6-4f1d-913d-6b2baf0f608d ==============================
[0m11:51:26.665617 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:51:26.665988 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed -m seed_table --full-refresh', 'send_anonymous_usage_stats': 'True'}
[0m11:51:26.761773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd7083e95-5fd6-4f1d-913d-6b2baf0f608d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fb4280>]}
[0m11:51:26.793175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd7083e95-5fd6-4f1d-913d-6b2baf0f608d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e41ee0>]}
[0m11:51:26.793886 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:51:26.880817 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:51:26.924463 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:51:26.924795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd7083e95-5fd6-4f1d-913d-6b2baf0f608d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786b3d0>]}
[0m11:51:27.455246 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:51:27.455914 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:51:27.456405 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/properties.yml'
[0m11:51:27.456722 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:51:27.457984 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.8373677, "process_in_blocks": "0", "process_kernel_time": 0.213257, "process_mem_max_rss": "95780864", "process_out_blocks": "0", "process_user_time": 1.398011}
[0m11:51:27.458232 [debug] [MainThread]: Command `dbt seed` failed at 11:51:27.458179 after 0.84 seconds
[0m11:51:27.458434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f203d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108335820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108335880>]}
[0m11:51:27.458643 [debug] [MainThread]: Flushing usage events
[0m11:51:27.537374 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:52:02.246313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034bc430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104354f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104354bb0>]}


============================== 11:52:02.249640 | 6058ae55-5ee6-4ef2-8f79-e81c7fd5b7d1 ==============================
[0m11:52:02.249640 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:52:02.250033 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed -m seed_table --full-refresh', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:52:02.357163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6058ae55-5ee6-4ef2-8f79-e81c7fd5b7d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042ea9d0>]}
[0m11:52:02.394630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6058ae55-5ee6-4ef2-8f79-e81c7fd5b7d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104339550>]}
[0m11:52:02.395538 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:52:02.507475 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:52:02.565416 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:52:02.565831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6058ae55-5ee6-4ef2-8f79-e81c7fd5b7d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e15b80>]}
[0m11:52:03.204300 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/_seeds.yml'
[0m11:52:03.205119 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/_seeds.yml'
[0m11:52:03.205641 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/_seeds.yml'
[0m11:52:03.205990 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:52:03.207349 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 1.0088238, "process_in_blocks": "0", "process_kernel_time": 0.245882, "process_mem_max_rss": "91537408", "process_out_blocks": "0", "process_user_time": 1.50614}
[0m11:52:03.207590 [debug] [MainThread]: Command `dbt seed` failed at 11:52:03.207536 after 1.01 seconds
[0m11:52:03.207810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034bc430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044f8a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048d6b20>]}
[0m11:52:03.208027 [debug] [MainThread]: Flushing usage events
[0m11:52:03.388762 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:52:06.973561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f553d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046f1fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046f1c10>]}


============================== 11:52:06.976391 | ccd0c6ad-5192-454d-8a68-340fb43aec6d ==============================
[0m11:52:06.976391 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:52:06.976764 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:52:07.053485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ccd0c6ad-5192-454d-8a68-340fb43aec6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040d7a60>]}
[0m11:52:07.085266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ccd0c6ad-5192-454d-8a68-340fb43aec6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10409f160>]}
[0m11:52:07.085753 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:52:07.167583 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:52:07.211197 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:52:07.211534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ccd0c6ad-5192-454d-8a68-340fb43aec6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10409f3d0>]}
[0m11:52:07.727213 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/_seeds.yml'
[0m11:52:07.727882 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/_seeds.yml'
[0m11:52:07.728445 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/_seeds.yml'
[0m11:52:07.728787 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:52:07.729674 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.8016548, "process_in_blocks": "0", "process_kernel_time": 0.140895, "process_mem_max_rss": "98156544", "process_out_blocks": "0", "process_user_time": 1.380381}
[0m11:52:07.729915 [debug] [MainThread]: Command `dbt seed` failed at 11:52:07.729864 after 0.80 seconds
[0m11:52:07.730131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f553d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10566cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053ef3a0>]}
[0m11:52:07.730345 [debug] [MainThread]: Flushing usage events
[0m11:52:07.807350 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:54:27.108962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e113d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ca9f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ca9bb0>]}


============================== 11:54:27.112596 | b463d302-4105-4ea0-b03e-32d6d34565eb ==============================
[0m11:54:27.112596 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:54:27.112997 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m11:54:27.209577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b463d302-4105-4ea0-b03e-32d6d34565eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d19c70>]}
[0m11:54:27.243445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b463d302-4105-4ea0-b03e-32d6d34565eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077c76a0>]}
[0m11:54:27.244337 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:54:27.333202 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:54:27.376882 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:54:27.377231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b463d302-4105-4ea0-b03e-32d6d34565eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10775d3d0>]}
[0m11:54:27.922657 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'brands' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:54:27.923325 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'receipts' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:54:27.923809 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'users' in the 'seeds' section of file 'seeds/seeds.yml'
[0m11:54:27.924160 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:54:27.925713 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.86310524, "process_in_blocks": "0", "process_kernel_time": 0.218722, "process_mem_max_rss": "93732864", "process_out_blocks": "0", "process_user_time": 1.413182}
[0m11:54:27.925984 [debug] [MainThread]: Command `dbt seed` failed at 11:54:27.925921 after 0.86 seconds
[0m11:54:27.926197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e113d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081570a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108226a30>]}
[0m11:54:27.926415 [debug] [MainThread]: Flushing usage events
[0m11:54:28.004473 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:57:20.133420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e4d3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ce5f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ce5bb0>]}


============================== 11:57:20.136756 | 2ef7b982-905e-4054-a8ef-c4ecc9699396 ==============================
[0m11:57:20.136756 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:57:20.137127 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:57:20.230024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2ef7b982-905e-4054-a8ef-c4ecc9699396', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101ee87f0>]}
[0m11:57:20.261551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2ef7b982-905e-4054-a8ef-c4ecc9699396', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031961f0>]}
[0m11:57:20.262255 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:57:20.355932 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:57:20.398302 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:57:20.398616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '2ef7b982-905e-4054-a8ef-c4ecc9699396', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103799640>]}
[0m11:57:20.911282 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:57:20.912693 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.820823, "process_in_blocks": "0", "process_kernel_time": 0.210538, "process_mem_max_rss": "96452608", "process_out_blocks": "0", "process_user_time": 1.367159}
[0m11:57:20.912942 [debug] [MainThread]: Command `dbt seed` failed at 11:57:20.912889 after 0.82 seconds
[0m11:57:20.913200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e4d3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10427be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10426d2e0>]}
[0m11:57:20.913414 [debug] [MainThread]: Flushing usage events
[0m11:57:21.146826 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:58:07.601547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036c1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104558f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104558bb0>]}


============================== 11:58:07.605144 | 219e8b0c-a908-4c1e-9ca7-7eb5ae34443b ==============================
[0m11:58:07.605144 [info ] [MainThread]: Running with dbt=1.9.3
[0m11:58:07.605505 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:58:07.703667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '219e8b0c-a908-4c1e-9ca7-7eb5ae34443b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045ad160>]}
[0m11:58:07.736623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '219e8b0c-a908-4c1e-9ca7-7eb5ae34443b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045e31f0>]}
[0m11:58:07.737450 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m11:58:07.826386 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m11:58:07.869616 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:58:07.869954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '219e8b0c-a908-4c1e-9ca7-7eb5ae34443b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10400c5b0>]}
[0m11:58:08.377329 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m11:58:08.378688 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.82066536, "process_in_blocks": "0", "process_kernel_time": 0.227354, "process_mem_max_rss": "96043008", "process_out_blocks": "0", "process_user_time": 1.385926}
[0m11:58:08.378940 [debug] [MainThread]: Command `dbt seed` failed at 11:58:08.378879 after 0.82 seconds
[0m11:58:08.379197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036c1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a07c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104acc9a0>]}
[0m11:58:08.379411 [debug] [MainThread]: Flushing usage events
[0m11:58:08.451525 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:01:15.727413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050bd370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f5b0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f5b430>]}


============================== 12:01:15.730677 | f95911a6-b93b-4cdc-99a3-77d61100213c ==============================
[0m12:01:15.730677 [info ] [MainThread]: Running with dbt=1.9.3
[0m12:01:15.731041 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:01:15.825955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f95911a6-b93b-4cdc-99a3-77d61100213c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041587c0>]}
[0m12:01:15.857673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f95911a6-b93b-4cdc-99a3-77d61100213c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10609d070>]}
[0m12:01:15.858346 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m12:01:15.944502 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m12:01:15.987201 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m12:01:15.987525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f95911a6-b93b-4cdc-99a3-77d61100213c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106257790>]}
[0m12:01:16.514501 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_brands' (models/staging/staging_brands.sql) depends on a node named 'brands' which was not found
[0m12:01:16.515854 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 0.83156866, "process_in_blocks": "0", "process_kernel_time": 0.204098, "process_mem_max_rss": "96600064", "process_out_blocks": "0", "process_user_time": 1.378458}
[0m12:01:16.516095 [debug] [MainThread]: Command `dbt seed` failed at 12:01:16.516042 after 0.83 seconds
[0m12:01:16.516301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050bd370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fdb400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064352b0>]}
[0m12:01:16.516513 [debug] [MainThread]: Flushing usage events
[0m12:01:16.751067 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:02:18.484032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ad0400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10796f130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10796f4c0>]}


============================== 12:02:18.487259 | 5b0655f3-36e4-45a9-b4ad-f2fa46b69c93 ==============================
[0m12:02:18.487259 [info ] [MainThread]: Running with dbt=1.9.3
[0m12:02:18.487618 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m12:02:18.582598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5b0655f3-36e4-45a9-b4ad-f2fa46b69c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074083d0>]}
[0m12:02:18.614028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5b0655f3-36e4-45a9-b4ad-f2fa46b69c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078fd8e0>]}
[0m12:02:18.614710 [info ] [MainThread]: Registered adapter: sqlite=1.9.0
[0m12:02:18.701043 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m12:02:18.743480 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m12:02:18.743805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5b0655f3-36e4-45a9-b4ad-f2fa46b69c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10741b2e0>]}
[0m12:02:19.393850 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
- seeds.fetch_analytics.users
- seeds.fetch_analytics.receipts
[0m12:02:19.396905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5b0655f3-36e4-45a9-b4ad-f2fa46b69c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ff1ee0>]}
[0m12:02:19.444018 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m12:02:19.446618 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m12:02:19.460747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5b0655f3-36e4-45a9-b4ad-f2fa46b69c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f4fac0>]}
[0m12:02:19.461126 [info ] [MainThread]: Found 1 model, 1 seed, 413 macros
[0m12:02:19.461327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b0655f3-36e4-45a9-b4ad-f2fa46b69c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fb7730>]}
[0m12:02:19.462011 [info ] [MainThread]: 
[0m12:02:19.462214 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:02:19.462385 [info ] [MainThread]: 
[0m12:02:19.462658 [debug] [MainThread]: Acquiring new sqlite connection 'master'
[0m12:02:19.463128 [debug] [ThreadPool]: Acquiring new sqlite connection 'list_dbt_dev'
[0m12:02:19.506413 [debug] [ThreadPool]: Using sqlite connection "list_dbt_dev"
[0m12:02:19.506690 [debug] [ThreadPool]: On list_dbt_dev: BEGIN
[0m12:02:19.506860 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:02:19.509714 [warn ] [ThreadPool]: [AdapterEventDebug]: Unable to parse logging event dictionary. Failed to parse args field: Value unable to open database file has unexpected type <class 'sqlite3.OperationalError'> at AdapterEventDebug.args[0].. Dictionary: {'name': 'SQLite', 'base_msg': "Got an error when attempting to open a sqlite3 connection: '%s'", 'args': [OperationalError('unable to open database file')], 'node_info': {}}
[0m12:02:19.510009 [debug] [ThreadPool]:  adapter: 
[0m12:02:19.510238 [debug] [ThreadPool]: SQLite adapter: Error running SQL: BEGIN
[0m12:02:19.510408 [debug] [ThreadPool]: SQLite adapter: Rolling back transaction.
[0m12:02:19.510576 [debug] [ThreadPool]: On list_dbt_dev: No close available on handle
[0m12:02:19.510805 [debug] [ThreadPool]: SQLite adapter: Error running SQL: macro list_schemas
[0m12:02:19.510967 [debug] [ThreadPool]: SQLite adapter: Rolling back transaction.
[0m12:02:19.511367 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:02:19.511525 [debug] [MainThread]: Connection 'list_dbt_dev' was properly closed.
[0m12:02:19.511691 [info ] [MainThread]: 
[0m12:02:19.511877 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.05 seconds (0.05s).
[0m12:02:19.512159 [error] [MainThread]: Encountered an error:
Runtime Error
  Runtime Error
    Database Error
      unable to open database file
[0m12:02:19.514637 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": false, "command_wall_clock_time": 1.0724684, "process_in_blocks": "0", "process_kernel_time": 0.232038, "process_mem_max_rss": "105496576", "process_out_blocks": "0", "process_user_time": 1.57282}
[0m12:02:19.514905 [debug] [MainThread]: Command `dbt seed` failed at 12:02:19.514848 after 1.07 seconds
[0m12:02:19.515319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ad0400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10804d370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10801a7c0>]}
[0m12:02:19.515638 [debug] [MainThread]: Flushing usage events
[0m12:02:19.599056 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:35:55.332310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b9400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11036ef40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11036ebb0>]}


============================== 17:35:55.335498 | de16caac-8a15-4aef-bbad-f8c25ad3b2f3 ==============================
[0m17:35:55.335498 [info ] [MainThread]: Running with dbt=1.9.3
[0m17:35:55.335876 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:35:55.339359 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.snowflake'
[0m17:35:55.339672 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "default", target "dev" invalid: Runtime Error
    Could not find adapter type snowflake!
[0m17:35:55.341010 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.05333171, "process_in_blocks": "0", "process_kernel_time": 0.148298, "process_mem_max_rss": "85671936", "process_out_blocks": "0", "process_user_time": 0.697773}
[0m17:35:55.341376 [debug] [MainThread]: Command `dbt run` failed at 17:35:55.341219 after 0.05 seconds
[0m17:35:55.341663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b9400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103060a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110306a30>]}
[0m17:35:55.341918 [debug] [MainThread]: Flushing usage events
[0m17:35:55.531245 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:38:23.061595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103094e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f420d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f42ca0>]}


============================== 17:38:23.064689 | 6207140b-6b62-4a75-b33e-e8a01a43d108 ==============================
[0m17:38:23.064689 [info ] [MainThread]: Running with dbt=1.9.3
[0m17:38:23.065053 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:38:24.846231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6207140b-6b62-4a75-b33e-e8a01a43d108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f23b50>]}
[0m17:38:24.877456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6207140b-6b62-4a75-b33e-e8a01a43d108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120da5ac0>]}
[0m17:38:24.877981 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m17:38:25.001193 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m17:38:25.054396 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m17:38:25.054700 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m17:38:25.054882 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m17:38:25.055071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6207140b-6b62-4a75-b33e-e8a01a43d108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1039c10a0>]}
[0m17:38:25.058824 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading fetch_analytics: staging/src_public.yml - Runtime Error
    Syntax error near line 4
    ------------------------------
    1  | version 2
    2  | 
    3  | 
    4  | sources:
    5  |   - name: public
    6  |     database: raw
    7  |     schema: public
    
    Raw Error:
    ------------------------------
    mapping values are not allowed in this context
      in "<unicode string>", line 4, column 8
[0m17:38:25.060690 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.0418642, "process_in_blocks": "0", "process_kernel_time": 0.767863, "process_mem_max_rss": "147603456", "process_out_blocks": "0", "process_user_time": 2.462507}
[0m17:38:25.060991 [debug] [MainThread]: Command `dbt run` failed at 17:38:25.060930 after 2.04 seconds
[0m17:38:25.061235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103094e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124c46dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124c46700>]}
[0m17:38:25.061471 [debug] [MainThread]: Flushing usage events
[0m17:38:25.156199 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:40:29.356195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10761bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1107de0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1107decd0>]}


============================== 17:40:29.359307 | 73003716-f3df-4aec-bae0-fe21f8e71f1b ==============================
[0m17:40:29.359307 [info ] [MainThread]: Running with dbt=1.9.3
[0m17:40:29.359684 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:40:29.978201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73003716-f3df-4aec-bae0-fe21f8e71f1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10652a880>]}
[0m17:40:30.009649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73003716-f3df-4aec-bae0-fe21f8e71f1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ae62be0>]}
[0m17:40:30.010195 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m17:40:30.131297 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m17:40:30.184533 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m17:40:30.184835 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m17:40:30.185018 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m17:40:30.185213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '73003716-f3df-4aec-bae0-fe21f8e71f1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11025d0a0>]}
[0m17:40:30.824051 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_users' (models/staging/staging_users.sql) depends on a source named 'raw.users' which was not found
[0m17:40:30.825800 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.5163238, "process_in_blocks": "0", "process_kernel_time": 0.561094, "process_mem_max_rss": "155942912", "process_out_blocks": "0", "process_user_time": 3.2043}
[0m17:40:30.826056 [debug] [MainThread]: Command `dbt run` failed at 17:40:30.826002 after 1.52 seconds
[0m17:40:30.826268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10761bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b397e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b171430>]}
[0m17:40:30.826478 [debug] [MainThread]: Flushing usage events
[0m17:40:31.012407 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:46:14.596855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102cf4e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ba20d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ba2ca0>]}


============================== 17:46:14.599791 | 4e2cd33e-8971-482c-bb94-5efc0c545c07 ==============================
[0m17:46:14.599791 [info ] [MainThread]: Running with dbt=1.9.3
[0m17:46:14.600149 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:46:15.255050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4e2cd33e-8971-482c-bb94-5efc0c545c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1039f9a90>]}
[0m17:46:15.286642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4e2cd33e-8971-482c-bb94-5efc0c545c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103681d90>]}
[0m17:46:15.287303 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m17:46:15.408591 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m17:46:15.461597 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m17:46:15.461891 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m17:46:15.462076 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m17:46:15.462278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4e2cd33e-8971-482c-bb94-5efc0c545c07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036210a0>]}
[0m17:46:16.098402 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_users' (models/staging/staging_users.sql) depends on a source named 'source.users' which was not found
[0m17:46:16.100970 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.5454342, "process_in_blocks": "0", "process_kernel_time": 0.59449, "process_mem_max_rss": "153321472", "process_out_blocks": "0", "process_user_time": 3.207066}
[0m17:46:16.101236 [debug] [MainThread]: Command `dbt run` failed at 17:46:16.101180 after 1.55 seconds
[0m17:46:16.101474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102cf4e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c58ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12790f8b0>]}
[0m17:46:16.101691 [debug] [MainThread]: Flushing usage events
[0m17:46:16.367406 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:46:38.846200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102dace80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c5a0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c5aca0>]}


============================== 17:46:38.849112 | c4b1aad5-2162-4db6-afbb-65d489f3148b ==============================
[0m17:46:38.849112 [info ] [MainThread]: Running with dbt=1.9.3
[0m17:46:38.849472 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:46:39.422576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c4b1aad5-2162-4db6-afbb-65d489f3148b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ab3100>]}
[0m17:46:39.453642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c4b1aad5-2162-4db6-afbb-65d489f3148b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103735d90>]}
[0m17:46:39.454518 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m17:46:39.575165 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m17:46:39.628126 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m17:46:39.628426 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m17:46:39.628612 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m17:46:39.628815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c4b1aad5-2162-4db6-afbb-65d489f3148b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036d90a0>]}
[0m17:46:40.258285 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.fetch_analytics.staging_receipts' (models/staging/staging_receipts.sql) depends on a source named 'source.receipts' which was not found
[0m17:46:40.259971 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.4568541, "process_in_blocks": "0", "process_kernel_time": 0.51771, "process_mem_max_rss": "154943488", "process_out_blocks": "0", "process_user_time": 3.229399}
[0m17:46:40.260218 [debug] [MainThread]: Command `dbt run` failed at 17:46:40.260165 after 1.46 seconds
[0m17:46:40.260425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102dace80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124998ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1246348b0>]}
[0m17:46:40.260636 [debug] [MainThread]: Flushing usage events
[0m17:46:40.338474 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:47:02.453983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077b8d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108662eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108662be0>]}


============================== 17:47:02.457106 | 1fb25ab0-ef4e-4cd3-90eb-4c738e7fa36c ==============================
[0m17:47:02.457106 [info ] [MainThread]: Running with dbt=1.9.3
[0m17:47:02.457474 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:47:03.113701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1fb25ab0-ef4e-4cd3-90eb-4c738e7fa36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e253d60>]}
[0m17:47:03.145348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1fb25ab0-ef4e-4cd3-90eb-4c738e7fa36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e2820a0>]}
[0m17:47:03.145952 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m17:47:03.269078 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m17:47:03.322109 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m17:47:03.322441 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m17:47:03.322625 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m17:47:03.322824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1fb25ab0-ef4e-4cd3-90eb-4c738e7fa36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10793cd00>]}
[0m17:47:04.008914 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m17:47:04.016213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1fb25ab0-ef4e-4cd3-90eb-4c738e7fa36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb43130>]}
[0m17:47:04.064680 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m17:47:04.068687 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m17:47:04.082345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1fb25ab0-ef4e-4cd3-90eb-4c738e7fa36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb43160>]}
[0m17:47:04.082658 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m17:47:04.082862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1fb25ab0-ef4e-4cd3-90eb-4c738e7fa36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb409d0>]}
[0m17:47:04.083684 [info ] [MainThread]: 
[0m17:47:04.083894 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:47:04.084062 [info ] [MainThread]: 
[0m17:47:04.084339 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:47:04.087117 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m17:47:04.123263 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m17:47:04.123517 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m17:47:04.123696 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:47:05.175102 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m17:47:05.175395 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m17:47:05.175623 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m17:47:05.175791 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m17:47:05.176230 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:47:05.176434 [debug] [MainThread]: Connection 'list_RAW' was left open.
[0m17:47:05.176611 [debug] [MainThread]: On list_RAW: No close available on handle
[0m17:47:05.176782 [info ] [MainThread]: 
[0m17:47:05.176974 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.09 seconds (1.09s).
[0m17:47:05.177264 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "RAW"
  Database Error
    250003 (08001): 404 Not Found: post https://AR34043.snowflakecomputing.com:443/session/v1/login-request?request_id=9d6cc7a6-95eb-4a61-b6c2-97247fea7de7&databaseName=RAW&schemaName=PUBLIC&warehouse=COMPUTE_WH&roleName=ACCOUNTADMIN&request_guid=79d395cd-d6ac-4191-8d7a-ebfff5b364f1
[0m17:47:05.178758 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.7679498, "process_in_blocks": "0", "process_kernel_time": 0.559796, "process_mem_max_rss": "171212800", "process_out_blocks": "0", "process_user_time": 3.698823}
[0m17:47:05.178994 [debug] [MainThread]: Command `dbt run` failed at 17:47:05.178945 after 2.77 seconds
[0m17:47:05.179194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077b8d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb91fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ed61ca0>]}
[0m17:47:05.179411 [debug] [MainThread]: Flushing usage events
[0m17:47:05.247702 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:53:29.770364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786ce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11891e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11891eca0>]}


============================== 17:53:29.773665 | 95b914ce-9a38-4b38-8b2e-e649af4373b8 ==============================
[0m17:53:29.773665 [info ] [MainThread]: Running with dbt=1.9.3
[0m17:53:29.774042 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m17:53:30.589565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118777100>]}
[0m17:53:30.625230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1182f9d90>]}
[0m17:53:30.625981 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m17:53:30.764606 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m17:53:30.829552 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m17:53:30.829969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11829d0a0>]}
[0m17:53:31.600628 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m17:53:31.608628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec72130>]}
[0m17:53:31.661546 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m17:53:31.677986 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m17:53:31.736918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12eccee50>]}
[0m17:53:31.737282 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m17:53:31.737481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec25b50>]}
[0m17:53:31.738324 [info ] [MainThread]: 
[0m17:53:31.738538 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:53:31.738700 [info ] [MainThread]: 
[0m17:53:31.738994 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:53:31.741842 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m17:53:31.780137 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m17:53:31.780397 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m17:53:31.780572 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:53:32.720192 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.939 seconds
[0m17:53:32.723129 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now create_RAW_PUBLIC_staging)
[0m17:53:32.728582 [debug] [ThreadPool]: Creating schema "database: "RAW"
schema: "PUBLIC_staging"
"
[0m17:53:32.732259 [debug] [ThreadPool]: Using snowflake connection "create_RAW_PUBLIC_staging"
[0m17:53:32.732487 [debug] [ThreadPool]: On create_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "create_RAW_PUBLIC_staging"} */
create schema if not exists RAW.PUBLIC_staging
[0m17:53:32.833568 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.101 seconds
[0m17:53:32.838930 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_RAW_PUBLIC_staging, now list_RAW_PUBLIC_staging)
[0m17:53:32.846894 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m17:53:32.847138 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m17:53:32.938302 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.091 seconds
[0m17:53:32.944173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ed7c340>]}
[0m17:53:32.959515 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m17:53:32.959834 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m17:53:32.960083 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m17:53:32.960331 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m17:53:32.960690 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m17:53:32.961014 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m17:53:32.961381 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m17:53:32.961738 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m17:53:32.962138 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m17:53:32.962451 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m17:53:32.962749 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m17:53:32.963028 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m17:53:32.963265 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m17:53:32.963478 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m17:53:32.963682 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m17:53:32.963880 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m17:53:32.970653 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m17:53:32.972429 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m17:53:32.975521 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m17:53:32.981007 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m17:53:32.991659 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m17:53:32.991980 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m17:53:32.992205 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m17:53:32.998808 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m17:53:33.019283 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m17:53:33.023722 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m17:53:33.025609 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m17:53:33.027545 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m17:53:33.029800 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m17:53:33.030182 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (select
    r.variant_col:"_id"."$oid"::string as receipt_id,
    i.value:"barcode"::string as barcode,
    i.value:"description"::string as description,
    i.value:"finalPrice"::string as final_price,
    i.value:"itemPrice"::string as item_price,
    i.value:"needsFetchReview"::boolean as needs_fetch_review,
    i.value:"partnerItemId"::string as partner_item_id,
    i.value:"preventTargetGapPoints"::boolean as prevent_target_gap_points,
    i.value:"quantityPurchased"::number as quantity_purchased,
    i.value:"userFlaggedBarcode"::string as user_flagged_barcode,
    i.value:"userFlaggedNewItem"::boolean as user_flagged_new_item,
    i.value:"userFlaggedPrice"::string as user_flagged_price,
    i.value:"userFlaggedQuantity"::number as user_flagged_quantity,
    i.value:"needsFetchReviewReason"::string as needs_fetch_review_reason,
    i.value:"pointsNotAwardedReason"::string as points_not_awarded_reason,
    i.value:"pointsPayerId"::string as points_payer_id,
    i.value:"rewardsGroup"::string as rewards_group,
    i.value:"rewardsProductPartnerId"::string as rewards_product_partner_id,
    i.value:"userFlaggedDescription"::string as user_flagged_description,
    i.value:"originalMetaBriteBarcode"::string as original_meta_brite_barcode,
    i.value:"originalMetaBriteDescription"::string as original_meta_brite_description,
    i.value:"brandCode"::string as brand_code,
    i.value:"competitorRewardsGroup"::string as competitor_rewards_group,
    i.value:"discountedItemPrice"::string as discounted_item_price,
    i.value:"originalReceiptItemText"::string as original_receipt_item_text,
    i.value:"itemNumber"::string as item_number,
    i.value:"originalMetaBriteQuantityPurchased"::number as original_meta_brite_quantity_purchased,
    i.value:"pointsEarned"::string as points_earned,
    i.value:"targetPrice"::string as target_price,
    i.value:"competitiveProduct"::string as competitive_product,
    i.value:"originalFinalPrice"::string as original_final_price,
    i.value:"originalMetaBriteItemPrice"::string as original_meta_brite_item_price,
    i.value:"deleted"::boolean as deleted,
    i.value:"priceAfterCoupon"::string as price_after_coupon,
    i.value:"metabriteCampaignId"::string as metabrite_campaign_id
from
    raw_fetch_excercise.receipts.receipts_tbl r,
    lateral flatten(input => r.variant_col:"rewardsReceiptItemList") i;
[0m17:53:33.030995 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m17:53:33.031225 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m17:53:33.031922 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m17:53:33.033045 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m17:53:33.033295 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        -- Extract User ID 
        _id:$oid::string as user_id,
        
        -- Boolean handling active is default
        coalesce(active, false)::boolean as active,
        
        -- Convert epoch milliseconds to timestamp
        to_timestamp(createdDate:$date::number / 1000) as created_timestamp,
        to_timestamp(lastLogin:$date::number / 1000) as last_login_timestamp,
        
        -- String fields without lower/trim transformations
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m17:53:33.034178 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
       -- Brand ID and basic fields
       _id:oid::string as brand_id,
       name::string as brand_name,
       barcode::string as barcode,
       brandCode::string as brand_code,
       
       -- Category information
       category::string as category,
       categoryCode::string as category_code,
       
       -- CPG / Consumer Packaged Goods information
       cpg:ref::string as cpg_ref,
       cpg:id:oid::string as cpg_id,
       
       -- Additional brand attributes
       topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m17:53:33.034515 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        _id:$oid::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(purchaseDate:$date::number / 1000) as purchase_timestamp,
        to_timestamp(createDate:$date::number / 1000) as create_timestamp,
        to_timestamp(modifyDate:$date::number / 1000) as modify_timestamp,
        to_timestamp(pointsAwardedDate:$date::number / 1000) as points_awarded_timestamp,
        to_timestamp(finishedDate:$date::number / 1000) as finished_timestamp,
        to_timestamp(dateScanned:$date::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts;
[0m17:53:33.035176 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m17:53:33.035639 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m17:53:33.195446 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb13a1-0000-ca9e-0001-5dbe00011042
[0m17:53:33.195766 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001044 (42P13): SQL compilation error: error line 10 at position 10
Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(3))
[0m17:53:33.201145 [debug] [Thread-1  ]: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 10 at position 10
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(3))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m17:53:33.203621 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ecc7730>]}
[0m17:53:33.204245 [error] [Thread-1  ]: 1 of 4 ERROR creating sql table model PUBLIC_staging.staging_brands ............ [[31mERROR[0m in 0.24s]
[0m17:53:33.204862 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m17:53:33.205335 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_brands' to be skipped because of status 'error'.  Reason: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 10 at position 10
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(3))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql.
[0m17:53:33.440123 [debug] [Thread-4  ]: Snowflake adapter: Snowflake query id: 01bb13a1-0000-ca32-0000-00015dbe2eb9
[0m17:53:33.440445 [debug] [Thread-4  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 12 at position 12 unexpected '$oid'.
syntax error line 18 at position 33 unexpected '$date'.
syntax error line 19 at position 31 unexpected '$date'.
[0m17:53:33.445002 [debug] [Thread-4  ]: Database Error in model staging_users (models/staging/staging_users.sql)
  001003 (42000): SQL compilation error:
  syntax error line 12 at position 12 unexpected '$oid'.
  syntax error line 18 at position 33 unexpected '$date'.
  syntax error line 19 at position 31 unexpected '$date'.
  compiled code at target/run/fetch_analytics/models/staging/staging_users.sql
[0m17:53:33.445338 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fdc2280>]}
[0m17:53:33.445811 [error] [Thread-4  ]: 4 of 4 ERROR creating sql table model PUBLIC_staging.staging_users ............. [[31mERROR[0m in 0.48s]
[0m17:53:33.446218 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m17:53:33.446566 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_users' to be skipped because of status 'error'.  Reason: Database Error in model staging_users (models/staging/staging_users.sql)
  001003 (42000): SQL compilation error:
  syntax error line 12 at position 12 unexpected '$oid'.
  syntax error line 18 at position 33 unexpected '$date'.
  syntax error line 19 at position 31 unexpected '$date'.
  compiled code at target/run/fetch_analytics/models/staging/staging_users.sql.
[0m17:53:33.478943 [debug] [Thread-3  ]: Snowflake adapter: Snowflake query id: 01bb13a1-0000-ca4b-0000-00015dbea135
[0m17:53:33.479244 [debug] [Thread-3  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 11 at position 12 unexpected '$oid'.
syntax error line 15 at position 34 unexpected '$date'.
syntax error line 16 at position 32 unexpected '$date'.
syntax error line 17 at position 32 unexpected '$date'.
syntax error line 18 at position 39 unexpected '$date'.
syntax error line 19 at position 34 unexpected '$date'.
syntax error line 20 at position 33 unexpected '$date'.
syntax error line 30 at position 30 unexpected ';'.
[0m17:53:33.483747 [debug] [Thread-3  ]: Database Error in model staging_receipts (models/staging/staging_receipts.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 12 unexpected '$oid'.
  syntax error line 15 at position 34 unexpected '$date'.
  syntax error line 16 at position 32 unexpected '$date'.
  syntax error line 17 at position 32 unexpected '$date'.
  syntax error line 18 at position 39 unexpected '$date'.
  syntax error line 19 at position 34 unexpected '$date'.
  syntax error line 20 at position 33 unexpected '$date'.
  syntax error line 30 at position 30 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipts.sql
[0m17:53:33.484134 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d178760>]}
[0m17:53:33.484872 [error] [Thread-3  ]: 3 of 4 ERROR creating sql table model PUBLIC_staging.staging_receipts .......... [[31mERROR[0m in 0.52s]
[0m17:53:33.485229 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m17:53:33.485523 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_receipts' to be skipped because of status 'error'.  Reason: Database Error in model staging_receipts (models/staging/staging_receipts.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 12 unexpected '$oid'.
  syntax error line 15 at position 34 unexpected '$date'.
  syntax error line 16 at position 32 unexpected '$date'.
  syntax error line 17 at position 32 unexpected '$date'.
  syntax error line 18 at position 39 unexpected '$date'.
  syntax error line 19 at position 34 unexpected '$date'.
  syntax error line 20 at position 33 unexpected '$date'.
  syntax error line 30 at position 30 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipts.sql.
[0m17:53:33.489435 [debug] [Thread-2  ]: Snowflake adapter: Snowflake query id: 01bb13a1-0000-ca1f-0000-00015dbeb135
[0m17:53:33.489639 [debug] [Thread-2  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 41 at position 70 unexpected ';'.
[0m17:53:33.494417 [debug] [Thread-2  ]: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  001003 (42000): SQL compilation error:
  syntax error line 41 at position 70 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m17:53:33.494889 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95b914ce-9a38-4b38-8b2e-e649af4373b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ed85460>]}
[0m17:53:33.495298 [error] [Thread-2  ]: 2 of 4 ERROR creating sql table model PUBLIC_staging.staging_receipt_items ..... [[31mERROR[0m in 0.53s]
[0m17:53:33.495634 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m17:53:33.495924 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_receipt_items' to be skipped because of status 'error'.  Reason: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  001003 (42000): SQL compilation error:
  syntax error line 41 at position 70 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql.
[0m17:53:33.496717 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:53:33.496903 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m17:53:33.497071 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m17:53:33.573692 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m17:53:33.574059 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m17:53:33.651168 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m17:53:33.651725 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m17:53:33.724485 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m17:53:33.724812 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m17:53:33.795053 [info ] [MainThread]: 
[0m17:53:33.795414 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 2.06 seconds (2.06s).
[0m17:53:33.796238 [debug] [MainThread]: Command end result
[0m17:53:33.873969 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m17:53:33.875106 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m17:53:33.879747 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m17:53:33.879964 [info ] [MainThread]: 
[0m17:53:33.880188 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m17:53:33.880376 [info ] [MainThread]: 
[0m17:53:33.880593 [error] [MainThread]:   Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 10 at position 10
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(3))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m17:53:33.880772 [info ] [MainThread]: 
[0m17:53:33.880972 [error] [MainThread]:   Database Error in model staging_users (models/staging/staging_users.sql)
  001003 (42000): SQL compilation error:
  syntax error line 12 at position 12 unexpected '$oid'.
  syntax error line 18 at position 33 unexpected '$date'.
  syntax error line 19 at position 31 unexpected '$date'.
  compiled code at target/run/fetch_analytics/models/staging/staging_users.sql
[0m17:53:33.881145 [info ] [MainThread]: 
[0m17:53:33.881349 [error] [MainThread]:   Database Error in model staging_receipts (models/staging/staging_receipts.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 12 unexpected '$oid'.
  syntax error line 15 at position 34 unexpected '$date'.
  syntax error line 16 at position 32 unexpected '$date'.
  syntax error line 17 at position 32 unexpected '$date'.
  syntax error line 18 at position 39 unexpected '$date'.
  syntax error line 19 at position 34 unexpected '$date'.
  syntax error line 20 at position 33 unexpected '$date'.
  syntax error line 30 at position 30 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipts.sql
[0m17:53:33.881531 [info ] [MainThread]: 
[0m17:53:33.881724 [error] [MainThread]:   Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  001003 (42000): SQL compilation error:
  syntax error line 41 at position 70 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m17:53:33.881890 [info ] [MainThread]: 
[0m17:53:33.882070 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=4 SKIP=0 TOTAL=4
[0m17:53:33.884378 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.1620855, "process_in_blocks": "0", "process_kernel_time": 0.799894, "process_mem_max_rss": "168673280", "process_out_blocks": "0", "process_user_time": 3.882955}
[0m17:53:33.884618 [debug] [MainThread]: Command `dbt run` failed at 17:53:33.884570 after 4.16 seconds
[0m17:53:33.884846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786ce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc33970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc33520>]}
[0m17:53:33.885076 [debug] [MainThread]: Flushing usage events
[0m17:53:34.112554 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:01:13.900413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b6be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11011e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11011eca0>]}


============================== 18:01:13.903466 | 9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767 ==============================
[0m18:01:13.903466 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:01:13.903831 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:01:14.585743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f77100>]}
[0m18:01:14.617227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045f9d90>]}
[0m18:01:14.617817 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:01:14.739007 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:01:14.823095 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m18:01:14.823492 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_receipts.sql
[0m18:01:14.823734 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_users.sql
[0m18:01:14.823947 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_receipt_items.sql
[0m18:01:14.824158 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m18:01:14.971342 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m18:01:14.979943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127a1a130>]}
[0m18:01:15.029123 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:01:15.031908 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:01:15.045315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127926d00>]}
[0m18:01:15.045649 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:01:15.045850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127a1a5e0>]}
[0m18:01:15.046671 [info ] [MainThread]: 
[0m18:01:15.046879 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:01:15.047047 [info ] [MainThread]: 
[0m18:01:15.047328 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:01:15.050140 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:01:15.122217 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:01:15.122517 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:01:15.122702 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:01:16.001220 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.878 seconds
[0m18:01:16.007231 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:01:16.025050 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:01:16.025566 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:01:16.134416 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.108 seconds
[0m18:01:16.138414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117f78760>]}
[0m18:01:16.151427 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:01:16.152139 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:01:16.152767 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:01:16.153218 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:01:16.153879 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:01:16.154608 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:01:16.155267 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:01:16.155939 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:01:16.156598 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:01:16.157314 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:01:16.157934 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:01:16.158532 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:01:16.159022 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:01:16.159531 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:01:16.160008 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:01:16.160670 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:01:16.172244 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:01:16.174911 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:01:16.179251 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:01:16.182530 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:01:16.183645 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:01:16.184115 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:01:16.184657 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:01:16.191186 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:01:16.229065 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:01:16.232920 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:01:16.235609 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:01:16.237410 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:01:16.239197 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:01:16.239917 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:01:16.240165 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        _id:$oid::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(purchaseDate:$date::number / 1000) as purchase_timestamp,
        to_timestamp(createDate:$date::number / 1000) as create_timestamp,
        to_timestamp(modifyDate:$date::number / 1000) as modify_timestamp,
        to_timestamp(pointsAwardedDate:$date::number / 1000) as points_awarded_timestamp,
        to_timestamp(finishedDate:$date::number / 1000) as finished_timestamp,
        to_timestamp(dateScanned:$date::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:01:16.241682 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:01:16.242307 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:01:16.242547 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        get(parse_json(_id), 'oid')::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        get(parse_json(cpg), 'ref')::string as cpg_ref,
        get(parse_json(get(parse_json(cpg), 'id')), 'oid')::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:01:16.242780 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:01:16.243065 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (select
    r.variant_col:"_id"."$oid"::string as receipt_id,
    i.value:"barcode"::string as barcode,
    i.value:"description"::string as description,
    i.value:"finalPrice"::string as final_price,
    i.value:"itemPrice"::string as item_price,
    i.value:"needsFetchReview"::boolean as needs_fetch_review,
    i.value:"partnerItemId"::string as partner_item_id,
    i.value:"preventTargetGapPoints"::boolean as prevent_target_gap_points,
    i.value:"quantityPurchased"::number as quantity_purchased,
    i.value:"userFlaggedBarcode"::string as user_flagged_barcode,
    i.value:"userFlaggedNewItem"::boolean as user_flagged_new_item,
    i.value:"userFlaggedPrice"::string as user_flagged_price,
    i.value:"userFlaggedQuantity"::number as user_flagged_quantity,
    i.value:"needsFetchReviewReason"::string as needs_fetch_review_reason,
    i.value:"pointsNotAwardedReason"::string as points_not_awarded_reason,
    i.value:"pointsPayerId"::string as points_payer_id,
    i.value:"rewardsGroup"::string as rewards_group,
    i.value:"rewardsProductPartnerId"::string as rewards_product_partner_id,
    i.value:"userFlaggedDescription"::string as user_flagged_description,
    i.value:"originalMetaBriteBarcode"::string as original_meta_brite_barcode,
    i.value:"originalMetaBriteDescription"::string as original_meta_brite_description,
    i.value:"brandCode"::string as brand_code,
    i.value:"competitorRewardsGroup"::string as competitor_rewards_group,
    i.value:"discountedItemPrice"::string as discounted_item_price,
    i.value:"originalReceiptItemText"::string as original_receipt_item_text,
    i.value:"itemNumber"::string as item_number,
    i.value:"originalMetaBriteQuantityPurchased"::number as original_meta_brite_quantity_purchased,
    i.value:"pointsEarned"::string as points_earned,
    i.value:"targetPrice"::string as target_price,
    i.value:"competitiveProduct"::string as competitive_product,
    i.value:"originalFinalPrice"::string as original_final_price,
    i.value:"originalMetaBriteItemPrice"::string as original_meta_brite_item_price,
    i.value:"deleted"::boolean as deleted,
    i.value:"priceAfterCoupon"::string as price_after_coupon,
    i.value:"metabriteCampaignId"::string as metabrite_campaign_id
from
    raw_fetch_excercise.receipts.receipts_tbl r,
    lateral flatten(input => r.variant_col:"rewardsReceiptItemList") i
        );
[0m18:01:16.243352 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:01:16.243818 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:01:16.244558 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:01:16.727759 [debug] [Thread-2  ]: Snowflake adapter: Snowflake query id: 01bb13a9-0000-ca41-0001-5dbe0001005e
[0m18:01:16.728152 [debug] [Thread-2  ]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Database 'RAW_FETCH_EXCERCISE' does not exist or not authorized.
[0m18:01:16.734689 [debug] [Thread-2  ]: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  002003 (02000): SQL compilation error:
  Database 'RAW_FETCH_EXCERCISE' does not exist or not authorized.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m18:01:16.736245 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103cf95b0>]}
[0m18:01:16.736740 [error] [Thread-2  ]: 2 of 4 ERROR creating sql table model PUBLIC_staging.staging_receipt_items ..... [[31mERROR[0m in 0.58s]
[0m18:01:16.737168 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:01:16.737533 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_receipt_items' to be skipped because of status 'error'.  Reason: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  002003 (02000): SQL compilation error:
  Database 'RAW_FETCH_EXCERCISE' does not exist or not authorized.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql.
[0m18:01:16.834432 [debug] [Thread-3  ]: Snowflake adapter: Snowflake query id: 01bb13a9-0000-ca94-0000-00015dbec131
[0m18:01:16.834920 [debug] [Thread-3  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 11 at position 12 unexpected '$oid'.
syntax error line 15 at position 34 unexpected '$date'.
syntax error line 16 at position 32 unexpected '$date'.
syntax error line 17 at position 32 unexpected '$date'.
syntax error line 18 at position 39 unexpected '$date'.
syntax error line 19 at position 34 unexpected '$date'.
syntax error line 20 at position 33 unexpected '$date'.
[0m18:01:16.842689 [debug] [Thread-3  ]: Database Error in model staging_receipts (models/staging/staging_receipts.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 12 unexpected '$oid'.
  syntax error line 15 at position 34 unexpected '$date'.
  syntax error line 16 at position 32 unexpected '$date'.
  syntax error line 17 at position 32 unexpected '$date'.
  syntax error line 18 at position 39 unexpected '$date'.
  syntax error line 19 at position 34 unexpected '$date'.
  syntax error line 20 at position 33 unexpected '$date'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipts.sql
[0m18:01:16.843255 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15411a160>]}
[0m18:01:16.843894 [error] [Thread-3  ]: 3 of 4 ERROR creating sql table model PUBLIC_staging.staging_receipts .......... [[31mERROR[0m in 0.69s]
[0m18:01:16.844438 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:01:16.844880 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_receipts' to be skipped because of status 'error'.  Reason: Database Error in model staging_receipts (models/staging/staging_receipts.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 12 unexpected '$oid'.
  syntax error line 15 at position 34 unexpected '$date'.
  syntax error line 16 at position 32 unexpected '$date'.
  syntax error line 17 at position 32 unexpected '$date'.
  syntax error line 18 at position 39 unexpected '$date'.
  syntax error line 19 at position 34 unexpected '$date'.
  syntax error line 20 at position 33 unexpected '$date'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipts.sql.
[0m18:01:18.052941 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.809 seconds
[0m18:01:18.087529 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10270fd90>]}
[0m18:01:18.088486 [info ] [Thread-1  ]: 1 of 4 OK created sql table model PUBLIC_staging.staging_brands ................ [[32mSUCCESS 1[0m in 1.93s]
[0m18:01:18.089187 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:01:18.092217 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.848 seconds
[0m18:01:18.094586 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b2c4e01-b0f2-4ff5-ab4f-7563a5dc9767', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15414b9a0>]}
[0m18:01:18.095186 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.94s]
[0m18:01:18.095929 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:01:18.097237 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:01:18.097556 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:01:18.097859 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:01:18.187818 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:01:18.188401 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:01:18.279019 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:01:18.280016 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:01:18.368563 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:01:18.369654 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:01:18.482509 [info ] [MainThread]: 
[0m18:01:18.483369 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 3.44 seconds (3.44s).
[0m18:01:18.485339 [debug] [MainThread]: Command end result
[0m18:01:18.522231 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:01:18.523788 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:01:18.530189 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:01:18.530487 [info ] [MainThread]: 
[0m18:01:18.530829 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m18:01:18.531112 [info ] [MainThread]: 
[0m18:01:18.531453 [error] [MainThread]:   Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  002003 (02000): SQL compilation error:
  Database 'RAW_FETCH_EXCERCISE' does not exist or not authorized.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m18:01:18.531730 [info ] [MainThread]: 
[0m18:01:18.532054 [error] [MainThread]:   Database Error in model staging_receipts (models/staging/staging_receipts.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 12 unexpected '$oid'.
  syntax error line 15 at position 34 unexpected '$date'.
  syntax error line 16 at position 32 unexpected '$date'.
  syntax error line 17 at position 32 unexpected '$date'.
  syntax error line 18 at position 39 unexpected '$date'.
  syntax error line 19 at position 34 unexpected '$date'.
  syntax error line 20 at position 33 unexpected '$date'.
  compiled code at target/run/fetch_analytics/models/staging/staging_receipts.sql
[0m18:01:18.532333 [info ] [MainThread]: 
[0m18:01:18.532609 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=0 TOTAL=4
[0m18:01:18.534886 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.675809, "process_in_blocks": "0", "process_kernel_time": 0.648613, "process_mem_max_rss": "172457984", "process_out_blocks": "0", "process_user_time": 3.35044}
[0m18:01:18.535205 [debug] [MainThread]: Command `dbt run` failed at 18:01:18.535141 after 4.68 seconds
[0m18:01:18.535502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b6be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f77100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e7abb0>]}
[0m18:01:18.535797 [debug] [MainThread]: Flushing usage events
[0m18:01:18.630870 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:04:06.036706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103027eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ed6fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ed6c40>]}


============================== 18:04:06.039983 | bcc5f125-d843-4406-9334-d11ef4692286 ==============================
[0m18:04:06.039983 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:04:06.040356 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m18:04:06.723862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191a6dc0>]}
[0m18:04:06.755991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103942070>]}
[0m18:04:06.756665 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:04:06.879356 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:04:06.965756 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m18:04:06.966180 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_receipt_items.sql
[0m18:04:06.966418 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_receipts.sql
[0m18:04:07.110032 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m18:04:07.118707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1197de130>]}
[0m18:04:07.168854 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:04:07.172641 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:04:07.185354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195da310>]}
[0m18:04:07.185687 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:04:07.185893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195dfd90>]}
[0m18:04:07.186718 [info ] [MainThread]: 
[0m18:04:07.186938 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:04:07.187109 [info ] [MainThread]: 
[0m18:04:07.187407 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:04:07.190674 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:04:07.286540 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:04:07.286812 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:04:07.286985 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:04:07.902651 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.616 seconds
[0m18:04:07.904536 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:04:07.913007 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:04:07.913326 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:04:08.030762 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.117 seconds
[0m18:04:08.034015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10218ce50>]}
[0m18:04:08.037517 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:04:08.037996 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:04:08.038993 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:04:08.038616 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:04:08.039622 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:04:08.040167 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:04:08.040806 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:04:08.041404 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:04:08.041970 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:04:08.042551 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:04:08.043063 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:04:08.043471 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:04:08.044523 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:04:08.045519 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:04:08.046447 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:04:08.057428 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:04:08.057875 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:04:08.060140 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:04:08.064008 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:04:08.066963 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:04:08.067937 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:04:08.091613 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:04:08.092440 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:04:08.094363 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:04:08.094646 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:04:08.096626 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:04:08.096936 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:04:08.098832 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:04:08.100306 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:04:08.100556 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        get(parse_json(_id), 'oid')::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        get(parse_json(cpg), 'ref')::string as cpg_ref,
        get(parse_json(get(parse_json(cpg), 'id')), 'oid')::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:04:08.101252 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:04:08.102319 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:04:08.103915 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:04:08.104249 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:04:08.104538 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:04:08.104893 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (select
    r.variant_col:"_id"."$oid"::string as receipt_id,
    i.value:"barcode"::string as barcode,
    i.value:"description"::string as description,
    i.value:"finalPrice"::string as final_price,
    i.value:"itemPrice"::string as item_price,
    i.value:"needsFetchReview"::boolean as needs_fetch_review,
    i.value:"partnerItemId"::string as partner_item_id,
    i.value:"preventTargetGapPoints"::boolean as prevent_target_gap_points,
    i.value:"quantityPurchased"::number as quantity_purchased,
    i.value:"userFlaggedBarcode"::string as user_flagged_barcode,
    i.value:"userFlaggedNewItem"::boolean as user_flagged_new_item,
    i.value:"userFlaggedPrice"::string as user_flagged_price,
    i.value:"userFlaggedQuantity"::number as user_flagged_quantity,
    i.value:"needsFetchReviewReason"::string as needs_fetch_review_reason,
    i.value:"pointsNotAwardedReason"::string as points_not_awarded_reason,
    i.value:"pointsPayerId"::string as points_payer_id,
    i.value:"rewardsGroup"::string as rewards_group,
    i.value:"rewardsProductPartnerId"::string as rewards_product_partner_id,
    i.value:"userFlaggedDescription"::string as user_flagged_description,
    i.value:"originalMetaBriteBarcode"::string as original_meta_brite_barcode,
    i.value:"originalMetaBriteDescription"::string as original_meta_brite_description,
    i.value:"brandCode"::string as brand_code,
    i.value:"competitorRewardsGroup"::string as competitor_rewards_group,
    i.value:"discountedItemPrice"::string as discounted_item_price,
    i.value:"originalReceiptItemText"::string as original_receipt_item_text,
    i.value:"itemNumber"::string as item_number,
    i.value:"originalMetaBriteQuantityPurchased"::number as original_meta_brite_quantity_purchased,
    i.value:"pointsEarned"::string as points_earned,
    i.value:"targetPrice"::string as target_price,
    i.value:"competitiveProduct"::string as competitive_product,
    i.value:"originalFinalPrice"::string as original_final_price,
    i.value:"originalMetaBriteItemPrice"::string as original_meta_brite_item_price,
    i.value:"deleted"::boolean as deleted,
    i.value:"priceAfterCoupon"::string as price_after_coupon,
    i.value:"metabriteCampaignId"::string as metabrite_campaign_id
from
    raw.public.receipts r,
    lateral flatten(input => r.variant_col:"rewardsReceiptItemList") i
        );
[0m18:04:08.105292 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:04:08.105534 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:04:08.105746 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:04:08.889395 [debug] [Thread-2  ]: Snowflake adapter: Snowflake query id: 01bb13ac-0000-ca20-0000-00015dbef0f9
[0m18:04:08.889737 [debug] [Thread-2  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 4 at position 4
invalid identifier 'R.VARIANT_COL'
[0m18:04:08.895105 [debug] [Thread-2  ]: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  000904 (42000): SQL compilation error: error line 4 at position 4
  invalid identifier 'R.VARIANT_COL'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m18:04:08.896461 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031b2b80>]}
[0m18:04:08.896881 [error] [Thread-2  ]: 2 of 4 ERROR creating sql table model PUBLIC_staging.staging_receipt_items ..... [[31mERROR[0m in 0.85s]
[0m18:04:08.897238 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:04:08.897562 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_receipt_items' to be skipped because of status 'error'.  Reason: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  000904 (42000): SQL compilation error: error line 4 at position 4
  invalid identifier 'R.VARIANT_COL'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql.
[0m18:04:09.126071 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.023 seconds
[0m18:04:09.163243 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101ea1dc0>]}
[0m18:04:09.164112 [info ] [Thread-1  ]: 1 of 4 OK created sql table model PUBLIC_staging.staging_brands ................ [[32mSUCCESS 1[0m in 1.12s]
[0m18:04:09.164717 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:04:09.676675 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.571 seconds
[0m18:04:09.683083 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119e3ae50>]}
[0m18:04:09.684331 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.64s]
[0m18:04:09.685301 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:04:10.086440 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.981 seconds
[0m18:04:10.093641 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bcc5f125-d843-4406-9334-d11ef4692286', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119e45400>]}
[0m18:04:10.094923 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 2.05s]
[0m18:04:10.095901 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:04:10.097967 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:04:10.098559 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:04:10.099085 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:04:10.194729 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:04:10.195615 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:04:10.280652 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:04:10.281493 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:04:10.367081 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:04:10.368169 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:04:10.455089 [info ] [MainThread]: 
[0m18:04:10.455714 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 3.27 seconds (3.27s).
[0m18:04:10.456940 [debug] [MainThread]: Command end result
[0m18:04:10.480000 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:04:10.481625 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:04:10.486810 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:04:10.487067 [info ] [MainThread]: 
[0m18:04:10.487322 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:04:10.487540 [info ] [MainThread]: 
[0m18:04:10.487808 [error] [MainThread]:   Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  000904 (42000): SQL compilation error: error line 4 at position 4
  invalid identifier 'R.VARIANT_COL'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m18:04:10.488015 [info ] [MainThread]: 
[0m18:04:10.488238 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:04:10.490094 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.496649, "process_in_blocks": "0", "process_kernel_time": 0.71558, "process_mem_max_rss": "168787968", "process_out_blocks": "0", "process_user_time": 3.136786}
[0m18:04:10.490384 [debug] [MainThread]: Command `dbt run` failed at 18:04:10.490329 after 4.50 seconds
[0m18:04:10.490638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103027eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191a6dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195daac0>]}
[0m18:04:10.490884 [debug] [MainThread]: Flushing usage events
[0m18:04:10.593009 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:12:25.678692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10507cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f2a0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f2acd0>]}


============================== 18:12:25.681841 | f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2 ==============================
[0m18:12:25.681841 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:12:25.682196 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m18:12:26.360064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104152880>]}
[0m18:12:26.391779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117765be0>]}
[0m18:12:26.392426 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:12:26.522708 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:12:26.607442 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:12:26.607709 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:12:26.611554 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m18:12:26.632139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126415130>]}
[0m18:12:26.684696 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:12:26.687508 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:12:26.701853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1263ce160>]}
[0m18:12:26.702176 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:12:26.702386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1262fd3a0>]}
[0m18:12:26.703261 [info ] [MainThread]: 
[0m18:12:26.703496 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:12:26.703664 [info ] [MainThread]: 
[0m18:12:26.703949 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:12:26.706748 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:12:26.743411 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:12:26.743668 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:12:26.743839 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:12:27.873258 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.129 seconds
[0m18:12:27.877331 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:12:27.894605 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:12:27.895086 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:12:28.067370 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.172 seconds
[0m18:12:28.072106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1177c2a00>]}
[0m18:12:28.077690 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:12:28.078372 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:12:28.078887 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:12:28.079987 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:12:28.079565 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:12:28.080958 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:12:28.081625 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:12:28.082296 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:12:28.082913 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:12:28.083547 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:12:28.084131 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:12:28.084704 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:12:28.085178 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:12:28.085634 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:12:28.086074 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:12:28.086510 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:12:28.098633 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:12:28.101306 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:12:28.105819 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:12:28.109230 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:12:28.110603 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:12:28.110960 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:12:28.111322 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:12:28.111618 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:12:28.147112 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:12:28.148834 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:12:28.150833 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:12:28.153269 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:12:28.154677 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:12:28.154965 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:12:28.155280 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:12:28.156503 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:12:28.158086 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:12:28.158332 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        get(parse_json(_id), 'oid')::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        get(parse_json(cpg), 'ref')::string as cpg_ref,
        get(parse_json(get(parse_json(cpg), 'id')), 'oid')::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:12:28.159024 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:12:28.159370 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (select
    r.variant_col:"_id"."$oid"::string as receipt_id,
    i.value:"barcode"::string as barcode,
    i.value:"description"::string as description,
    i.value:"finalPrice"::string as final_price,
    i.value:"itemPrice"::string as item_price,
    i.value:"needsFetchReview"::boolean as needs_fetch_review,
    i.value:"partnerItemId"::string as partner_item_id,
    i.value:"preventTargetGapPoints"::boolean as prevent_target_gap_points,
    i.value:"quantityPurchased"::number as quantity_purchased,
    i.value:"userFlaggedBarcode"::string as user_flagged_barcode,
    i.value:"userFlaggedNewItem"::boolean as user_flagged_new_item,
    i.value:"userFlaggedPrice"::string as user_flagged_price,
    i.value:"userFlaggedQuantity"::number as user_flagged_quantity,
    i.value:"needsFetchReviewReason"::string as needs_fetch_review_reason,
    i.value:"pointsNotAwardedReason"::string as points_not_awarded_reason,
    i.value:"pointsPayerId"::string as points_payer_id,
    i.value:"rewardsGroup"::string as rewards_group,
    i.value:"rewardsProductPartnerId"::string as rewards_product_partner_id,
    i.value:"userFlaggedDescription"::string as user_flagged_description,
    i.value:"originalMetaBriteBarcode"::string as original_meta_brite_barcode,
    i.value:"originalMetaBriteDescription"::string as original_meta_brite_description,
    i.value:"brandCode"::string as brand_code,
    i.value:"competitorRewardsGroup"::string as competitor_rewards_group,
    i.value:"discountedItemPrice"::string as discounted_item_price,
    i.value:"originalReceiptItemText"::string as original_receipt_item_text,
    i.value:"itemNumber"::string as item_number,
    i.value:"originalMetaBriteQuantityPurchased"::number as original_meta_brite_quantity_purchased,
    i.value:"pointsEarned"::string as points_earned,
    i.value:"targetPrice"::string as target_price,
    i.value:"competitiveProduct"::string as competitive_product,
    i.value:"originalFinalPrice"::string as original_final_price,
    i.value:"originalMetaBriteItemPrice"::string as original_meta_brite_item_price,
    i.value:"deleted"::boolean as deleted,
    i.value:"priceAfterCoupon"::string as price_after_coupon,
    i.value:"metabriteCampaignId"::string as metabrite_campaign_id
from
    raw.public.receipts r,
    lateral flatten(input => r.variant_col:"rewardsReceiptItemList") i
        );
[0m18:12:28.160155 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:12:28.160433 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:12:28.160648 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:12:29.243802 [debug] [Thread-2  ]: Snowflake adapter: Snowflake query id: 01bb13b4-0000-ca41-0001-5dbe0001006a
[0m18:12:29.244223 [debug] [Thread-2  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 4 at position 4
invalid identifier 'R.VARIANT_COL'
[0m18:12:29.251216 [debug] [Thread-2  ]: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  000904 (42000): SQL compilation error: error line 4 at position 4
  invalid identifier 'R.VARIANT_COL'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m18:12:29.252755 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f79310>]}
[0m18:12:29.253246 [error] [Thread-2  ]: 2 of 4 ERROR creating sql table model PUBLIC_staging.staging_receipt_items ..... [[31mERROR[0m in 1.17s]
[0m18:12:29.253670 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:12:29.254075 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_receipt_items' to be skipped because of status 'error'.  Reason: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  000904 (42000): SQL compilation error: error line 4 at position 4
  invalid identifier 'R.VARIANT_COL'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql.
[0m18:12:29.258064 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.097 seconds
[0m18:12:29.275576 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ef7df0>]}
[0m18:12:29.276071 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.19s]
[0m18:12:29.276437 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:12:29.700466 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.540 seconds
[0m18:12:29.705932 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e3d6d0>]}
[0m18:12:29.707079 [info ] [Thread-1  ]: 1 of 4 OK created sql table model PUBLIC_staging.staging_brands ................ [[32mSUCCESS 1[0m in 1.62s]
[0m18:12:29.708027 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:12:30.112229 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.957 seconds
[0m18:12:30.117805 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f88055c4-c59b-47bd-b1c1-8fa0f3f36ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e6c280>]}
[0m18:12:30.118949 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 2.03s]
[0m18:12:30.119900 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:12:30.121843 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:12:30.122341 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:12:30.122804 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:12:30.248905 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:12:30.249398 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:12:30.328306 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:12:30.328904 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:12:30.589854 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:12:30.590804 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:12:30.686150 [info ] [MainThread]: 
[0m18:12:30.687037 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 3.98 seconds (3.98s).
[0m18:12:30.688997 [debug] [MainThread]: Command end result
[0m18:12:30.724558 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:12:30.726154 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:12:30.732977 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:12:30.733292 [info ] [MainThread]: 
[0m18:12:30.733621 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:12:30.733900 [info ] [MainThread]: 
[0m18:12:30.734236 [error] [MainThread]:   Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  000904 (42000): SQL compilation error: error line 4 at position 4
  invalid identifier 'R.VARIANT_COL'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m18:12:30.734510 [info ] [MainThread]: 
[0m18:12:30.734793 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:12:30.737299 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.1035986, "process_in_blocks": "0", "process_kernel_time": 0.957067, "process_mem_max_rss": "165888000", "process_out_blocks": "0", "process_user_time": 2.976313}
[0m18:12:30.737661 [debug] [MainThread]: Command `dbt run` failed at 18:12:30.737587 after 5.10 seconds
[0m18:12:30.737993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10507cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1263ce160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e3dd90>]}
[0m18:12:30.738323 [debug] [MainThread]: Flushing usage events
[0m18:12:31.016716 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:13:01.844026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102bf8e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103aa6f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103aa6bb0>]}


============================== 18:13:01.847113 | 03a07487-c773-4e48-bab6-a416fd6f1f07 ==============================
[0m18:13:01.847113 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:13:01.847576 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:13:02.525706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a698b0>]}
[0m18:13:02.557218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102fa5b20>]}
[0m18:13:02.557816 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:13:02.683462 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:13:02.768024 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:13:02.768435 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_receipt_items.sql
[0m18:13:02.908203 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m18:13:02.916954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134ae2130>]}
[0m18:13:02.977204 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:13:02.985592 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:13:03.009258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13491be20>]}
[0m18:13:03.009636 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:13:03.009845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10277beb0>]}
[0m18:13:03.010724 [info ] [MainThread]: 
[0m18:13:03.010945 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:13:03.011111 [info ] [MainThread]: 
[0m18:13:03.011410 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:13:03.014525 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:13:03.085499 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:13:03.085753 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:13:03.085920 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:13:03.953713 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.868 seconds
[0m18:13:03.955943 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:13:03.965471 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:13:03.965821 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:13:04.063678 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.098 seconds
[0m18:13:04.066756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101d5ddc0>]}
[0m18:13:04.070755 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:13:04.071238 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:13:04.072188 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:13:04.071830 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:13:04.072732 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:13:04.073237 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:13:04.073818 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:13:04.074355 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:13:04.074885 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:13:04.075414 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:13:04.075851 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:13:04.076190 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:13:04.076612 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:13:04.076948 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:13:04.077279 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:13:04.087162 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:13:04.087685 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:13:04.091056 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:13:04.093913 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:13:04.097403 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:13:04.098163 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:13:04.111095 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:13:04.126640 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:13:04.126941 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:13:04.134269 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:13:04.134566 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:13:04.136471 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:13:04.138344 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:13:04.139143 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:13:04.141123 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:13:04.141417 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        get(parse_json(_id), 'oid')::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        get(parse_json(cpg), 'ref')::string as cpg_ref,
        get(parse_json(get(parse_json(cpg), 'id')), 'oid')::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:13:04.142171 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:13:04.142453 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => r.rewardsReceiptItemList) i
        );
[0m18:13:04.143667 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:13:04.143998 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:13:04.144258 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:13:04.144618 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:13:04.144898 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:13:04.145554 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:13:04.626710 [debug] [Thread-2  ]: Snowflake adapter: Snowflake query id: 01bb13b5-0000-ca1f-0000-00015dbeb159
[0m18:13:04.627110 [debug] [Thread-2  ]: Snowflake adapter: Snowflake error: 001007 (22023): SQL compilation error:
invalid type [VARCHAR(16777216)] for parameter 'input'
[0m18:13:04.633432 [debug] [Thread-2  ]: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  001007 (22023): SQL compilation error:
  invalid type [VARCHAR(16777216)] for parameter 'input'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m18:13:04.635002 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135252070>]}
[0m18:13:04.635501 [error] [Thread-2  ]: 2 of 4 ERROR creating sql table model PUBLIC_staging.staging_receipt_items ..... [[31mERROR[0m in 0.56s]
[0m18:13:04.635925 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:13:04.636298 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_receipt_items' to be skipped because of status 'error'.  Reason: Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  001007 (22023): SQL compilation error:
  invalid type [VARCHAR(16777216)] for parameter 'input'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql.
[0m18:13:04.821404 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.678 seconds
[0m18:13:04.857874 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101a71d30>]}
[0m18:13:04.858678 [info ] [Thread-1  ]: 1 of 4 OK created sql table model PUBLIC_staging.staging_brands ................ [[32mSUCCESS 1[0m in 0.78s]
[0m18:13:04.859282 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:13:05.442970 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.298 seconds
[0m18:13:05.450523 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135299e50>]}
[0m18:13:05.452053 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.37s]
[0m18:13:05.453151 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:13:05.460940 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.315 seconds
[0m18:13:05.465164 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03a07487-c773-4e48-bab6-a416fd6f1f07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1352a9fd0>]}
[0m18:13:05.466525 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.39s]
[0m18:13:05.467775 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:13:05.469592 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:13:05.470019 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:13:05.470410 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:13:05.548805 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:13:05.549751 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:13:05.643748 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:13:05.644728 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:13:05.735094 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:13:05.735858 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:13:05.822188 [info ] [MainThread]: 
[0m18:13:05.823099 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 2.81 seconds (2.81s).
[0m18:13:05.825067 [debug] [MainThread]: Command end result
[0m18:13:05.862888 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:13:05.865016 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:13:05.871715 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:13:05.872024 [info ] [MainThread]: 
[0m18:13:05.872362 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:13:05.872652 [info ] [MainThread]: 
[0m18:13:05.872999 [error] [MainThread]:   Database Error in model staging_receipt_items (models/staging/staging_receipt_items.sql)
  001007 (22023): SQL compilation error:
  invalid type [VARCHAR(16777216)] for parameter 'input'
  compiled code at target/run/fetch_analytics/models/staging/staging_receipt_items.sql
[0m18:13:05.873276 [info ] [MainThread]: 
[0m18:13:05.873553 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:13:05.875872 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.0786905, "process_in_blocks": "0", "process_kernel_time": 0.602386, "process_mem_max_rss": "171671552", "process_out_blocks": "0", "process_user_time": 3.317226}
[0m18:13:05.876239 [debug] [MainThread]: Command `dbt run` failed at 18:13:05.876164 after 4.08 seconds
[0m18:13:05.876570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102bf8e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13491b820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135243910>]}
[0m18:13:05.876903 [debug] [MainThread]: Flushing usage events
[0m18:13:05.949033 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:17:44.610878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107427eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082d6070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082d6cd0>]}


============================== 18:17:44.614036 | 10748db8-f338-4730-8e30-9582563af743 ==============================
[0m18:17:44.614036 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:17:44.614399 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:17:45.236509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082a5eb0>]}
[0m18:17:45.267895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e8ac5e0>]}
[0m18:17:45.268423 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:17:45.391510 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:17:45.476553 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:17:45.476933 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_receipt_items.sql
[0m18:17:45.618598 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m18:17:45.627427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11efe0130>]}
[0m18:17:45.677460 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:17:45.680209 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:17:45.694173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11efb4550>]}
[0m18:17:45.694490 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:17:45.694687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f0149d0>]}
[0m18:17:45.695559 [info ] [MainThread]: 
[0m18:17:45.695813 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:17:45.695989 [info ] [MainThread]: 
[0m18:17:45.696282 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:17:45.699129 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:17:45.773398 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:17:45.773663 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:17:45.773829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:17:46.853297 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.079 seconds
[0m18:17:46.858424 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:17:46.875408 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:17:46.875943 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:17:47.006032 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.129 seconds
[0m18:17:47.012402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10658ce50>]}
[0m18:17:47.017042 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:17:47.017721 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:17:47.019081 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:17:47.018569 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:17:47.019839 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:17:47.020564 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:17:47.021404 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:17:47.022178 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:17:47.022912 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:17:47.023600 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:17:47.024224 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:17:47.024694 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:17:47.025654 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:17:47.026158 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:17:47.026635 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:17:47.039668 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:17:47.039289 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:17:47.044148 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:17:47.047671 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:17:47.052107 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:17:47.053803 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:17:47.054227 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:17:47.088505 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:17:47.093263 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:17:47.093553 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:17:47.093907 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:17:47.096062 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:17:47.098265 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:17:47.101020 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:17:47.101796 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:17:47.102194 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:17:47.102555 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        get(parse_json(_id), 'oid')::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        get(parse_json(cpg), 'ref')::string as cpg_ref,
        get(parse_json(get(parse_json(cpg), 'id')), 'oid')::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:17:47.103702 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:17:47.103940 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:17:47.104260 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:17:47.104902 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:17:47.109717 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:17:47.110734 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:17:47.110993 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:17:48.115562 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.004 seconds
[0m18:17:48.155876 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f6d3f70>]}
[0m18:17:48.156631 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.13s]
[0m18:17:48.157216 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:17:48.676814 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.572 seconds
[0m18:17:48.681071 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f777e50>]}
[0m18:17:48.682423 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.578 seconds
[0m18:17:48.683519 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.66s]
[0m18:17:48.687233 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f743b80>]}
[0m18:17:48.688114 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:17:48.689042 [info ] [Thread-1  ]: 1 of 4 OK created sql table model PUBLIC_staging.staging_brands ................ [[32mSUCCESS 1[0m in 1.67s]
[0m18:17:48.690505 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:17:48.797121 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 1.693 seconds
[0m18:17:48.799992 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10748db8-f338-4730-8e30-9582563af743', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f7010d0>]}
[0m18:17:48.800819 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 1.78s]
[0m18:17:48.801493 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:17:48.802813 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:17:48.803185 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:17:48.803509 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:17:48.887190 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:17:48.887957 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:17:48.963324 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:17:48.964087 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:17:49.056668 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:17:49.057688 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:17:49.141772 [info ] [MainThread]: 
[0m18:17:49.142742 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 3.45 seconds (3.45s).
[0m18:17:49.145100 [debug] [MainThread]: Command end result
[0m18:17:49.182849 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:17:49.184619 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:17:49.191473 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:17:49.191775 [info ] [MainThread]: 
[0m18:17:49.192134 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:17:49.192405 [info ] [MainThread]: 
[0m18:17:49.192685 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:17:49.195214 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6295123, "process_in_blocks": "0", "process_kernel_time": 0.65467, "process_mem_max_rss": "171540480", "process_out_blocks": "0", "process_user_time": 3.290507}
[0m18:17:49.195662 [debug] [MainThread]: Command `dbt run` succeeded at 18:17:49.195561 after 4.63 seconds
[0m18:17:49.196018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107427eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e8ac5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11efb4e80>]}
[0m18:17:49.196373 [debug] [MainThread]: Flushing usage events
[0m18:17:49.414204 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:31:46.164930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b0feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059befd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059bec40>]}


============================== 18:31:46.168209 | 16440c52-65b1-424d-9b49-966c26ac5e81 ==============================
[0m18:31:46.168209 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:31:46.168580 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m18:31:46.906590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11afcadc0>]}
[0m18:31:46.940041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10542a070>]}
[0m18:31:46.940792 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:31:47.064396 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:31:47.151909 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:31:47.152349 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m18:31:47.292829 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m18:31:47.301581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b6e0130>]}
[0m18:31:47.351575 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:31:47.353811 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:31:47.366709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10468c0a0>]}
[0m18:31:47.367061 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:31:47.367259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b002670>]}
[0m18:31:47.368083 [info ] [MainThread]: 
[0m18:31:47.368302 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:31:47.368471 [info ] [MainThread]: 
[0m18:31:47.368758 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:31:47.371577 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:31:47.447031 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:31:47.447303 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:31:47.447476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:31:48.356736 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.909 seconds
[0m18:31:48.361071 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:31:48.368404 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:31:48.368636 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:31:48.486145 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.117 seconds
[0m18:31:48.491702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c74e50>]}
[0m18:31:48.494148 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:31:48.494401 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:31:48.494625 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:31:48.495139 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:31:48.494958 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:31:48.495468 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:31:48.495717 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:31:48.496279 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:31:48.496002 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:31:48.496597 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:31:48.496847 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:31:48.497056 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:31:48.497306 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:31:48.497505 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:31:48.497700 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:31:48.503654 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:31:48.504159 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:31:48.506497 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:31:48.509307 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:31:48.511311 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:31:48.512014 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:31:48.533906 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:31:48.534243 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:31:48.534473 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:31:48.534683 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:31:48.537104 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:31:48.540649 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:31:48.543163 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:31:48.544243 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:31:48.545364 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
       _id:"$oid"::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        cpg:$ref::string as cpg_ref,
        cpg:$id:$oid::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:31:48.546932 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:31:48.548992 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:31:48.549432 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:31:48.549906 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:31:48.550727 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:31:48.550954 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:31:48.551448 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:31:48.551736 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:31:48.552601 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:31:48.676147 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb13c7-0000-ca4b-0000-00015dbea18d
[0m18:31:48.676436 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 22 at position 12 unexpected '$ref'.
syntax error line 23 at position 12 unexpected '$id'.
syntax error line 23 at position 16 unexpected '$oid'.
[0m18:31:48.681461 [debug] [Thread-1  ]: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 12 unexpected '$ref'.
  syntax error line 23 at position 12 unexpected '$id'.
  syntax error line 23 at position 16 unexpected '$oid'.
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:31:48.682682 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bf2ce20>]}
[0m18:31:48.683104 [error] [Thread-1  ]: 1 of 4 ERROR creating sql table model PUBLIC_staging.staging_brands ............ [[31mERROR[0m in 0.19s]
[0m18:31:48.683512 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:31:48.683842 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_brands' to be skipped because of status 'error'.  Reason: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 12 unexpected '$ref'.
  syntax error line 23 at position 12 unexpected '$id'.
  syntax error line 23 at position 16 unexpected '$oid'.
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql.
[0m18:31:49.785530 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.234 seconds
[0m18:31:49.794837 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.242 seconds
[0m18:31:49.811687 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10398bdc0>]}
[0m18:31:49.812779 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bf7aca0>]}
[0m18:31:49.813246 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.31s]
[0m18:31:49.813888 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:31:49.813509 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.32s]
[0m18:31:49.814317 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:31:50.712318 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 2.160 seconds
[0m18:31:50.716822 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '16440c52-65b1-424d-9b49-966c26ac5e81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bee1d90>]}
[0m18:31:50.717550 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 2.22s]
[0m18:31:50.718009 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:31:50.719217 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:31:50.719407 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:31:50.719581 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:31:50.794462 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:31:50.794795 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:31:50.878321 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:31:50.879123 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:31:51.015517 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:31:51.016583 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:31:51.098675 [info ] [MainThread]: 
[0m18:31:51.099804 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 3.73 seconds (3.73s).
[0m18:31:51.100780 [debug] [MainThread]: Command end result
[0m18:31:51.117410 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:31:51.120009 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:31:51.124886 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:31:51.125107 [info ] [MainThread]: 
[0m18:31:51.125342 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:31:51.125528 [info ] [MainThread]: 
[0m18:31:51.125752 [error] [MainThread]:   Database Error in model staging_brands (models/staging/staging_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 12 unexpected '$ref'.
  syntax error line 23 at position 12 unexpected '$id'.
  syntax error line 23 at position 16 unexpected '$oid'.
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:31:51.125932 [info ] [MainThread]: 
[0m18:31:51.126129 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:31:51.128235 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.0104303, "process_in_blocks": "0", "process_kernel_time": 0.725361, "process_mem_max_rss": "166969344", "process_out_blocks": "0", "process_user_time": 3.089626}
[0m18:31:51.128501 [debug] [MainThread]: Command `dbt run` failed at 18:31:51.128454 after 5.01 seconds
[0m18:31:51.128759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b0feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b50ee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c94a00>]}
[0m18:31:51.128983 [debug] [MainThread]: Flushing usage events
[0m18:31:51.370652 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:33:08.185162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10376feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10461efd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10461ec40>]}


============================== 18:33:08.188195 | 15cb79cd-a68d-42db-aa1b-66b143821bb5 ==============================
[0m18:33:08.188195 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:33:08.188549 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:33:08.827406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc0adc0>]}
[0m18:33:08.859847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10408a070>]}
[0m18:33:08.860504 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:33:09.091432 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:33:09.176907 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:33:09.177306 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m18:33:09.316609 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m18:33:09.325353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c421130>]}
[0m18:33:09.376904 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:33:09.380459 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:33:09.394479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032ec0a0>]}
[0m18:33:09.394846 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:33:09.395053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fc42670>]}
[0m18:33:09.395879 [info ] [MainThread]: 
[0m18:33:09.396092 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:33:09.396260 [info ] [MainThread]: 
[0m18:33:09.396543 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:33:09.399392 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:33:09.478328 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:33:09.478585 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:33:09.478754 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:33:10.115357 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.636 seconds
[0m18:33:10.120211 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:33:10.137891 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:33:10.138433 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:33:10.239193 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.100 seconds
[0m18:33:10.245711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028d4e50>]}
[0m18:33:10.249865 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:33:10.250558 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:33:10.251413 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:33:10.252172 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:33:10.253006 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:33:10.253696 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:33:10.254347 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:33:10.255095 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:33:10.255906 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:33:10.256615 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:33:10.257318 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:33:10.258000 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:33:10.258519 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:33:10.259147 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:33:10.272385 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:33:10.272913 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:33:10.277162 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:33:10.277670 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:33:10.282793 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:33:10.286683 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:33:10.287125 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:33:10.317722 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:33:10.318180 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:33:10.318516 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:33:10.318782 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:33:10.321017 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:33:10.323089 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:33:10.325198 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:33:10.326113 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:33:10.326563 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        get(parse_json(_id), 'oid')::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        get(parse_json(cpg), '$ref')::string as cpg_ref,
        get(get(parse_json(cpg), '$id'), 'oid')::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:33:10.327959 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:33:10.328329 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:33:10.329108 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:33:10.331330 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:33:10.331543 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:33:10.331814 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:33:10.332248 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:33:10.333078 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:33:10.333504 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:33:11.198831 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.870 seconds
[0m18:33:11.219577 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cb21880>]}
[0m18:33:11.220109 [info ] [Thread-1  ]: 1 of 4 OK created sql table model PUBLIC_staging.staging_brands ................ [[32mSUCCESS 1[0m in 0.96s]
[0m18:33:11.220486 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:33:11.414300 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.081 seconds
[0m18:33:11.420131 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cbd0610>]}
[0m18:33:11.420872 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.16s]
[0m18:33:11.421415 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:33:11.774570 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 1.441 seconds
[0m18:33:11.779769 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cbe4eb0>]}
[0m18:33:11.781349 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 1.52s]
[0m18:33:11.782503 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:33:11.870089 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.538 seconds
[0m18:33:11.875241 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15cb79cd-a68d-42db-aa1b-66b143821bb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cbb6370>]}
[0m18:33:11.876633 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.62s]
[0m18:33:11.878113 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:33:11.880541 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:33:11.881099 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:33:11.881605 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:33:11.959523 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:33:11.960234 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:33:12.064461 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:33:12.065649 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:33:12.153931 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:33:12.154889 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:33:12.252854 [info ] [MainThread]: 
[0m18:33:12.254023 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 2.86 seconds (2.86s).
[0m18:33:12.256792 [debug] [MainThread]: Command end result
[0m18:33:12.294192 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:33:12.296964 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:33:12.307846 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:33:12.308191 [info ] [MainThread]: 
[0m18:33:12.309042 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:33:12.309341 [info ] [MainThread]: 
[0m18:33:12.309958 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:33:12.315545 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.1730285, "process_in_blocks": "0", "process_kernel_time": 0.86701, "process_mem_max_rss": "170524672", "process_out_blocks": "0", "process_user_time": 3.098486}
[0m18:33:12.316124 [debug] [MainThread]: Command `dbt run` succeeded at 18:33:12.316027 after 4.17 seconds
[0m18:33:12.316625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10376feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10408a070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032ec0a0>]}
[0m18:33:12.317028 [debug] [MainThread]: Flushing usage events
[0m18:33:12.407147 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:39:52.051719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10520bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060ba0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060bacd0>]}


============================== 18:39:52.054935 | e17929d3-c325-4596-ad45-e2a36c2cbbf3 ==============================
[0m18:39:52.054935 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:39:52.055306 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m18:39:52.665788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042e2880>]}
[0m18:39:52.697248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f165be0>]}
[0m18:39:52.697781 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:39:52.820045 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:39:52.905499 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:39:52.905899 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m18:39:53.045402 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m18:39:53.054172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f89f130>]}
[0m18:39:53.104312 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:39:53.106931 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:39:53.119898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f6dd5b0>]}
[0m18:39:53.120212 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:39:53.120410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f89fe20>]}
[0m18:39:53.121237 [info ] [MainThread]: 
[0m18:39:53.121456 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:39:53.121622 [info ] [MainThread]: 
[0m18:39:53.121905 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:39:53.124737 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:39:53.203102 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:39:53.203390 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:39:53.203569 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:39:54.340738 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.137 seconds
[0m18:39:54.346853 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:39:54.364463 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:39:54.365031 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:39:54.504863 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.139 seconds
[0m18:39:54.511401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f12b6d0>]}
[0m18:39:54.516302 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:39:54.516995 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:39:54.518409 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:39:54.517893 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:39:54.519185 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:39:54.519908 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:39:54.520738 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:39:54.521528 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:39:54.522290 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:39:54.523053 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:39:54.523657 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:39:54.524128 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:39:54.525166 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:39:54.525772 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:39:54.526266 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:39:54.539095 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:39:54.539726 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:39:54.544279 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:39:54.548761 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:39:54.552149 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:39:54.552751 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:39:54.559439 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:39:54.583030 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:39:54.583368 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:39:54.591262 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:39:54.593384 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:39:54.593691 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:39:54.595712 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:39:54.597103 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:39:54.599128 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:39:54.599803 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:39:54.600079 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:39:54.600804 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:39:54.601077 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:39:54.601382 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        _id:"$oid"::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        cpg:"$ref"::string as cpg_ref,
        cpg:"$id"."$oid"::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source;
[0m18:39:54.601618 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:39:54.601846 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:39:54.602061 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:39:54.602637 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:39:54.715105 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb13cf-0000-ca3c-0000-00015dbe8195
[0m18:39:54.715401 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 27 at position 15 unexpected ';'.
[0m18:39:54.720213 [debug] [Thread-1  ]: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 27 at position 15 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:39:54.721421 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ffe6190>]}
[0m18:39:54.721824 [error] [Thread-1  ]: 1 of 4 ERROR creating sql table model PUBLIC_staging.staging_brands ............ [[31mERROR[0m in 0.20s]
[0m18:39:54.722156 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:39:54.722479 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_brands' to be skipped because of status 'error'.  Reason: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 27 at position 15 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql.
[0m18:39:55.678637 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 1.076 seconds
[0m18:39:55.716393 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104086df0>]}
[0m18:39:55.717175 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 1.19s]
[0m18:39:55.717766 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:39:55.792749 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.191 seconds
[0m18:39:55.796836 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13806ed30>]}
[0m18:39:55.797897 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.27s]
[0m18:39:55.798660 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:39:55.832421 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.230 seconds
[0m18:39:55.836390 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e17929d3-c325-4596-ad45-e2a36c2cbbf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ffc5580>]}
[0m18:39:55.837449 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.31s]
[0m18:39:55.838194 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:39:55.839637 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:39:55.840036 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:39:55.840421 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:39:55.930676 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:39:55.931034 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:39:56.016409 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:39:56.017683 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:39:56.109748 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:39:56.110613 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:39:56.196330 [info ] [MainThread]: 
[0m18:39:56.197293 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 3.07 seconds (3.07s).
[0m18:39:56.199898 [debug] [MainThread]: Command end result
[0m18:39:56.237176 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:39:56.238753 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:39:56.245430 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:39:56.245736 [info ] [MainThread]: 
[0m18:39:56.246060 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:39:56.246341 [info ] [MainThread]: 
[0m18:39:56.246669 [error] [MainThread]:   Database Error in model staging_brands (models/staging/staging_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 27 at position 15 unexpected ';'.
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:39:56.246946 [info ] [MainThread]: 
[0m18:39:56.247229 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:39:56.249686 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.242628, "process_in_blocks": "0", "process_kernel_time": 0.535343, "process_mem_max_rss": "170196992", "process_out_blocks": "0", "process_user_time": 3.448782}
[0m18:39:56.250061 [debug] [MainThread]: Command `dbt run` failed at 18:39:56.249977 after 4.24 seconds
[0m18:39:56.250387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10520bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f165be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7b2e0>]}
[0m18:39:56.250728 [debug] [MainThread]: Flushing usage events
[0m18:39:56.411833 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:40:05.877825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076d3eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108582070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108582cd0>]}


============================== 18:40:05.880599 | a789adfe-6d1d-48d7-a514-e58fa7820649 ==============================
[0m18:40:05.880599 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:40:05.880959 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:40:06.365522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108551eb0>]}
[0m18:40:06.396578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11da6b5e0>]}
[0m18:40:06.397184 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:40:06.521690 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:40:06.602770 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:40:06.603156 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m18:40:06.741478 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m18:40:06.750364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e1a0130>]}
[0m18:40:06.801046 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:40:06.803634 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:40:06.817824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e173550>]}
[0m18:40:06.818176 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:40:06.818376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e1d49d0>]}
[0m18:40:06.819254 [info ] [MainThread]: 
[0m18:40:06.819499 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:40:06.819676 [info ] [MainThread]: 
[0m18:40:06.819976 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:40:06.822914 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:40:06.895454 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:40:06.895737 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:40:06.895909 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:40:07.384809 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.489 seconds
[0m18:40:07.389777 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:40:07.406620 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:40:07.407140 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:40:07.759912 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.352 seconds
[0m18:40:07.766207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106838e50>]}
[0m18:40:07.771075 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:40:07.771798 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:40:07.772422 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:40:07.773910 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:40:07.773389 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:40:07.774859 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:40:07.775700 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:40:07.776395 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:40:07.777024 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:40:07.777659 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:40:07.778245 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:40:07.778816 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:40:07.779489 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:40:07.780026 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:40:07.780528 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:40:07.781105 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:40:07.793196 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:40:07.798052 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:40:07.802637 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:40:07.805871 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:40:07.807107 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:40:07.807516 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:40:07.807857 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:40:07.826343 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:40:07.853586 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:40:07.858018 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:40:07.859385 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:40:07.861229 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:40:07.863030 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:40:07.863703 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:40:07.863944 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:40:07.865875 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:40:07.866525 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:40:07.866759 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        _id:"$oid"::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        cpg:"$ref"::string as cpg_ref,
        cpg:"$id"."$oid"::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:40:07.866986 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:40:07.867257 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:40:07.867545 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:40:07.867999 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:40:07.868380 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:40:07.999337 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb13d0-0000-ca4b-0000-00015dbea1ad
[0m18:40:07.999642 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001044 (42P13): SQL compilation error: error line 12 at position 11
Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
[0m18:40:08.005383 [debug] [Thread-1  ]: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:40:08.006918 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e8e18b0>]}
[0m18:40:08.007688 [error] [Thread-1  ]: 1 of 4 ERROR creating sql table model PUBLIC_staging.staging_brands ............ [[31mERROR[0m in 0.23s]
[0m18:40:08.008067 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:40:08.008375 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_brands' to be skipped because of status 'error'.  Reason: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql.
[0m18:40:08.885961 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.019 seconds
[0m18:40:08.925688 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10654fdc0>]}
[0m18:40:08.926550 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.15s]
[0m18:40:08.927484 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.059 seconds
[0m18:40:08.928058 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:40:08.930481 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e8ed400>]}
[0m18:40:08.931207 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.15s]
[0m18:40:08.931754 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:40:09.378946 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 1.511 seconds
[0m18:40:09.385174 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a789adfe-6d1d-48d7-a514-e58fa7820649', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e963eb0>]}
[0m18:40:09.386700 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 1.61s]
[0m18:40:09.387697 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:40:09.389539 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:40:09.390032 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:40:09.390504 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:40:09.497153 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:40:09.498384 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:40:09.588593 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:40:09.589391 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:40:09.684260 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:40:09.685449 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:40:09.767495 [info ] [MainThread]: 
[0m18:40:09.768366 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 2.95 seconds (2.95s).
[0m18:40:09.770310 [debug] [MainThread]: Command end result
[0m18:40:09.805914 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:40:09.807529 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:40:09.813928 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:40:09.814228 [info ] [MainThread]: 
[0m18:40:09.814556 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:40:09.814841 [info ] [MainThread]: 
[0m18:40:09.815170 [error] [MainThread]:   Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:40:09.815442 [info ] [MainThread]: 
[0m18:40:09.815727 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:40:09.817644 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.9812343, "process_in_blocks": "0", "process_kernel_time": 0.782643, "process_mem_max_rss": "168837120", "process_out_blocks": "0", "process_user_time": 3.058167}
[0m18:40:09.817996 [debug] [MainThread]: Command `dbt run` failed at 18:40:09.817924 after 3.98 seconds
[0m18:40:09.818323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076d3eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e173e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066c5730>]}
[0m18:40:09.818658 [debug] [MainThread]: Flushing usage events
[0m18:40:09.887435 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:41:24.306135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072d2eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108182fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108182c40>]}


============================== 18:41:24.309509 | 89445238-61b8-4da2-a8d5-a09202e1a8a3 ==============================
[0m18:41:24.309509 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:41:24.309875 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:41:24.943727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e00adc0>]}
[0m18:41:24.975194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bee070>]}
[0m18:41:24.975863 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:41:25.098531 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:41:25.182904 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:41:25.183168 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:41:25.186855 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m18:41:25.206706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e47e130>]}
[0m18:41:25.258766 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:41:25.261592 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:41:25.275313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e4a0040>]}
[0m18:41:25.275641 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:41:25.275839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e365070>]}
[0m18:41:25.276724 [info ] [MainThread]: 
[0m18:41:25.276944 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:41:25.277114 [info ] [MainThread]: 
[0m18:41:25.277408 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:41:25.280337 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:41:25.317860 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:41:25.318135 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:41:25.318309 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:41:26.195999 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.877 seconds
[0m18:41:26.200822 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:41:26.218108 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:41:26.218670 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:41:26.331798 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.112 seconds
[0m18:41:26.338430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106438e50>]}
[0m18:41:26.343916 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:41:26.344583 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:41:26.345731 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:41:26.346276 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:41:26.345300 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:41:26.347084 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:41:26.347780 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:41:26.348435 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:41:26.349077 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:41:26.349727 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:41:26.350333 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:41:26.350934 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:41:26.351403 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:41:26.352090 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:41:26.352587 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:41:26.353061 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:41:26.365217 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:41:26.369069 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:41:26.373420 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:41:26.376672 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:41:26.378944 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:41:26.391019 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:41:26.397648 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:41:26.397905 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:41:26.412116 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:41:26.416141 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:41:26.418100 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:41:26.420391 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:41:26.421818 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:41:26.422123 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:41:26.424189 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:41:26.424389 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:41:26.424708 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:41:26.425475 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:41:26.425902 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:41:26.426549 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:41:26.427015 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:41:26.427821 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        _id:"$oid"::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        cpg:"$ref"::string as cpg_ref,
        cpg:"$id"."$oid"::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:41:26.428079 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:41:26.630909 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb13d1-0000-ca32-0000-00015dbe2f35
[0m18:41:26.631250 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001044 (42P13): SQL compilation error: error line 12 at position 11
Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
[0m18:41:26.636886 [debug] [Thread-1  ]: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:41:26.638229 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11edceb80>]}
[0m18:41:26.638658 [error] [Thread-1  ]: 1 of 4 ERROR creating sql table model PUBLIC_staging.staging_brands ............ [[31mERROR[0m in 0.29s]
[0m18:41:26.639024 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:41:26.639340 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_brands' to be skipped because of status 'error'.  Reason: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql.
[0m18:41:27.450329 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.025 seconds
[0m18:41:27.489555 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10614fdc0>]}
[0m18:41:27.490410 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.14s]
[0m18:41:27.491026 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:41:27.838500 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 1.412 seconds
[0m18:41:27.843573 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ee21700>]}
[0m18:41:27.845310 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 1.49s]
[0m18:41:27.846444 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:41:27.968854 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.540 seconds
[0m18:41:27.975062 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89445238-61b8-4da2-a8d5-a09202e1a8a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11edbfdc0>]}
[0m18:41:27.976362 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.62s]
[0m18:41:27.977326 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:41:27.979082 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:41:27.979575 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:41:27.980053 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:41:28.063761 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:41:28.065030 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:41:28.154047 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:41:28.154962 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:41:28.253712 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:41:28.254801 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:41:28.336608 [info ] [MainThread]: 
[0m18:41:28.337884 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 3.06 seconds (3.06s).
[0m18:41:28.340210 [debug] [MainThread]: Command end result
[0m18:41:28.377042 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:41:28.378894 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:41:28.385629 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:41:28.385938 [info ] [MainThread]: 
[0m18:41:28.386273 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:41:28.386562 [info ] [MainThread]: 
[0m18:41:28.386898 [error] [MainThread]:   Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:41:28.387175 [info ] [MainThread]: 
[0m18:41:28.387455 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:41:28.389770 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.1282296, "process_in_blocks": "0", "process_kernel_time": 0.59279, "process_mem_max_rss": "169508864", "process_out_blocks": "0", "process_user_time": 3.255224}
[0m18:41:28.390137 [debug] [MainThread]: Command `dbt run` failed at 18:41:28.390064 after 4.13 seconds
[0m18:41:28.390465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072d2eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e436130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076787f0>]}
[0m18:41:28.390835 [debug] [MainThread]: Flushing usage events
[0m18:41:28.546966 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:42:22.975987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bfbee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aaa0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aaacd0>]}


============================== 18:42:22.979199 | 83cd0895-53d7-4217-ac5a-745808417a10 ==============================
[0m18:42:22.979199 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:42:22.979562 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:42:23.773091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103cd2880>]}
[0m18:42:23.807829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b761be0>]}
[0m18:42:23.808762 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:42:23.939441 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:42:24.025977 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:42:24.026258 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:42:24.030008 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m18:42:24.050180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bd17130>]}
[0m18:42:24.102145 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:42:24.105618 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:42:24.119037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bd39070>]}
[0m18:42:24.119390 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:42:24.119594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bae53a0>]}
[0m18:42:24.120445 [info ] [MainThread]: 
[0m18:42:24.120666 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:42:24.120844 [info ] [MainThread]: 
[0m18:42:24.121153 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:42:24.124098 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:42:24.160744 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:42:24.161005 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:42:24.161177 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:42:24.958361 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.797 seconds
[0m18:42:24.964212 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:42:24.982051 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:42:24.982621 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:42:25.073427 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.090 seconds
[0m18:42:25.080027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b7c2a00>]}
[0m18:42:25.085291 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:42:25.085984 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:42:25.087382 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:42:25.086855 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:42:25.088179 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:42:25.088898 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:42:25.089706 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:42:25.090472 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:42:25.091141 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:42:25.092041 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:42:25.092810 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:42:25.093357 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:42:25.094034 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:42:25.094539 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:42:25.095158 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:42:25.107747 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:42:25.108260 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:42:25.112205 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:42:25.116495 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:42:25.120008 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:42:25.120944 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:42:25.140189 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:42:25.154416 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:42:25.158499 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:42:25.158814 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:42:25.159049 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:42:25.161047 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:42:25.163495 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:42:25.165628 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:42:25.166313 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:42:25.166657 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:42:25.166978 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID and basic fields
        _id:"$oid"::string as brand_id,
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        
        -- Category information
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG / Consumer Packaged Goods information
        cpg:"$ref"::string as cpg_ref,
        cpg:"$id"."$oid"::string as cpg_id,
        
        -- Additional brand attributes
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:42:25.167262 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:42:25.168355 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:42:25.169084 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:42:25.169853 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:42:25.170303 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:42:25.170859 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:42:25.171285 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:42:25.307152 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb13d2-0000-ca4b-0000-00015dbea1b1
[0m18:42:25.307451 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001044 (42P13): SQL compilation error: error line 12 at position 11
Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
[0m18:42:25.312557 [debug] [Thread-1  ]: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:42:25.313853 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c513af0>]}
[0m18:42:25.314369 [error] [Thread-1  ]: 1 of 4 ERROR creating sql table model PUBLIC_staging.staging_brands ............ [[31mERROR[0m in 0.22s]
[0m18:42:25.314783 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:42:25.315092 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.staging_brands' to be skipped because of status 'error'.  Reason: Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql.
[0m18:42:26.306519 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.135 seconds
[0m18:42:26.343141 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c507580>]}
[0m18:42:26.343950 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.25s]
[0m18:42:26.344560 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:42:26.357883 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 1.191 seconds
[0m18:42:26.360535 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105556c70>]}
[0m18:42:26.361209 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 1.27s]
[0m18:42:26.361785 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:42:26.484816 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.313 seconds
[0m18:42:26.490069 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83cd0895-53d7-4217-ac5a-745808417a10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5392b0>]}
[0m18:42:26.491271 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.40s]
[0m18:42:26.492197 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:42:26.493956 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:42:26.494457 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:42:26.494930 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:42:26.583085 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:42:26.583796 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:42:26.673953 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:42:26.674822 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:42:26.764903 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:42:26.765959 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:42:26.850388 [info ] [MainThread]: 
[0m18:42:26.851349 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 2.73 seconds (2.73s).
[0m18:42:26.853747 [debug] [MainThread]: Command end result
[0m18:42:26.890115 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:42:26.891848 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:42:26.898653 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:42:26.898970 [info ] [MainThread]: 
[0m18:42:26.899310 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m18:42:26.899589 [info ] [MainThread]: 
[0m18:42:26.899918 [error] [MainThread]:   Database Error in model staging_brands (models/staging/staging_brands.sql)
  001044 (42P13): SQL compilation error: error line 12 at position 11
  Invalid argument types for function 'GET': (VARCHAR(16777216), VARCHAR(4))
  compiled code at target/run/fetch_analytics/models/staging/staging_brands.sql
[0m18:42:26.900191 [info ] [MainThread]: 
[0m18:42:26.900472 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m18:42:26.902820 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.9716415, "process_in_blocks": "0", "process_kernel_time": 0.602065, "process_mem_max_rss": "169771008", "process_out_blocks": "0", "process_user_time": 3.280049}
[0m18:42:26.903197 [debug] [MainThread]: Command `dbt run` failed at 18:42:26.903126 after 3.97 seconds
[0m18:42:26.903532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bfbee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bcce160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104daac10>]}
[0m18:42:26.903832 [debug] [MainThread]: Flushing usage events
[0m18:42:26.969808 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:43:06.920986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a2eeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058defd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058dec40>]}


============================== 18:43:06.924169 | 32100730-3e85-474c-b1b4-2527d4da544c ==============================
[0m18:43:06.924169 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:43:06.924548 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m18:43:07.572601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11abaedc0>]}
[0m18:43:07.603707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10534a070>]}
[0m18:43:07.604301 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:43:07.841372 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:43:07.927161 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:43:07.927555 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_brands.sql
[0m18:43:08.065359 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m18:43:08.074045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b1ac130>]}
[0m18:43:08.124378 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:43:08.126872 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:43:08.139983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045ac0a0>]}
[0m18:43:08.140307 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:43:08.140504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11abe6670>]}
[0m18:43:08.141323 [info ] [MainThread]: 
[0m18:43:08.141526 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:43:08.141690 [info ] [MainThread]: 
[0m18:43:08.141972 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:43:08.144757 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:43:08.221490 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:43:08.221755 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:43:08.221922 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:43:09.186603 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.964 seconds
[0m18:43:09.191327 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:43:09.208601 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:43:09.209042 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:43:09.324680 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.115 seconds
[0m18:43:09.330712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b94e50>]}
[0m18:43:09.335145 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:43:09.335852 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:43:09.336454 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:43:09.337766 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:43:09.337264 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:43:09.338663 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:43:09.339675 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:43:09.340557 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:43:09.341249 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:43:09.341890 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:43:09.342533 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:43:09.343147 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:43:09.343641 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:43:09.344259 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:43:09.344801 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:43:09.345327 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:43:09.361714 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:43:09.362122 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:43:09.366447 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:43:09.369648 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:43:09.370543 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:43:09.370992 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:43:09.405142 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:43:09.405575 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:43:09.411159 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:43:09.411617 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:43:09.413819 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:43:09.416171 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:43:09.418570 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:43:09.418989 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    get(parse_json(r._id), 'oid')::string as receipt_id,
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:43:09.419822 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:43:09.420107 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:43:09.420368 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID extraction with regexp to handle string data
        regexp_substr(_id::string, '"\\$oid"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as brand_id,
        
        -- Standard fields (no JSON extraction needed)
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG reference extraction with regexp
        regexp_substr(cpg::string, '"\\$ref"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as cpg_ref,
        
        -- CPG ID extraction with regexp
        regexp_substr(cpg::string, '"\\$id".*?"\\$oid"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as cpg_id,
        
        -- Flag field (no JSON extraction needed)
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:43:09.421502 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:43:09.422458 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        get(parse_json(_id), 'oid')::string as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        to_timestamp(get(parse_json(purchaseDate), 'date')::number / 1000) as purchase_timestamp,
        to_timestamp(get(parse_json(createDate), 'date')::number / 1000) as create_timestamp,
        to_timestamp(get(parse_json(modifyDate), 'date')::number / 1000) as modify_timestamp,
        to_timestamp(get(parse_json(pointsAwardedDate), 'date')::number / 1000) as points_awarded_timestamp,
        to_timestamp(get(parse_json(finishedDate), 'date')::number / 1000) as finished_timestamp,
        to_timestamp(get(parse_json(dateScanned), 'date')::number / 1000) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:43:09.423182 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:43:09.423380 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:43:09.423889 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        get(parse_json(_id), 'oid')::string as user_id,
        coalesce(active, false)::boolean as active,
        to_timestamp(get(parse_json(createdDate), 'date')::number / 1000) as created_timestamp,
        to_timestamp(get(parse_json(lastLogin), 'date')::number / 1000) as last_login_timestamp,
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:43:09.424850 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:43:10.441798 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 1.021 seconds
[0m18:43:10.471972 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.047 seconds
[0m18:43:10.485761 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a21e80>]}
[0m18:43:10.486221 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bb9b80>]}
[0m18:43:10.486921 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 1.14s]
[0m18:43:10.487519 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.14s]
[0m18:43:10.488039 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:43:10.488477 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:43:10.546259 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.124 seconds
[0m18:43:10.549188 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f87cf10>]}
[0m18:43:10.549940 [info ] [Thread-1  ]: 1 of 4 OK created sql table model PUBLIC_staging.staging_brands ................ [[32mSUCCESS 1[0m in 1.21s]
[0m18:43:10.550582 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:43:10.627918 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 1.204 seconds
[0m18:43:10.631949 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '32100730-3e85-474c-b1b4-2527d4da544c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f88d0a0>]}
[0m18:43:10.633046 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 1.29s]
[0m18:43:10.633974 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:43:10.635784 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:43:10.636272 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:43:10.636688 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:43:10.725526 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:43:10.726424 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:43:10.819386 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:43:10.820789 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:43:10.904602 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:43:10.905559 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:43:11.004316 [info ] [MainThread]: 
[0m18:43:11.005204 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 2.86 seconds (2.86s).
[0m18:43:11.007454 [debug] [MainThread]: Command end result
[0m18:43:11.043181 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:43:11.045144 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:43:11.051717 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:43:11.052023 [info ] [MainThread]: 
[0m18:43:11.052374 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:43:11.052652 [info ] [MainThread]: 
[0m18:43:11.052938 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:43:11.055366 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.1816044, "process_in_blocks": "0", "process_kernel_time": 1.024812, "process_mem_max_rss": "167264256", "process_out_blocks": "0", "process_user_time": 2.956108}
[0m18:43:11.055774 [debug] [MainThread]: Command `dbt run` succeeded at 18:43:11.055693 after 4.18 seconds
[0m18:43:11.056131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a2eeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10534a070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b2c38e0>]}
[0m18:43:11.056482 [debug] [MainThread]: Flushing usage events
[0m18:43:11.148839 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:55:51.103076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107310e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110edef40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110edebb0>]}


============================== 18:55:51.106329 | e09ca47b-e21f-45d9-b943-373c2ace5bec ==============================
[0m18:55:51.106329 [info ] [MainThread]: Running with dbt=1.9.3
[0m18:55:51.106682 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:55:51.773493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ea18b0>]}
[0m18:55:51.804612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077ddb20>]}
[0m18:55:51.805137 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m18:55:51.928080 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m18:55:52.015402 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m18:55:52.015806 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_receipt_items.sql
[0m18:55:52.016055 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_receipts.sql
[0m18:55:52.016277 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/staging/staging_users.sql
[0m18:55:52.162112 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m18:55:52.171216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138a9b130>]}
[0m18:55:52.222937 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:55:52.225855 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:55:52.239507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d99ca0>]}
[0m18:55:52.239857 [info ] [MainThread]: Found 4 models, 3 sources, 472 macros
[0m18:55:52.240070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d80460>]}
[0m18:55:52.240890 [info ] [MainThread]: 
[0m18:55:52.241100 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:55:52.241271 [info ] [MainThread]: 
[0m18:55:52.241564 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:55:52.244590 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m18:55:52.318631 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m18:55:52.318911 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m18:55:52.319096 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:55:53.272521 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.953 seconds
[0m18:55:53.278327 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m18:55:53.296172 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m18:55:53.296718 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m18:55:53.410723 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.113 seconds
[0m18:55:53.417953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106272dc0>]}
[0m18:55:53.423489 [debug] [Thread-1  ]: Began running node model.fetch_analytics.staging_brands
[0m18:55:53.424234 [debug] [Thread-2  ]: Began running node model.fetch_analytics.staging_receipt_items
[0m18:55:53.425614 [debug] [Thread-3  ]: Began running node model.fetch_analytics.staging_receipts
[0m18:55:53.425089 [info ] [Thread-1  ]: 1 of 4 START sql table model PUBLIC_staging.staging_brands ..................... [RUN]
[0m18:55:53.426406 [debug] [Thread-4  ]: Began running node model.fetch_analytics.staging_users
[0m18:55:53.427155 [info ] [Thread-2  ]: 2 of 4 START sql table model PUBLIC_staging.staging_receipt_items .............. [RUN]
[0m18:55:53.427932 [info ] [Thread-3  ]: 3 of 4 START sql table model PUBLIC_staging.staging_receipts ................... [RUN]
[0m18:55:53.428645 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.staging_brands)
[0m18:55:53.429307 [info ] [Thread-4  ]: 4 of 4 START sql table model PUBLIC_staging.staging_users ...................... [RUN]
[0m18:55:53.430038 [debug] [Thread-2  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipt_items'
[0m18:55:53.430659 [debug] [Thread-3  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_receipts'
[0m18:55:53.431136 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.staging_brands
[0m18:55:53.432168 [debug] [Thread-4  ]: Acquiring new snowflake connection 'model.fetch_analytics.staging_users'
[0m18:55:53.432736 [debug] [Thread-2  ]: Began compiling node model.fetch_analytics.staging_receipt_items
[0m18:55:53.433230 [debug] [Thread-3  ]: Began compiling node model.fetch_analytics.staging_receipts
[0m18:55:53.445475 [debug] [Thread-4  ]: Began compiling node model.fetch_analytics.staging_users
[0m18:55:53.445185 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.staging_brands"
[0m18:55:53.449761 [debug] [Thread-2  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipt_items"
[0m18:55:53.454529 [debug] [Thread-3  ]: Writing injected SQL for node "model.fetch_analytics.staging_receipts"
[0m18:55:53.458069 [debug] [Thread-4  ]: Writing injected SQL for node "model.fetch_analytics.staging_users"
[0m18:55:53.459740 [debug] [Thread-4  ]: Began executing node model.fetch_analytics.staging_users
[0m18:55:53.466402 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.staging_brands
[0m18:55:53.478595 [debug] [Thread-3  ]: Began executing node model.fetch_analytics.staging_receipts
[0m18:55:53.485249 [debug] [Thread-2  ]: Began executing node model.fetch_analytics.staging_receipt_items
[0m18:55:53.494491 [debug] [Thread-4  ]: Writing runtime sql for node "model.fetch_analytics.staging_users"
[0m18:55:53.496625 [debug] [Thread-3  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipts"
[0m18:55:53.502277 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.staging_brands"
[0m18:55:53.504991 [debug] [Thread-2  ]: Writing runtime sql for node "model.fetch_analytics.staging_receipt_items"
[0m18:55:53.506461 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.staging_brands"
[0m18:55:53.506739 [debug] [Thread-1  ]: On model.fetch_analytics.staging_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_brands"} */
create or replace transient table RAW.PUBLIC_staging.staging_brands
         as
        (

with source as (
    select * from raw.public.brands
),

staging_brands as (
    select
        -- Brand ID extraction with regexp to handle string data
        regexp_substr(_id::string, '"\\$oid"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as brand_id,
        
        -- Standard fields (no JSON extraction needed)
        name::string as brand_name,
        barcode::string as barcode,
        brandCode::string as brand_code,
        category::string as category,
        categoryCode::string as category_code,
        
        -- CPG reference extraction with regexp
        regexp_substr(cpg::string, '"\\$ref"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as cpg_ref,
        
        -- CPG ID extraction with regexp
        regexp_substr(cpg::string, '"\\$id".*?"\\$oid"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as cpg_id,
        
        -- Flag field (no JSON extraction needed)
        topBrand::boolean as is_top_brand
    from source
)

select * from staging_brands
        );
[0m18:55:53.508751 [debug] [Thread-3  ]: Using snowflake connection "model.fetch_analytics.staging_receipts"
[0m18:55:53.509144 [debug] [Thread-3  ]: On model.fetch_analytics.staging_receipts: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipts"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipts
         as
        (

with source as (
    select * from raw.public.receipts
),

staging_receipts as (
    select
        -- Extract receipt_id using regex instead of get()
        regexp_substr(_id::string, '"\\$oid"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as receipt_id,
        userId::string as user_id,
        totalSpent::string as total_spent,
        
        -- Convert dates using regex instead of get()
        to_timestamp(
            regexp_substr(purchaseDate::string, '"\\$date"\\s*:\\s*([0-9]+)', 1, 1, 'e', 1)::number / 1000
        ) as purchase_timestamp,
        
        to_timestamp(
            regexp_substr(createDate::string, '"\\$date"\\s*:\\s*([0-9]+)', 1, 1, 'e', 1)::number / 1000
        ) as create_timestamp,
        
        to_timestamp(
            regexp_substr(modifyDate::string, '"\\$date"\\s*:\\s*([0-9]+)', 1, 1, 'e', 1)::number / 1000
        ) as modify_timestamp,
        
        to_timestamp(
            regexp_substr(pointsAwardedDate::string, '"\\$date"\\s*:\\s*([0-9]+)', 1, 1, 'e', 1)::number / 1000
        ) as points_awarded_timestamp,
        
        to_timestamp(
            regexp_substr(finishedDate::string, '"\\$date"\\s*:\\s*([0-9]+)', 1, 1, 'e', 1)::number / 1000
        ) as finished_timestamp,
        
        to_timestamp(
            regexp_substr(dateScanned::string, '"\\$date"\\s*:\\s*([0-9]+)', 1, 1, 'e', 1)::number / 1000
        ) as scanned_timestamp,
        
        pointsEarned::float as points_earned,
        bonusPointsEarned::float as bonus_points_earned,
        bonusPointsEarnedReason::string as bonus_points_earned_reason,
        purchasedItemCount::number as purchased_item_count,
        rewardsReceiptStatus::string as rewards_receipt_status
    from source
)

select * from staging_receipts
        );
[0m18:55:53.509468 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m18:55:53.511558 [debug] [Thread-2  ]: Using snowflake connection "model.fetch_analytics.staging_receipt_items"
[0m18:55:53.512366 [debug] [Thread-4  ]: Using snowflake connection "model.fetch_analytics.staging_users"
[0m18:55:53.512684 [debug] [Thread-2  ]: On model.fetch_analytics.staging_receipt_items: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_receipt_items"} */
create or replace transient table RAW.PUBLIC_staging.staging_receipt_items
         as
        (

with receipts as (
    select * from raw.public.receipts
)

select
    -- Extract receipt_id using regex instead of get()
    regexp_substr(r._id::string, '"\\$oid"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as receipt_id,
    
    -- Item fields using direct value access
    i.value:barcode::string as barcode,
    i.value:description::string as description,
    i.value:finalPrice::string as final_price,
    i.value:itemPrice::string as item_price,
    i.value:needsFetchReview::boolean as needs_fetch_review,
    i.value:partnerItemId::string as partner_item_id,
    i.value:preventTargetGapPoints::boolean as prevent_target_gap_points,
    i.value:quantityPurchased::number as quantity_purchased,
    i.value:userFlaggedBarcode::string as user_flagged_barcode,
    i.value:userFlaggedNewItem::boolean as user_flagged_new_item,
    i.value:userFlaggedPrice::string as user_flagged_price,
    i.value:userFlaggedQuantity::number as user_flagged_quantity,
    i.value:needsFetchReviewReason::string as needs_fetch_review_reason,
    i.value:pointsNotAwardedReason::string as points_not_awarded_reason,
    i.value:pointsPayerId::string as points_payer_id,
    i.value:rewardsGroup::string as rewards_group,
    i.value:rewardsProductPartnerId::string as rewards_product_partner_id,
    i.value:userFlaggedDescription::string as user_flagged_description,
    i.value:originalMetaBriteBarcode::string as original_meta_brite_barcode,
    i.value:originalMetaBriteDescription::string as original_meta_brite_description,
    i.value:brandCode::string as brand_code,
    i.value:competitorRewardsGroup::string as competitor_rewards_group,
    i.value:discountedItemPrice::string as discounted_item_price,
    i.value:originalReceiptItemText::string as original_receipt_item_text,
    i.value:itemNumber::string as item_number,
    i.value:originalMetaBriteQuantityPurchased::number as original_meta_brite_quantity_purchased,
    i.value:pointsEarned::string as points_earned,
    i.value:targetPrice::string as target_price,
    i.value:competitiveProduct::string as competitive_product,
    i.value:originalFinalPrice::string as original_final_price,
    i.value:originalMetaBriteItemPrice::string as original_meta_brite_item_price,
    i.value:deleted::boolean as deleted,
    i.value:priceAfterCoupon::string as price_after_coupon,
    i.value:metabriteCampaignId::string as metabrite_campaign_id
from
    receipts r,
    lateral flatten(input => parse_json(r.rewardsReceiptItemList)) i
where 
    r.rewardsReceiptItemList is not null
        );
[0m18:55:53.513464 [debug] [Thread-4  ]: On model.fetch_analytics.staging_users: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.staging_users"} */
create or replace transient table RAW.PUBLIC_staging.staging_users
         as
        (

with source as (
    select * from raw.public.users
),

staging_users as (
    select
        -- Extract user_id using regex instead of get()
        regexp_substr(_id::string, '"\\$oid"\\s*:\\s*"([^"]+)"', 1, 1, 'e', 1) as user_id,
        
        -- Boolean handling with coalesce
        coalesce(active, false)::boolean as active,
        
        -- Convert dates using regex instead of get()
        to_timestamp(
            regexp_substr(createdDate::string, '"\\$date"\\s*:\\s*([0-9]+)', 1, 1, 'e', 1)::number / 1000
        ) as created_timestamp,
        
        to_timestamp(
            regexp_substr(lastLogin::string, '"\\$date"\\s*:\\s*([0-9]+)', 1, 1, 'e', 1)::number / 1000
        ) as last_login_timestamp,
        
        -- String fields without JSON extraction
        role::string as role,
        signUpSource::string as sign_up_source,
        state::string as state
    from source
)

select * from staging_users
        );
[0m18:55:53.513973 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m18:55:53.514558 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m18:55:54.447586 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.941 seconds
[0m18:55:54.466235 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f95c6a0>]}
[0m18:55:54.466696 [info ] [Thread-1  ]: 1 of 4 OK created sql table model PUBLIC_staging.staging_brands ................ [[32mSUCCESS 1[0m in 1.04s]
[0m18:55:54.467061 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.staging_brands
[0m18:55:54.944071 [debug] [Thread-4  ]: SQL status: SUCCESS 1 in 1.429 seconds
[0m18:55:54.949390 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f9e1b20>]}
[0m18:55:54.949978 [info ] [Thread-4  ]: 4 of 4 OK created sql table model PUBLIC_staging.staging_users ................. [[32mSUCCESS 1[0m in 1.52s]
[0m18:55:54.950364 [debug] [Thread-4  ]: Finished running node model.fetch_analytics.staging_users
[0m18:55:55.574088 [debug] [Thread-2  ]: SQL status: SUCCESS 1 in 2.060 seconds
[0m18:55:55.574743 [debug] [Thread-3  ]: SQL status: SUCCESS 1 in 2.065 seconds
[0m18:55:55.576610 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f9bb610>]}
[0m18:55:55.577886 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e09ca47b-e21f-45d9-b943-373c2ace5bec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fa5cac0>]}
[0m18:55:55.578334 [info ] [Thread-2  ]: 2 of 4 OK created sql table model PUBLIC_staging.staging_receipt_items ......... [[32mSUCCESS 1[0m in 2.15s]
[0m18:55:55.578769 [info ] [Thread-3  ]: 3 of 4 OK created sql table model PUBLIC_staging.staging_receipts .............. [[32mSUCCESS 1[0m in 2.15s]
[0m18:55:55.579145 [debug] [Thread-2  ]: Finished running node model.fetch_analytics.staging_receipt_items
[0m18:55:55.579477 [debug] [Thread-3  ]: Finished running node model.fetch_analytics.staging_receipts
[0m18:55:55.580547 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:55:55.580763 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_brands' was left open.
[0m18:55:55.580944 [debug] [MainThread]: On model.fetch_analytics.staging_brands: Close
[0m18:55:55.761061 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipt_items' was left open.
[0m18:55:55.761817 [debug] [MainThread]: On model.fetch_analytics.staging_receipt_items: Close
[0m18:55:55.846055 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_receipts' was left open.
[0m18:55:55.846433 [debug] [MainThread]: On model.fetch_analytics.staging_receipts: Close
[0m18:55:55.924766 [debug] [MainThread]: Connection 'model.fetch_analytics.staging_users' was left open.
[0m18:55:55.925108 [debug] [MainThread]: On model.fetch_analytics.staging_users: Close
[0m18:55:55.995033 [info ] [MainThread]: 
[0m18:55:55.995576 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 3.75 seconds (3.75s).
[0m18:55:55.997083 [debug] [MainThread]: Command end result
[0m18:55:56.023305 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m18:55:56.025699 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m18:55:56.031137 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m18:55:56.031355 [info ] [MainThread]: 
[0m18:55:56.031638 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:55:56.031827 [info ] [MainThread]: 
[0m18:55:56.032047 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:55:56.034602 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.97599, "process_in_blocks": "0", "process_kernel_time": 0.608952, "process_mem_max_rss": "171622400", "process_out_blocks": "0", "process_user_time": 3.292651}
[0m18:55:56.035101 [debug] [MainThread]: Command `dbt run` succeeded at 18:55:56.035047 after 4.98 seconds
[0m18:55:56.037273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107310e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077ddb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d99ac0>]}
[0m18:55:56.037902 [debug] [MainThread]: Flushing usage events
[0m18:55:56.153739 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:50:45.676388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cd3e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b830a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b83cd0>]}


============================== 19:50:45.679468 | 6e8959ca-86eb-4b6f-adc7-2909d42c282c ==============================
[0m19:50:45.679468 [info ] [MainThread]: Running with dbt=1.9.3
[0m19:50:45.679856 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select top_5_brands', 'send_anonymous_usage_stats': 'True'}
[0m19:50:46.299871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e8959ca-86eb-4b6f-adc7-2909d42c282c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b44610>]}
[0m19:50:46.330880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e8959ca-86eb-4b6f-adc7-2909d42c282c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b442e0>]}
[0m19:50:46.331538 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m19:50:46.456206 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m19:50:46.541311 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m19:50:46.541665 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://models/reporting/top_5_brands.sql
[0m19:50:46.681209 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m19:50:46.689766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e8959ca-86eb-4b6f-adc7-2909d42c282c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d477130>]}
[0m19:50:46.739922 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m19:50:46.743107 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m19:50:46.761552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e8959ca-86eb-4b6f-adc7-2909d42c282c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d448df0>]}
[0m19:50:46.761920 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m19:50:46.762128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e8959ca-86eb-4b6f-adc7-2909d42c282c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d270220>]}
[0m19:50:46.762779 [info ] [MainThread]: 
[0m19:50:46.762997 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:50:46.763163 [info ] [MainThread]: 
[0m19:50:46.763451 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:50:46.763923 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m19:50:46.836764 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m19:50:46.837057 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m19:50:46.837240 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:50:47.979026 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.142 seconds
[0m19:50:47.990599 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m19:50:47.998356 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m19:50:48.013655 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m19:50:48.017835 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m19:50:48.018182 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m19:50:48.018535 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m19:50:48.018975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:50:48.194311 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.175 seconds
[0m19:50:48.662464 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.643 seconds
[0m19:50:48.669579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e8959ca-86eb-4b6f-adc7-2909d42c282c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e38e20>]}
[0m19:50:48.674839 [debug] [Thread-1  ]: Began running node model.fetch_analytics.top_5_brands
[0m19:50:48.675783 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.top_5_brands ............................... [RUN]
[0m19:50:48.676556 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.top_5_brands)
[0m19:50:48.677163 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.top_5_brands
[0m19:50:48.691973 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.top_5_brands"
[0m19:50:48.693499 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.top_5_brands
[0m19:50:48.727127 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.top_5_brands"
[0m19:50:48.729300 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.top_5_brands"
[0m19:50:48.729649 [debug] [Thread-1  ]: On model.fetch_analytics.top_5_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.top_5_brands"} */
create or replace transient table RAW.PUBLIC.top_5_brands
         as
        (-- BI Analyst Question: What are the top 5 brands by receipts scanned for most recent month?



with receipt_items_with_brand as (
    select
        ri.receipt_id,
        ri.barcode,
        b.brand_id,
        b.brand_name,
        r.scanned_timestamp
    from RAW.PUBLIC_staging.staging_receipt_items ri -- alias for staging_receipt_items
    inner join RAW.PUBLIC_staging.staging_receipts r -- alias for staging_receipts
        on ri.receipt_id = r.receipt_id
    left join RAW.PUBLIC_staging.staging_brands b -- alias for brands
        on ri.barcode = b.barcode
    where b.brand_id is not null
),

-- Get the most recent month's data
recent_month as (
    select
        date_trunc('month', max(scanned_timestamp)) as most_recent_month
    from receipt_items_with_brand
),

-- Count receipts scanned by brand in the most recent month
brand_receipt_counts as (
    select
        brand_id,
        brand_name,
        count(distinct receipt_id) as receipt_count
    from receipt_items_with_brand ri
    cross join recent_month rm
    where date_trunc('month', ri.scanned_timestamp) = rm.most_recent_month
    group by brand_id, brand_name
)

-- Return the top 5 brands
select
    brand_id,
    brand_name,
    receipt_count
from brand_receipt_counts
order by receipt_count desc
limit 5
        );
[0m19:50:50.709399 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.979 seconds
[0m19:50:50.746276 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e8959ca-86eb-4b6f-adc7-2909d42c282c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11da95040>]}
[0m19:50:50.747134 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.top_5_brands .......................... [[32mSUCCESS 1[0m in 2.07s]
[0m19:50:50.747760 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.top_5_brands
[0m19:50:50.749032 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:50:50.749397 [debug] [MainThread]: Connection 'model.fetch_analytics.top_5_brands' was left open.
[0m19:50:50.749723 [debug] [MainThread]: On model.fetch_analytics.top_5_brands: Close
[0m19:50:50.841543 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m19:50:50.842167 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m19:50:50.925726 [info ] [MainThread]: 
[0m19:50:50.926584 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.16 seconds (4.16s).
[0m19:50:50.927797 [debug] [MainThread]: Command end result
[0m19:50:50.964632 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m19:50:50.966690 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m19:50:50.973067 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m19:50:50.973364 [info ] [MainThread]: 
[0m19:50:50.973732 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:50:50.974013 [info ] [MainThread]: 
[0m19:50:50.974303 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:50:50.976809 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.343096, "process_in_blocks": "0", "process_kernel_time": 0.573152, "process_mem_max_rss": "169394176", "process_out_blocks": "0", "process_user_time": 3.26324}
[0m19:50:50.977224 [debug] [MainThread]: Command `dbt run` succeeded at 19:50:50.977143 after 5.34 seconds
[0m19:50:50.977556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cd3e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e71be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b44610>]}
[0m19:50:50.977915 [debug] [MainThread]: Flushing usage events
[0m19:50:51.205690 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:06:32.267229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077c7e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086770a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108677c70>]}


============================== 20:06:32.272282 | 49395faf-84dc-4869-88e3-faec2bf35463 ==============================
[0m20:06:32.272282 [info ] [MainThread]: Running with dbt=1.9.3
[0m20:06:32.272805 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select fct_brands', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:06:32.921924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49395faf-84dc-4869-88e3-faec2bf35463', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d904d30>]}
[0m20:06:32.953037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49395faf-84dc-4869-88e3-faec2bf35463', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080d3b80>]}
[0m20:06:32.953542 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m20:06:33.076887 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m20:06:33.164131 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m20:06:33.164492 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://models/reporting/fct_brands.sql
[0m20:06:33.164669 [debug] [MainThread]: Partial parsing: deleted file: fetch_analytics://models/reporting/top_5_brands.sql
[0m20:06:33.304258 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m20:06:33.312965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49395faf-84dc-4869-88e3-faec2bf35463', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df7f130>]}
[0m20:06:33.363214 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m20:06:33.365862 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m20:06:33.379117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49395faf-84dc-4869-88e3-faec2bf35463', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df6ffa0>]}
[0m20:06:33.379440 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m20:06:33.379642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49395faf-84dc-4869-88e3-faec2bf35463', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10693b970>]}
[0m20:06:33.380281 [info ] [MainThread]: 
[0m20:06:33.380500 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:06:33.380667 [info ] [MainThread]: 
[0m20:06:33.380952 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:06:33.381405 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m20:06:33.455831 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m20:06:33.456110 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m20:06:33.456281 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:34.561710 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.105 seconds
[0m20:06:34.570219 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m20:06:34.570951 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m20:06:34.582916 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m20:06:34.585335 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m20:06:34.585790 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m20:06:34.586074 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m20:06:34.586606 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:34.732674 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.146 seconds
[0m20:06:35.069533 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.483 seconds
[0m20:06:35.073233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49395faf-84dc-4869-88e3-faec2bf35463', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df3b7f0>]}
[0m20:06:35.078099 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands
[0m20:06:35.078667 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands ................................. [RUN]
[0m20:06:35.079209 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands)
[0m20:06:35.079585 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands
[0m20:06:35.092215 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands"
[0m20:06:35.093346 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands
[0m20:06:35.119173 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands"
[0m20:06:35.122283 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands"
[0m20:06:35.122668 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands"} */
create or replace transient table RAW.PUBLIC.fct_brands
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. Which brand has the most spend among users who were created within the past 6 months?
-- 3. Which brand has the most transactions among users who were created within the past 6 months?



-- Join receipt items with brands and users data
with receipt_items_with_details as (
    select
        ri.receipt_id,
        ri.barcode,
        ri.partner_item_id,
        try_cast(ri.final_price as float) as item_price,
        b.brand_id,
        b.brand_name,
        r.scanned_timestamp,
        r.user_id,
        try_cast(r.total_spent as float) as receipt_total_spent,
        u.created_timestamp as user_created_timestamp
    from RAW.PUBLIC_staging.staging_receipt_items ri 
    inner join RAW.PUBLIC_staging.staging_receipts r
        on ri.receipt_id = r.receipt_id
    left join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    left join RAW.PUBLIC_staging.staging_users u
        on r.user_id = u.user_id
    where b.brand_id is not null
),

-- Identify the most recent month
recent_month as (
    select
        date_trunc('month', max(scanned_timestamp)) as most_recent_month
    from receipt_items_with_details
),

-- Question 1: Top 5 brands by receipts scanned for most recent month
top_brands_by_receipts as (
    select
        brand_id,
        brand_name,
        count(distinct receipt_id) as receipt_count,
        'Top 5 brands by receipts in most recent month' as question_type
    from receipt_items_with_details ri
    cross join recent_month rm
    where date_trunc('month', ri.scanned_timestamp) = rm.most_recent_month
    group by brand_id, brand_name
    order by receipt_count desc
    limit 5
),

-- Identify users created in the past 6 months
new_users as (
    select 
        user_id
    from RAW.PUBLIC_staging.staging_users
    where datediff('month', created_timestamp, current_timestamp()) <= 6
),

-- Get all receipts for new users
new_user_receipts as (
    select
        r.receipt_id,
        r.user_id,
        try_cast(r.total_spent as float) as total_spent
    from RAW.PUBLIC_staging.staging_receipts r
    inner join new_users nu
        on r.user_id = nu.user_id
),

-- Question 2: Brand with most spend among new users
brand_spend_by_new_users as (
    select
        b.brand_id,
        b.brand_name,
        sum(item_price) as total_spend,
        'Brand with most spend among users created in past 6 months' as question_type
    from receipt_items_with_details ri
    inner join new_user_receipts nur
        on ri.receipt_id = nur.receipt_id
    inner join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    where b.brand_id is not null
    group by b.brand_id, b.brand_name
    order by total_spend desc
    limit 1
),

-- Question 3: Brand with most transactions among new users
brand_transactions_by_new_users as (
    select
        b.brand_id,
        b.brand_name,
        count(distinct ri.receipt_id) as transaction_count,
        'Brand with most transactions among users created in past 6 months' as question_type
    from receipt_items_with_details ri
    inner join new_user_receipts nur
        on ri.receipt_id = nur.receipt_id
    inner join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    where b.brand_id is not null
    group by b.brand_id, b.brand_name
    order by transaction_count desc
    limit 1
)

-- Combine all results with relevant metrics
select
    question_type,
    brand_id,
    brand_name,
    receipt_count as metric_value,
    null as metric_type
from top_brands_by_receipts

union all

select 
    question_type,
    brand_id,
    brand_name,
    total_spend as metric_value,
    'spend' as metric_type
from brand_spend_by_new_users

union all

select
    question_type,
    brand_id,
    brand_name,
    transaction_count as metric_value,
    'transactions' as metric_type
from brand_transactions_by_new_users

order by question_type
        );
[0m20:06:38.044735 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 2.920 seconds
[0m20:06:38.071799 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49395faf-84dc-4869-88e3-faec2bf35463', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e597280>]}
[0m20:06:38.072644 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands ............................ [[32mSUCCESS 1[0m in 2.99s]
[0m20:06:38.073085 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands
[0m20:06:38.074341 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:06:38.074552 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands' was left open.
[0m20:06:38.074743 [debug] [MainThread]: On model.fetch_analytics.fct_brands: Close
[0m20:06:38.199121 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m20:06:38.199593 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m20:06:38.296455 [info ] [MainThread]: 
[0m20:06:38.297291 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.92 seconds (4.92s).
[0m20:06:38.298758 [debug] [MainThread]: Command end result
[0m20:06:38.334749 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m20:06:38.337134 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m20:06:38.344094 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m20:06:38.344428 [info ] [MainThread]: 
[0m20:06:38.344841 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:06:38.345117 [info ] [MainThread]: 
[0m20:06:38.345433 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:06:38.348134 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.1355147, "process_in_blocks": "0", "process_kernel_time": 0.691578, "process_mem_max_rss": "168869888", "process_out_blocks": "0", "process_user_time": 3.076325}
[0m20:06:38.348580 [debug] [MainThread]: Command `dbt run` succeeded at 20:06:38.348509 after 6.14 seconds
[0m20:06:38.348950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077c7e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080d3b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df3adc0>]}
[0m20:06:38.349253 [debug] [MainThread]: Flushing usage events
[0m20:06:38.706072 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:20:21.048915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10746cdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11861ffa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11861fc10>]}


============================== 20:20:21.052042 | c7a3d2eb-09cd-4ef0-a80f-49cd1998f03e ==============================
[0m20:20:21.052042 [info ] [MainThread]: Running with dbt=1.9.3
[0m20:20:21.052417 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_brands', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:20:21.769165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c7a3d2eb-09cd-4ef0-a80f-49cd1998f03e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1185ef3a0>]}
[0m20:20:21.800321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c7a3d2eb-09cd-4ef0-a80f-49cd1998f03e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107919700>]}
[0m20:20:21.800857 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m20:20:21.923793 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m20:20:22.009511 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:20:22.010045 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands.sql
[0m20:20:22.150178 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m20:20:22.158854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c7a3d2eb-09cd-4ef0-a80f-49cd1998f03e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1431ddee0>]}
[0m20:20:22.208727 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m20:20:22.211541 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m20:20:22.224719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c7a3d2eb-09cd-4ef0-a80f-49cd1998f03e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142fde490>]}
[0m20:20:22.225029 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m20:20:22.225230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7a3d2eb-09cd-4ef0-a80f-49cd1998f03e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142ad99d0>]}
[0m20:20:22.225884 [info ] [MainThread]: 
[0m20:20:22.226096 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:20:22.226262 [info ] [MainThread]: 
[0m20:20:22.226557 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:20:22.227045 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m20:20:22.305803 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m20:20:22.306069 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m20:20:22.306234 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:20:23.135807 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.829 seconds
[0m20:20:23.148282 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m20:20:23.155438 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m20:20:23.173182 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m20:20:23.175653 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m20:20:23.176075 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m20:20:23.176408 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m20:20:23.176706 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:20:23.304226 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.127 seconds
[0m20:20:23.485441 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.309 seconds
[0m20:20:23.492055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7a3d2eb-09cd-4ef0-a80f-49cd1998f03e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143197490>]}
[0m20:20:23.497304 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands
[0m20:20:23.498290 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands ................................. [RUN]
[0m20:20:23.499101 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands)
[0m20:20:23.499706 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands
[0m20:20:23.516266 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands"
[0m20:20:23.517419 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands
[0m20:20:23.549036 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands"
[0m20:20:23.552787 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands"
[0m20:20:23.553212 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands"} */
create or replace transient table RAW.PUBLIC.fct_brands
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



-- Join receipt items with brands and users data
with receipt_items_with_details as (
    select
        ri.receipt_id,
        ri.barcode,
        ri.partner_item_id,
        try_cast(ri.final_price as float) as item_price,
        b.brand_id,
        b.brand_name,
        r.scanned_timestamp,
        r.user_id,
        try_cast(r.total_spent as float) as receipt_total_spent,
        u.created_timestamp as user_created_timestamp
    from RAW.PUBLIC_staging.staging_receipt_items ri 
    inner join RAW.PUBLIC_staging.staging_receipts r
        on ri.receipt_id = r.receipt_id
    left join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    left join RAW.PUBLIC_staging.staging_users u
        on r.user_id = u.user_id
    where b.brand_id is not null
),

-- Identify the most recent and previous months
month_ranges as (
    select
        date_trunc('month', max(scanned_timestamp)) as most_recent_month,
        dateadd('month', -1, date_trunc('month', max(scanned_timestamp))) as previous_month
    from receipt_items_with_details
),

-- Brand rankings for the most recent month
current_month_rankings as (
    select
        brand_id,
        brand_name,
        count(distinct receipt_id) as receipt_count,
        row_number() over (order by count(distinct receipt_id) desc) as rank,
        'Current Month' as time_period
    from receipt_items_with_details ri
    cross join month_ranges mr
    where date_trunc('month', ri.scanned_timestamp) = mr.most_recent_month
    group by brand_id, brand_name
),

-- Brand rankings for the previous month
previous_month_rankings as (
    select
        brand_id,
        brand_name,
        count(distinct receipt_id) as receipt_count,
        row_number() over (order by count(distinct receipt_id) desc) as rank,
        'Previous Month' as time_period
    from receipt_items_with_details ri
    cross join month_ranges mr
    where date_trunc('month', ri.scanned_timestamp) = mr.previous_month
    group by brand_id, brand_name
),

-- Top 5 brands from the current month
top_5_current_brands as (
    select *
    from current_month_rankings
    where rank <= 5
),

-- Join current and previous month data for comparison
month_over_month_comparison as (
    select
        c.brand_id,
        c.brand_name,
        c.receipt_count as current_month_count,
        c.rank as current_month_rank,
        p.receipt_count as previous_month_count,
        p.rank as previous_month_rank,
        case 
            when p.rank is null then 'New to Top 5'
            when c.rank < p.rank then 'Moved Up'
            when c.rank > p.rank then 'Moved Down'
            when c.rank = p.rank then 'Unchanged'
        end as rank_change,
        case
            when p.receipt_count is null or p.receipt_count = 0 then null
            else (c.receipt_count - p.receipt_count) / p.receipt_count * 100
        end as percent_change
    from top_5_current_brands c
    left join previous_month_rankings p
        on c.brand_id = p.brand_id
)

-- Return both result sets
select 'Question 1: Top 5 brands by receipts scanned for the most recent month' as analysis,
       brand_id,
       brand_name,
       current_month_count as receipt_count,
       current_month_rank as rank,
       null as previous_month_count,
       null as previous_month_rank,
       null as rank_change,
       null as percent_change
from month_over_month_comparison
order by current_month_rank

union all

select 'Question 2: Month-over-month comparison for top 5 brands' as analysis,
       brand_id,
       brand_name,
       current_month_count,
       current_month_rank,
       previous_month_count,
       previous_month_rank,
       rank_change,
       percent_change
from month_over_month_comparison
order by current_month_rank
        );
[0m20:20:23.672514 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb1434-0000-ca94-0000-00015dbec241
[0m20:20:23.672849 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 112 at position 0 unexpected 'union'.
syntax error line 125 at position 8 unexpected ')'.
[0m20:20:23.678641 [debug] [Thread-1  ]: Database Error in model fct_brands (models/reporting/fct_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 112 at position 0 unexpected 'union'.
  syntax error line 125 at position 8 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands.sql
[0m20:20:23.679955 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7a3d2eb-09cd-4ef0-a80f-49cd1998f03e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1479bb370>]}
[0m20:20:23.680382 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands ........................ [[31mERROR[0m in 0.18s]
[0m20:20:23.680742 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands
[0m20:20:23.681087 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands (models/reporting/fct_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 112 at position 0 unexpected 'union'.
  syntax error line 125 at position 8 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands.sql.
[0m20:20:23.681776 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:20:23.681988 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands' was left open.
[0m20:20:23.682176 [debug] [MainThread]: On model.fetch_analytics.fct_brands: Close
[0m20:20:23.767982 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m20:20:23.768384 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m20:20:23.846836 [info ] [MainThread]: 
[0m20:20:23.847396 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.62 seconds (1.62s).
[0m20:20:23.848354 [debug] [MainThread]: Command end result
[0m20:20:23.877907 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m20:20:23.879298 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m20:20:23.887006 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m20:20:23.887284 [info ] [MainThread]: 
[0m20:20:23.887597 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m20:20:23.887913 [info ] [MainThread]: 
[0m20:20:23.888222 [error] [MainThread]:   Database Error in model fct_brands (models/reporting/fct_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 112 at position 0 unexpected 'union'.
  syntax error line 125 at position 8 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands.sql
[0m20:20:23.888468 [info ] [MainThread]: 
[0m20:20:23.888718 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:20:23.890775 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.8839705, "process_in_blocks": "0", "process_kernel_time": 0.472949, "process_mem_max_rss": "170508288", "process_out_blocks": "0", "process_user_time": 3.333323}
[0m20:20:23.891081 [debug] [MainThread]: Command `dbt run` failed at 20:20:23.891021 after 2.88 seconds
[0m20:20:23.891353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10746cdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142fde1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10781b220>]}
[0m20:20:23.891626 [debug] [MainThread]: Flushing usage events
[0m20:20:24.053632 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:31:01.493775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10329ce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10414b0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10414bcd0>]}


============================== 20:31:01.496977 | a950ad6d-c2ee-422c-962c-0979371767f3 ==============================
[0m20:31:01.496977 [info ] [MainThread]: Running with dbt=1.9.3
[0m20:31:01.497358 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:31:02.112183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a950ad6d-c2ee-422c-962c-0979371767f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10410c610>]}
[0m20:31:02.147401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a950ad6d-c2ee-422c-962c-0979371767f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10410c2e0>]}
[0m20:31:02.148255 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m20:31:02.275588 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m20:31:02.360290 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:31:02.360553 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:31:02.364269 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m20:31:02.385310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a950ad6d-c2ee-422c-962c-0979371767f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a520df0>]}
[0m20:31:02.436705 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m20:31:02.439210 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m20:31:02.452051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a950ad6d-c2ee-422c-962c-0979371767f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a539340>]}
[0m20:31:02.452384 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m20:31:02.452605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a950ad6d-c2ee-422c-962c-0979371767f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119f947c0>]}
[0m20:31:02.453303 [info ] [MainThread]: 
[0m20:31:02.453519 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:31:02.453686 [info ] [MainThread]: 
[0m20:31:02.453965 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:31:02.454426 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m20:31:02.490578 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m20:31:02.490867 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m20:31:02.491051 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:31:03.550914 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.060 seconds
[0m20:31:03.564952 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m20:31:03.572850 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m20:31:03.591037 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m20:31:03.593103 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m20:31:03.593466 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m20:31:03.593814 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m20:31:03.594120 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:31:03.721010 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.127 seconds
[0m20:31:04.467719 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.873 seconds
[0m20:31:04.473476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a950ad6d-c2ee-422c-962c-0979371767f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a51d520>]}
[0m20:31:04.477965 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands
[0m20:31:04.478891 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands ................................. [RUN]
[0m20:31:04.479705 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands)
[0m20:31:04.480316 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands
[0m20:31:04.497705 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands"
[0m20:31:04.499342 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands
[0m20:31:04.531975 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands"
[0m20:31:04.535949 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands"
[0m20:31:04.536399 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands"} */
create or replace transient table RAW.PUBLIC.fct_brands
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



-- Join receipt items with brands and users data
with receipt_items_with_details as (
    select
        ri.receipt_id,
        ri.barcode,
        ri.partner_item_id,
        try_cast(ri.final_price as float) as item_price,
        b.brand_id,
        b.brand_name,
        r.scanned_timestamp,
        r.user_id,
        try_cast(r.total_spent as float) as receipt_total_spent,
        u.created_timestamp as user_created_timestamp
    from RAW.PUBLIC_staging.staging_receipt_items ri 
    inner join RAW.PUBLIC_staging.staging_receipts r
        on ri.receipt_id = r.receipt_id
    left join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    left join RAW.PUBLIC_staging.staging_users u
        on r.user_id = u.user_id
    where b.brand_id is not null
),

-- Identify the most recent and previous months
month_ranges as (
    select
        date_trunc('month', max(scanned_timestamp)) as most_recent_month,
        dateadd('month', -1, date_trunc('month', max(scanned_timestamp))) as previous_month
    from receipt_items_with_details
),

-- Brand rankings for the most recent month
current_month_rankings as (
    select
        brand_id,
        brand_name,
        count(distinct receipt_id) as receipt_count,
        row_number() over (order by count(distinct receipt_id) desc) as rank,
        'Current Month' as time_period
    from receipt_items_with_details ri
    cross join month_ranges mr
    where date_trunc('month', ri.scanned_timestamp) = mr.most_recent_month
    group by brand_id, brand_name
),

-- Brand rankings for the previous month
previous_month_rankings as (
    select
        brand_id,
        brand_name,
        count(distinct receipt_id) as receipt_count,
        row_number() over (order by count(distinct receipt_id) desc) as rank,
        'Previous Month' as time_period
    from receipt_items_with_details ri
    cross join month_ranges mr
    where date_trunc('month', ri.scanned_timestamp) = mr.previous_month
    group by brand_id, brand_name
),

-- Top 5 brands from the current month
top_5_current_brands as (
    select *
    from current_month_rankings
    where rank <= 5
),

-- Join current and previous month data for comparison
month_over_month_comparison as (
    select
        c.brand_id,
        c.brand_name,
        c.receipt_count as current_month_count,
        c.rank as current_month_rank,
        p.receipt_count as previous_month_count,
        p.rank as previous_month_rank,
        case 
            when p.rank is null then 'New to Top 5'
            when c.rank < p.rank then 'Moved Up'
            when c.rank > p.rank then 'Moved Down'
            when c.rank = p.rank then 'Unchanged'
        end as rank_change,
        case
            when p.receipt_count is null or p.receipt_count = 0 then null
            else (c.receipt_count - p.receipt_count) / p.receipt_count * 100
        end as percent_change
    from top_5_current_brands c
    left join previous_month_rankings p
        on c.brand_id = p.brand_id
)

-- Return both result sets
select 'Question 1: Top 5 brands by receipts scanned for the most recent month' as analysis,
       brand_id,
       brand_name,
       current_month_count as receipt_count,
       current_month_rank as rank,
       null as previous_month_count,
       null as previous_month_rank,
       null as rank_change,
       null as percent_change
from month_over_month_comparison
order by current_month_rank

union all

select 'Question 2: Month-over-month comparison for top 5 brands' as analysis,
       brand_id,
       brand_name,
       current_month_count,
       current_month_rank,
       previous_month_count,
       previous_month_rank,
       rank_change,
       percent_change
from month_over_month_comparison
order by current_month_rank
        );
[0m20:31:04.735609 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb143f-0000-ca41-0001-5dbe0001017e
[0m20:31:04.736029 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 112 at position 0 unexpected 'union'.
syntax error line 125 at position 8 unexpected ')'.
[0m20:31:04.743169 [debug] [Thread-1  ]: Database Error in model fct_brands (models/reporting/fct_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 112 at position 0 unexpected 'union'.
  syntax error line 125 at position 8 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands.sql
[0m20:31:04.744785 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a950ad6d-c2ee-422c-962c-0979371767f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d646250>]}
[0m20:31:04.745294 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands ........................ [[31mERROR[0m in 0.26s]
[0m20:31:04.745726 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands
[0m20:31:04.746096 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands (models/reporting/fct_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 112 at position 0 unexpected 'union'.
  syntax error line 125 at position 8 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands.sql.
[0m20:31:04.746831 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:31:04.747048 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands' was left open.
[0m20:31:04.747247 [debug] [MainThread]: On model.fetch_analytics.fct_brands: Close
[0m20:31:04.894621 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m20:31:04.895200 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m20:31:04.976638 [info ] [MainThread]: 
[0m20:31:04.977564 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.52 seconds (2.52s).
[0m20:31:04.978775 [debug] [MainThread]: Command end result
[0m20:31:05.022519 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m20:31:05.024532 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m20:31:05.031387 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m20:31:05.031686 [info ] [MainThread]: 
[0m20:31:05.032035 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m20:31:05.032325 [info ] [MainThread]: 
[0m20:31:05.032662 [error] [MainThread]:   Database Error in model fct_brands (models/reporting/fct_brands.sql)
  001003 (42000): SQL compilation error:
  syntax error line 112 at position 0 unexpected 'union'.
  syntax error line 125 at position 8 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands.sql
[0m20:31:05.032935 [info ] [MainThread]: 
[0m20:31:05.033217 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:31:05.035682 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5860207, "process_in_blocks": "0", "process_kernel_time": 0.589854, "process_mem_max_rss": "162807808", "process_out_blocks": "0", "process_user_time": 3.14509}
[0m20:31:05.036039 [debug] [MainThread]: Command `dbt run` failed at 20:31:05.035968 after 3.59 seconds
[0m20:31:05.036362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10329ce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a4cf3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a539460>]}
[0m20:31:05.036690 [debug] [MainThread]: Flushing usage events
[0m20:31:05.345865 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:31:24.767123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105090e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a5ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a5fc40>]}


============================== 20:31:24.770068 | 1e485011-0d75-4448-be51-7e27f893666b ==============================
[0m20:31:24.770068 [info ] [MainThread]: Running with dbt=1.9.3
[0m20:31:24.770478 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select fct_brands', 'send_anonymous_usage_stats': 'True'}
[0m20:31:25.349637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e485011-0d75-4448-be51-7e27f893666b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a2f250>]}
[0m20:31:25.380433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e485011-0d75-4448-be51-7e27f893666b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105659b20>]}
[0m20:31:25.380994 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m20:31:25.502509 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m20:31:25.581319 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:31:25.581703 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands.sql
[0m20:31:25.719543 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m20:31:25.728174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e485011-0d75-4448-be51-7e27f893666b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f05dee0>]}
[0m20:31:25.777770 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m20:31:25.779850 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m20:31:25.791918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e485011-0d75-4448-be51-7e27f893666b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ee5e9a0>]}
[0m20:31:25.792247 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m20:31:25.792455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e485011-0d75-4448-be51-7e27f893666b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec7bd00>]}
[0m20:31:25.793112 [info ] [MainThread]: 
[0m20:31:25.793322 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:31:25.793487 [info ] [MainThread]: 
[0m20:31:25.793768 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:31:25.794219 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m20:31:25.875346 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m20:31:25.875615 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m20:31:25.875783 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:31:26.976475 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.100 seconds
[0m20:31:26.989268 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m20:31:26.996493 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m20:31:27.006685 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m20:31:27.009797 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m20:31:27.010227 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m20:31:27.010629 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m20:31:27.011311 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:31:27.178436 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.167 seconds
[0m20:31:27.923671 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.912 seconds
[0m20:31:27.930112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e485011-0d75-4448-be51-7e27f893666b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f017ca0>]}
[0m20:31:27.934402 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands
[0m20:31:27.935372 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands ................................. [RUN]
[0m20:31:27.936177 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands)
[0m20:31:27.936777 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands
[0m20:31:27.954008 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands"
[0m20:31:27.955045 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands
[0m20:31:27.987347 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands"
[0m20:31:27.991402 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands"
[0m20:31:27.991844 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands"} */
create or replace transient table RAW.PUBLIC.fct_brands
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



-- Join receipt items with brands and users data
with receipt_items_with_details as (
    select
        ri.receipt_id,
        ri.barcode,
        ri.partner_item_id,
        try_cast(ri.final_price as float) as item_price,
        b.brand_id,
        b.brand_name,
        r.scanned_timestamp,
        r.user_id,
        try_cast(r.total_spent as float) as receipt_total_spent,
        u.created_timestamp as user_created_timestamp
    from RAW.PUBLIC_staging.staging_receipt_items ri 
    inner join RAW.PUBLIC_staging.staging_receipts r
        on ri.receipt_id = r.receipt_id
    left join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    left join RAW.PUBLIC_staging.staging_users u
        on r.user_id = u.user_id
    where b.brand_id is not null
),

-- Identify the most recent and previous months
month_ranges as (
    select
        date_trunc('month', max(scanned_timestamp)) as most_recent_month,
        dateadd('month', -1, date_trunc('month', max(scanned_timestamp))) as previous_month
    from receipt_items_with_details
),

-- Brand rankings for the most recent month
current_month_rankings as (
    select
        brand_id,
        brand_name,
        count(distinct receipt_id) as receipt_count,
        row_number() over (order by count(distinct receipt_id) desc) as rank,
        'Current Month' as time_period
    from receipt_items_with_details ri
    cross join month_ranges mr
    where date_trunc('month', ri.scanned_timestamp) = mr.most_recent_month
    group by brand_id, brand_name
),

-- Brand rankings for the previous month
previous_month_rankings as (
    select
        brand_id,
        brand_name,
        count(distinct receipt_id) as receipt_count,
        row_number() over (order by count(distinct receipt_id) desc) as rank,
        'Previous Month' as time_period
    from receipt_items_with_details ri
    cross join month_ranges mr
    where date_trunc('month', ri.scanned_timestamp) = mr.previous_month
    group by brand_id, brand_name
),

-- Top 5 brands from the current month
top_5_current_brands as (
    select *
    from current_month_rankings
    where rank <= 5
),

-- Join current and previous month data for comparison
month_over_month_comparison as (
    select
        c.brand_id,
        c.brand_name,
        c.receipt_count as current_month_count,
        c.rank as current_month_rank,
        p.receipt_count as previous_month_count,
        p.rank as previous_month_rank,
        case 
            when p.rank is null then 'New to Top 5'
            when c.rank < p.rank then 'Moved Up'
            when c.rank > p.rank then 'Moved Down'
            when c.rank = p.rank then 'Unchanged'
        end as rank_change,
        case
            when p.receipt_count is null or p.receipt_count = 0 then null
            else (c.receipt_count - p.receipt_count) / p.receipt_count * 100
        end as percent_change
    from top_5_current_brands c
    left join previous_month_rankings p
        on c.brand_id = p.brand_id
),

-- First result set: Top 5 brands from most recent month
result_set_1 as (
    select 
        'Question 1: Top 5 brands by receipts scanned for the most recent month' as analysis,
        brand_id,
        brand_name,
        current_month_count as receipt_count,
        current_month_rank as rank,
        null as previous_month_count,
        null as previous_month_rank,
        null as rank_change,
        null as percent_change
    from month_over_month_comparison
),

-- Second result set: Month-over-month comparison
result_set_2 as (
    select 
        'Question 2: Month-over-month comparison for top 5 brands' as analysis,
        brand_id,
        brand_name,
        current_month_count,
        current_month_rank,
        previous_month_count,
        previous_month_rank,
        rank_change,
        percent_change
    from month_over_month_comparison
)

-- Combine the result sets
select * from result_set_1
union all
select * from result_set_2
order by analysis, rank
        );
[0m20:31:31.340592 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 3.348 seconds
[0m20:31:31.380792 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e485011-0d75-4448-be51-7e27f893666b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f7722e0>]}
[0m20:31:31.381607 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands ............................ [[32mSUCCESS 1[0m in 3.44s]
[0m20:31:31.382219 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands
[0m20:31:31.383337 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:31:31.383646 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands' was left open.
[0m20:31:31.383940 [debug] [MainThread]: On model.fetch_analytics.fct_brands: Close
[0m20:31:31.461063 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m20:31:31.461627 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m20:31:31.542700 [info ] [MainThread]: 
[0m20:31:31.543426 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.75 seconds (5.75s).
[0m20:31:31.544595 [debug] [MainThread]: Command end result
[0m20:31:31.579085 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m20:31:31.580658 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m20:31:31.586875 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m20:31:31.587176 [info ] [MainThread]: 
[0m20:31:31.587542 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:31:31.587817 [info ] [MainThread]: 
[0m20:31:31.588107 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:31:31.590388 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.865007, "process_in_blocks": "0", "process_kernel_time": 0.530838, "process_mem_max_rss": "166739968", "process_out_blocks": "0", "process_user_time": 3.269347}
[0m20:31:31.590748 [debug] [MainThread]: Command `dbt run` succeeded at 20:31:31.590674 after 6.87 seconds
[0m20:31:31.591069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105090e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105659b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ee5e580>]}
[0m20:31:31.591436 [debug] [MainThread]: Flushing usage events
[0m20:31:31.659966 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:07:30.422818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032fcee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041ab070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041abd60>]}


============================== 21:07:30.425967 | d22f5517-5504-4a25-9bd6-99bbaa410712 ==============================
[0m21:07:30.425967 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:07:30.426333 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:07:31.105267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd22f5517-5504-4a25-9bd6-99bbaa410712', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104181e50>]}
[0m21:07:31.137301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd22f5517-5504-4a25-9bd6-99bbaa410712', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c31e20>]}
[0m21:07:31.137947 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:07:31.266667 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:07:31.355595 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:07:31.356006 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands.sql
[0m21:07:31.495563 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:07:31.504160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd22f5517-5504-4a25-9bd6-99bbaa410712', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12251aee0>]}
[0m21:07:31.554024 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:07:31.556547 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:07:31.570552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd22f5517-5504-4a25-9bd6-99bbaa410712', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12231e940>]}
[0m21:07:31.570864 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:07:31.571062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd22f5517-5504-4a25-9bd6-99bbaa410712', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12241e160>]}
[0m21:07:31.571713 [info ] [MainThread]: 
[0m21:07:31.571915 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:07:31.572078 [info ] [MainThread]: 
[0m21:07:31.572363 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:07:31.572809 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:07:31.647407 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:07:31.647669 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:07:31.647838 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:07:32.544221 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.896 seconds
[0m21:07:32.553305 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m21:07:32.560747 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m21:07:32.566916 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:07:32.569577 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:07:32.569965 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:07:32.570282 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:07:32.570845 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:07:32.963640 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.393 seconds
[0m21:07:33.185270 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.614 seconds
[0m21:07:33.190948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd22f5517-5504-4a25-9bd6-99bbaa410712', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117e79ac0>]}
[0m21:07:33.195020 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands
[0m21:07:33.195945 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands ................................. [RUN]
[0m21:07:33.196705 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands)
[0m21:07:33.197293 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands
[0m21:07:33.212738 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands"
[0m21:07:33.214870 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands
[0m21:07:33.247117 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands"
[0m21:07:33.249712 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands"
[0m21:07:33.250090 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands"} */
create or replace transient table RAW.PUBLIC.fct_brands
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



-- Join receipt items with brands and users data
with receipt_items_with_details as (
    select
        ri.receipt_id,
        ri.barcode,
        b.brand_id,
        b.brand_name,
        r.scanned_timestamp,
        date_trunc('month', r.scanned_timestamp) as purchase_month
    from RAW.PUBLIC_staging.staging_receipt_items ri 
    inner join RAW.PUBLIC_staging.staging_receipts r
        on ri.receipt_id = r.receipt_id
    left join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    where b.brand_id is not null
),

-- Identify most recent and previous month
month_info as (
    select
        max(purchase_month) as most_recent_month,
        dateadd('month', -1, max(purchase_month)) as previous_month
    from receipt_items_with_details
),

-- Calculate brand rankings by month with boolean flag
brand_ranking as (
    select
        rid.brand_id,
        rid.brand_name,
        rid.purchase_month,
        count(distinct rid.receipt_id) as total_receipts,
        rank() over (partition by rid.purchase_month order by count(distinct rid.receipt_id) desc) as rank,
        case
            when rid.purchase_month = mi.most_recent_month then false
            when rid.purchase_month = mi.previous_month then true
            else null
        end as is_previous_month
    from receipt_items_with_details rid
    cross join month_info mi
    where rid.purchase_month in (mi.most_recent_month, mi.previous_month)
    group by rid.brand_id, rid.brand_name, rid.purchase_month, mi.most_recent_month, mi.previous_month
)

-- Final output (most recent months first, then ranked by receipt count)
select
    brand_id,
    brand_name,
    purchase_month,
    total_receipts,
    rank,
    is_previous_month
from brand_ranking
order by purchase_month desc, rank
        );
[0m21:07:36.036933 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 2.786 seconds
[0m21:07:36.077385 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd22f5517-5504-4a25-9bd6-99bbaa410712', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123520f70>]}
[0m21:07:36.078172 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands ............................ [[32mSUCCESS 1[0m in 2.88s]
[0m21:07:36.078771 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands
[0m21:07:36.079925 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:07:36.080268 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands' was left open.
[0m21:07:36.080585 [debug] [MainThread]: On model.fetch_analytics.fct_brands: Close
[0m21:07:36.218077 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m21:07:36.218881 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m21:07:36.343990 [info ] [MainThread]: 
[0m21:07:36.345625 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.77 seconds (4.77s).
[0m21:07:36.346755 [debug] [MainThread]: Command end result
[0m21:07:36.381032 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:07:36.383125 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:07:36.389549 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:07:36.389857 [info ] [MainThread]: 
[0m21:07:36.390227 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:07:36.390496 [info ] [MainThread]: 
[0m21:07:36.390779 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:07:36.393191 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.0178394, "process_in_blocks": "0", "process_kernel_time": 0.638557, "process_mem_max_rss": "170115072", "process_out_blocks": "0", "process_user_time": 3.191728}
[0m21:07:36.393513 [debug] [MainThread]: Command `dbt run` succeeded at 21:07:36.393450 after 6.02 seconds
[0m21:07:36.393798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032fcee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10274cfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117eb4850>]}
[0m21:07:36.394091 [debug] [MainThread]: Flushing usage events
[0m21:07:36.632533 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:07:54.956828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bcfe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a7f0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a7fcd0>]}


============================== 21:07:54.959833 | 2618c126-b16e-4f95-b7c7-1e5b5118b39e ==============================
[0m21:07:54.959833 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:07:54.960346 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select fct_brands', 'send_anonymous_usage_stats': 'True'}
[0m21:07:55.591169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2618c126-b16e-4f95-b7c7-1e5b5118b39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a41610>]}
[0m21:07:55.622560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2618c126-b16e-4f95-b7c7-1e5b5118b39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a412e0>]}
[0m21:07:55.623223 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:07:55.746711 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:07:55.825844 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m21:07:55.826211 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:07:55.826391 [debug] [MainThread]: Partial parsing: deleted file: fetch_analytics://models/reporting/fct_brands.sql
[0m21:07:58.686503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10545cdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10630bfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10630bc10>]}


============================== 21:07:58.688916 | 2858b6a4-d819-4ea6-bad4-f6cb07cf5a1b ==============================
[0m21:07:58.688916 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:07:58.689251 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:07:59.125991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2858b6a4-d819-4ea6-bad4-f6cb07cf5a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062db3a0>]}
[0m21:07:59.158188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2858b6a4-d819-4ea6-bad4-f6cb07cf5a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105809700>]}
[0m21:07:59.158756 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:07:59.279644 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:07:59.353850 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m21:07:59.354214 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:07:59.354395 [debug] [MainThread]: Partial parsing: deleted file: fetch_analytics://models/reporting/fct_brands.sql
[0m21:07:59.497065 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m21:07:59.505698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2858b6a4-d819-4ea6-bad4-f6cb07cf5a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11db60130>]}
[0m21:07:59.555131 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:07:59.562126 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:07:59.576590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2858b6a4-d819-4ea6-bad4-f6cb07cf5a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d89e910>]}
[0m21:07:59.576959 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:07:59.577175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2858b6a4-d819-4ea6-bad4-f6cb07cf5a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d89d6d0>]}
[0m21:07:59.577872 [info ] [MainThread]: 
[0m21:07:59.578099 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:07:59.578345 [info ] [MainThread]: 
[0m21:07:59.578740 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:07:59.579287 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:07:59.657343 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:07:59.657642 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:07:59.657825 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:08:00.681573 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.024 seconds
[0m21:08:00.688715 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m21:08:00.689295 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m21:08:00.700192 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:08:00.702411 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:08:00.702787 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:08:00.703069 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:08:00.703585 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:08:00.853380 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.150 seconds
[0m21:08:01.376704 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.673 seconds
[0m21:08:01.382474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2858b6a4-d819-4ea6-bad4-f6cb07cf5a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d13c490>]}
[0m21:08:01.387941 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:08:01.388897 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:08:01.389655 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m21:08:01.390157 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:08:01.404657 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:08:01.405649 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:08:01.438031 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:08:01.440197 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:08:01.440572 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



-- Join receipt items with brands and users data
with receipt_items_with_details as (
    select
        ri.receipt_id,
        ri.barcode,
        b.brand_id,
        b.brand_name,
        r.scanned_timestamp,
        date_trunc('month', r.scanned_timestamp) as purchase_month
    from RAW.PUBLIC_staging.staging_receipt_items ri 
    inner join RAW.PUBLIC_staging.staging_receipts r
        on ri.receipt_id = r.receipt_id
    left join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    where b.brand_id is not null
),

-- Identify most recent and previous month
month_info as (
    select
        max(purchase_month) as most_recent_month,
        dateadd('month', -1, max(purchase_month)) as previous_month
    from receipt_items_with_details
),

-- Calculate brand rankings by month with boolean flag
brand_ranking as (
    select
        rid.brand_id,
        rid.brand_name,
        rid.purchase_month,
        count(distinct rid.receipt_id) as total_receipts,
        rank() over (partition by rid.purchase_month order by count(distinct rid.receipt_id) desc) as rank,
        case
            when rid.purchase_month = mi.most_recent_month then false
            when rid.purchase_month = mi.previous_month then true
            else null
        end as is_previous_month
    from receipt_items_with_details rid
    cross join month_info mi
    where rid.purchase_month in (mi.most_recent_month, mi.previous_month)
    group by rid.brand_id, rid.brand_name, rid.purchase_month, mi.most_recent_month, mi.previous_month
)

-- Final output (most recent months first, then ranked by receipt count)
select
    brand_id,
    brand_name,
    purchase_month,
    total_receipts,
    rank,
    is_previous_month
from brand_ranking
order by purchase_month desc, rank
        );
[0m21:08:03.274266 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.833 seconds
[0m21:08:03.313117 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2858b6a4-d819-4ea6-bad4-f6cb07cf5a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221a2e80>]}
[0m21:08:03.313950 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.92s]
[0m21:08:03.314573 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:08:03.315781 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:08:03.316086 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:08:03.316380 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:08:03.433331 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m21:08:03.433896 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m21:08:03.534179 [info ] [MainThread]: 
[0m21:08:03.534550 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.96 seconds (3.96s).
[0m21:08:03.535088 [debug] [MainThread]: Command end result
[0m21:08:03.586937 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:08:03.589846 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:08:03.595314 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:08:03.595729 [info ] [MainThread]: 
[0m21:08:03.596121 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:08:03.596388 [info ] [MainThread]: 
[0m21:08:03.596824 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:08:03.599779 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.9526844, "process_in_blocks": "0", "process_kernel_time": 0.677239, "process_mem_max_rss": "167395328", "process_out_blocks": "0", "process_user_time": 2.982811}
[0m21:08:03.600190 [debug] [MainThread]: Command `dbt run` succeeded at 21:08:03.600129 after 4.95 seconds
[0m21:08:03.600495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10545cdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10444da30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d2550d0>]}
[0m21:08:03.600779 [debug] [MainThread]: Flushing usage events
[0m21:08:03.677674 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:09:25.109857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d98e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c47fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c47c40>]}


============================== 21:09:25.113106 | 7301d919-7ce6-4a96-be0f-0d78654c784d ==============================
[0m21:09:25.113106 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:09:25.113470 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:09:25.674563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7301d919-7ce6-4a96-be0f-0d78654c784d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c17250>]}
[0m21:09:25.707031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7301d919-7ce6-4a96-be0f-0d78654c784d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105145b20>]}
[0m21:09:25.707688 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:09:25.832143 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:09:25.919538 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:09:25.919972 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:09:26.065881 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:09:26.074833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7301d919-7ce6-4a96-be0f-0d78654c784d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130b9dee0>]}
[0m21:09:26.125353 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:09:26.129945 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:09:26.143547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7301d919-7ce6-4a96-be0f-0d78654c784d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13099e430>]}
[0m21:09:26.143895 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:09:26.144107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7301d919-7ce6-4a96-be0f-0d78654c784d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041e76d0>]}
[0m21:09:26.144752 [info ] [MainThread]: 
[0m21:09:26.144956 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:09:26.145128 [info ] [MainThread]: 
[0m21:09:26.145423 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:09:26.145888 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:09:26.220136 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:09:26.220413 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:09:26.220582 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:09:27.226091 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.005 seconds
[0m21:09:27.236545 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m21:09:27.243557 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m21:09:27.259684 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:09:27.262177 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:09:27.262512 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:09:27.262846 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:09:27.263160 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:09:27.457582 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.194 seconds
[0m21:09:27.702895 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.440 seconds
[0m21:09:27.707515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7301d919-7ce6-4a96-be0f-0d78654c784d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110eda30>]}
[0m21:09:27.712603 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:09:27.713516 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:09:27.714196 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m21:09:27.714693 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:09:27.729236 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:09:27.730825 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:09:27.761967 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:09:27.764592 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:09:27.764988 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



-- Join receipt items with brands and users data
with receipt_items_with_details as (
    select
        ri.receipt_id,
        ri.barcode,
        b.brand_id,
        b.brand_name,
        r.scanned_timestamp,
        date_trunc('month', r.scanned_timestamp) as purchase_month
    from RAW.PUBLIC_staging.staging_receipt_items ri 
    inner join RAW.PUBLIC_staging.staging_receipts r
        on ri.receipt_id = r.receipt_id
    left join RAW.PUBLIC_staging.staging_brands b
        on ri.barcode = b.barcode
    where b.brand_id is not null
),

-- Identify months and rank them
month_ranked as (
    select
        purchase_month,
        rank() over (order by purchase_month desc) as month_rank
    from (
        select distinct purchase_month
        from receipt_items_with_details
    )
),

-- Calculate brand rankings by month
brand_ranking as (
    select
        rid.brand_id,
        rid.brand_name,
        rid.purchase_month,
        count(distinct rid.receipt_id) as total_receipts,
        rank() over (partition by rid.purchase_month order by count(distinct rid.receipt_id) desc) as rank,
        mr.month_rank
    from receipt_items_with_details rid
    join month_ranked mr on rid.purchase_month = mr.purchase_month
    group by rid.brand_id, rid.brand_name, rid.purchase_month, mr.month_rank
)

-- Final output (most recent months first, then ranked by receipt count)
select
    brand_id,
    brand_name,
    purchase_month,
    total_receipts,
    rank,
    month_rank
from brand_ranking
where month_rank <= 2  -- Current and previous month only
order by purchase_month desc, rank
        );
[0m21:09:29.594939 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.830 seconds
[0m21:09:29.626908 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7301d919-7ce6-4a96-be0f-0d78654c784d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13139bfa0>]}
[0m21:09:29.627546 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.91s]
[0m21:09:29.628085 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:09:29.629088 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:09:29.629357 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:09:29.629617 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:09:29.710083 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m21:09:29.710666 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m21:09:29.803929 [info ] [MainThread]: 
[0m21:09:29.804889 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.66 seconds (3.66s).
[0m21:09:29.806258 [debug] [MainThread]: Command end result
[0m21:09:29.842586 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:09:29.844343 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:09:29.850994 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:09:29.851313 [info ] [MainThread]: 
[0m21:09:29.851688 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:09:29.851961 [info ] [MainThread]: 
[0m21:09:29.852249 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:09:29.854512 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.786864, "process_in_blocks": "0", "process_kernel_time": 0.507819, "process_mem_max_rss": "166789120", "process_out_blocks": "0", "process_user_time": 3.134755}
[0m21:09:29.854871 [debug] [MainThread]: Command `dbt run` succeeded at 21:09:29.854801 after 4.79 seconds
[0m21:09:29.855196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d98e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105145b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13099ea00>]}
[0m21:09:29.855530 [debug] [MainThread]: Flushing usage events
[0m21:09:30.033254 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:28:25.580196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100ebeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b9ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b9fc40>]}


============================== 21:28:25.583393 | 644b2070-bf28-4d5e-893a-9a350c4c8107 ==============================
[0m21:28:25.583393 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:28:25.583768 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:28:26.272196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '644b2070-bf28-4d5e-893a-9a350c4c8107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10669e220>]}
[0m21:28:26.303531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '644b2070-bf28-4d5e-893a-9a350c4c8107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11160a070>]}
[0m21:28:26.304138 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:28:26.430514 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:28:26.517013 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:28:26.517412 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:28:26.660840 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m21:28:26.669698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '644b2070-bf28-4d5e-893a-9a350c4c8107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14381f130>]}
[0m21:28:26.718942 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:28:26.722468 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:28:26.735921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '644b2070-bf28-4d5e-893a-9a350c4c8107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14365e460>]}
[0m21:28:26.736256 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:28:26.736495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '644b2070-bf28-4d5e-893a-9a350c4c8107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106767130>]}
[0m21:28:26.737150 [info ] [MainThread]: 
[0m21:28:26.737361 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:28:26.737530 [info ] [MainThread]: 
[0m21:28:26.737823 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:28:26.738280 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:28:26.810195 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:28:26.810493 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:28:26.810675 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:27.884980 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.074 seconds
[0m21:28:27.895343 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m21:28:27.896450 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m21:28:27.919208 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:28:27.924207 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:28:27.924562 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:28:27.924904 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:28:27.925313 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:28.046207 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.121 seconds
[0m21:28:28.394468 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.469 seconds
[0m21:28:28.399251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '644b2070-bf28-4d5e-893a-9a350c4c8107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143868730>]}
[0m21:28:28.403719 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:28:28.404661 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:28:28.405415 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m21:28:28.405999 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:28:28.421721 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:28:28.423134 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:28:28.456622 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:28:28.458672 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:28:28.459025 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with
    -- Aggregate receipt counts by brand and month
    monthly_data as (
        select
            b.brand_name,
            date_trunc('month', r.scanned_timestamp) as month_start,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipt_items ri
        inner join RAW.PUBLIC_staging.staging_receipts r 
            on ri.receipt_id = r.receipt_id
        left join RAW.PUBLIC_staging.staging_brands b 
            on ri.barcode = b.barcode
        where 
            -- Focus on the most recent 2 months
            date_trunc('month', r.scanned_timestamp) >= dateadd('month', -1, date_trunc('month', max(r.scanned_timestamp)))
            and b.brand_id is not null
        group by b.brand_name, date_trunc('month', r.scanned_timestamp)
    ),
    
    -- Rank brands within each month
    ranked as (
        select
            brand_name,
            month_start,
            receipt_count,
            rank() over (
                partition by month_start order by receipt_count desc
            ) as rank_in_month,
            case
                when month_start = (select max(month_start) from monthly_data) then false
                else true
            end as is_previous_month
        from monthly_data
    )

-- Final output sorted by month (newest first) and rank
select
    brand_name,
    month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from ranked
order by month_start desc, rank_in_month
        );
[0m21:28:28.640927 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb1478-0000-ca4b-0000-00015dbea2a1
[0m21:28:28.641304 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002035 (42601): SQL compilation error:
Invalid aggregate function in where clause [MAX(R.SCANNED_TIMESTAMP)]
[0m21:28:28.647163 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  002035 (42601): SQL compilation error:
  Invalid aggregate function in where clause [MAX(R.SCANNED_TIMESTAMP)]
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:28:28.648560 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '644b2070-bf28-4d5e-893a-9a350c4c8107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15003c340>]}
[0m21:28:28.649022 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.24s]
[0m21:28:28.649418 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:28:28.649761 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  002035 (42601): SQL compilation error:
  Invalid aggregate function in where clause [MAX(R.SCANNED_TIMESTAMP)]
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m21:28:28.650503 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:28:28.650736 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:28:28.650930 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:28:28.729768 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m21:28:28.730218 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m21:28:28.817903 [info ] [MainThread]: 
[0m21:28:28.818608 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.08 seconds (2.08s).
[0m21:28:28.819569 [debug] [MainThread]: Command end result
[0m21:28:28.850741 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:28:28.852115 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:28:28.858730 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:28:28.859035 [info ] [MainThread]: 
[0m21:28:28.859343 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:28:28.859599 [info ] [MainThread]: 
[0m21:28:28.859900 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  002035 (42601): SQL compilation error:
  Invalid aggregate function in where clause [MAX(R.SCANNED_TIMESTAMP)]
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:28:28.860142 [info ] [MainThread]: 
[0m21:28:28.860391 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:28:28.862664 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.3295934, "process_in_blocks": "0", "process_kernel_time": 0.680882, "process_mem_max_rss": "166756352", "process_out_blocks": "0", "process_user_time": 3.100079}
[0m21:28:28.863018 [debug] [MainThread]: Command `dbt run` failed at 21:28:28.862946 after 3.33 seconds
[0m21:28:28.863326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100ebeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10669e220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14365e670>]}
[0m21:28:28.863635 [debug] [MainThread]: Flushing usage events
[0m21:28:29.028511 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:28:43.433254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10730feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184dffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184dfc40>]}


============================== 21:28:43.436139 | de12cb05-478d-4458-a54f-1939e65230e2 ==============================
[0m21:28:43.436139 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:28:43.436482 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:28:43.901983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'de12cb05-478d-4458-a54f-1939e65230e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061ca220>]}
[0m21:28:43.933271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'de12cb05-478d-4458-a54f-1939e65230e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e4a070>]}
[0m21:28:43.934067 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:28:44.060349 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:28:44.144743 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:28:44.145187 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:28:44.294490 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m21:28:44.303746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'de12cb05-478d-4458-a54f-1939e65230e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1432a0130>]}
[0m21:28:44.355685 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:28:44.357820 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:28:44.370511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'de12cb05-478d-4458-a54f-1939e65230e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1430de460>]}
[0m21:28:44.370853 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:28:44.371049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'de12cb05-478d-4458-a54f-1939e65230e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106293130>]}
[0m21:28:44.371690 [info ] [MainThread]: 
[0m21:28:44.371896 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:28:44.372062 [info ] [MainThread]: 
[0m21:28:44.372348 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:28:44.372818 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:28:44.448249 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:28:44.448532 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:28:44.448707 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:44.931628 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.483 seconds
[0m21:28:44.939571 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m21:28:44.940511 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m21:28:44.947920 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:28:44.951538 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:28:44.952036 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:28:44.952318 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:28:44.952542 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:45.048499 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.095 seconds
[0m21:28:45.436242 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.483 seconds
[0m21:28:45.443906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'de12cb05-478d-4458-a54f-1939e65230e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1432e7730>]}
[0m21:28:45.454903 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:28:45.455799 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:28:45.456697 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m21:28:45.457276 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:28:45.468493 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:28:45.469652 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:28:45.513331 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:28:45.516979 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:28:45.517407 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with
    -- Aggregate receipt counts by brand and month
    monthly_data as (
        select
            b.brand_name,
            date_trunc('month', r.scanned_timestamp) as month_start,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipt_items ri
        inner join RAW.PUBLIC_staging.staging_receipts r 
            on ri.receipt_id = r.receipt_id
        left join RAW.PUBLIC_staging.staging_brands b 
            on ri.barcode = b.barcode
        where 
            b.brand_id is not null
        group by b.brand_name, date_trunc('month', r.scanned_timestamp)
    ),
    
    -- Get the most recent two months
    recent_months as (
        select
            max(month_start) as most_recent_month,
            dateadd('month', -1, max(month_start)) as previous_month
        from monthly_data
    ),
    
    -- Filter to just the most recent two months
    filtered_months as (
        select
            md.brand_name,
            md.month_start,
            md.receipt_count
        from monthly_data md
        cross join recent_months rm
        where md.month_start in (rm.most_recent_month, rm.previous_month)
    ),
    
    -- Rank brands within each month
    ranked as (
        select
            brand_name,
            month_start,
            receipt_count,
            rank() over (
                partition by month_start order by receipt_count desc
            ) as rank_in_month,
            case
                when month_start = (select most_recent_month from recent_months) then false
                else true
            end as is_previous_month
        from filtered_months
    )

-- Final output with top 5 brands per month
select
    brand_name,
    month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from ranked
where rank_in_month <= 5 -- Only top 5 brands per month
order by month_start desc, rank_in_month
        );
[0m21:28:48.056027 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 2.537 seconds
[0m21:28:48.095001 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'de12cb05-478d-4458-a54f-1939e65230e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1442d8f40>]}
[0m21:28:48.095786 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 2.64s]
[0m21:28:48.096444 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:28:48.097805 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:28:48.098118 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:28:48.098423 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:28:48.660523 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m21:28:48.661472 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m21:28:48.756037 [info ] [MainThread]: 
[0m21:28:48.757129 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.38 seconds (4.38s).
[0m21:28:48.758687 [debug] [MainThread]: Command end result
[0m21:28:48.794892 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:28:48.797176 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:28:48.803894 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:28:48.804217 [info ] [MainThread]: 
[0m21:28:48.804607 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:28:48.804884 [info ] [MainThread]: 
[0m21:28:48.805187 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:28:48.807717 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.4159017, "process_in_blocks": "0", "process_kernel_time": 0.658106, "process_mem_max_rss": "164200448", "process_out_blocks": "0", "process_user_time": 2.971133}
[0m21:28:48.808138 [debug] [MainThread]: Command `dbt run` succeeded at 21:28:48.808071 after 5.42 seconds
[0m21:28:48.808469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10730feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1431a1310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e45970>]}
[0m21:28:48.808778 [debug] [MainThread]: Flushing usage events
[0m21:28:48.887172 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:30:21.267987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077cce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10867b0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10867bcd0>]}


============================== 21:30:21.270990 | fcccda01-fa28-4cfe-8bc8-9283b0f05dfe ==============================
[0m21:30:21.270990 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:30:21.271363 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:30:21.993413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fcccda01-fa28-4cfe-8bc8-9283b0f05dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10863e610>]}
[0m21:30:22.026834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fcccda01-fa28-4cfe-8bc8-9283b0f05dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10863e2e0>]}
[0m21:30:22.027591 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:30:22.151982 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:30:22.261074 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:30:22.261572 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:30:22.404373 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m21:30:22.413394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fcccda01-fa28-4cfe-8bc8-9283b0f05dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118c9f130>]}
[0m21:30:22.464643 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:30:22.467382 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:30:22.481476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fcccda01-fa28-4cfe-8bc8-9283b0f05dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1189de6d0>]}
[0m21:30:22.481841 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:30:22.482060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fcccda01-fa28-4cfe-8bc8-9283b0f05dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107321070>]}
[0m21:30:22.482760 [info ] [MainThread]: 
[0m21:30:22.482990 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:30:22.483163 [info ] [MainThread]: 
[0m21:30:22.483456 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:30:22.483976 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:30:22.560577 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:30:22.560840 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:30:22.561006 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:30:23.562434 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.001 seconds
[0m21:30:23.575259 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m21:30:23.576188 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m21:30:23.592861 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:30:23.595781 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:30:23.596275 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:30:23.596610 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:30:23.597198 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:30:23.821385 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.224 seconds
[0m21:30:24.045358 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.448 seconds
[0m21:30:24.052022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fcccda01-fa28-4cfe-8bc8-9283b0f05dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11832d9a0>]}
[0m21:30:24.057451 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:30:24.058423 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:30:24.059228 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m21:30:24.059807 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:30:24.075353 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:30:24.078957 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:30:24.110273 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:30:24.112556 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:30:24.112924 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with
    -- Aggregate receipt counts by brand and month
    monthly_data as (
        select
            b.brand_name,
            date_trunc('month', r.scanned_timestamp) as month_start,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipt_items ri
        inner join RAW.PUBLIC_staging.staging_receipts r 
            on ri.receipt_id = r.receipt_id
        left join RAW.PUBLIC_staging.staging_brands b 
            on ri.barcode = b.barcode
        where 
            -- Focus on the most recent 2 months
            date_trunc('month', r.scanned_timestamp) >= dateadd('month', -1, date_trunc('month', max(r.scanned_timestamp)))
            and b.brand_id is not null
        group by b.brand_name, date_trunc('month', r.scanned_timestamp)
    ),
    
    -- Rank brands within each month
    ranked as (
        select
            brand_name,
            month_start,
            receipt_count,
            rank() over (
                partition by month_start order by receipt_count desc
            ) as rank_in_month,
            case
                when month_start = (select max(month_start) from monthly_data) then false
                else true
            end as is_previous_month
        from monthly_data
    )

-- Final output sorted by month (newest first) and rank
select
    brand_name,
    month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from ranked
order by month_start desc, rank_in_month
        );
[0m21:30:24.399017 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb147a-0000-ca21-0001-5dbe0001c026
[0m21:30:24.399426 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 002035 (42601): SQL compilation error:
Invalid aggregate function in where clause [MAX(R.SCANNED_TIMESTAMP)]
[0m21:30:24.406158 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  002035 (42601): SQL compilation error:
  Invalid aggregate function in where clause [MAX(R.SCANNED_TIMESTAMP)]
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:30:24.407795 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcccda01-fa28-4cfe-8bc8-9283b0f05dfe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119bb39d0>]}
[0m21:30:24.408300 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.35s]
[0m21:30:24.408731 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:30:24.409088 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  002035 (42601): SQL compilation error:
  Invalid aggregate function in where clause [MAX(R.SCANNED_TIMESTAMP)]
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m21:30:24.409848 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:30:24.410047 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:30:24.410239 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:30:24.491449 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m21:30:24.491848 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m21:30:24.574030 [info ] [MainThread]: 
[0m21:30:24.574584 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.09 seconds (2.09s).
[0m21:30:24.575405 [debug] [MainThread]: Command end result
[0m21:30:24.601521 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:30:24.603361 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:30:24.609267 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:30:24.609515 [info ] [MainThread]: 
[0m21:30:24.609797 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:30:24.610031 [info ] [MainThread]: 
[0m21:30:24.610305 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  002035 (42601): SQL compilation error:
  Invalid aggregate function in where clause [MAX(R.SCANNED_TIMESTAMP)]
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:30:24.610526 [info ] [MainThread]: 
[0m21:30:24.610769 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:30:24.612695 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.3862255, "process_in_blocks": "0", "process_kernel_time": 0.586005, "process_mem_max_rss": "163282944", "process_out_blocks": "0", "process_user_time": 3.177482}
[0m21:30:24.613011 [debug] [MainThread]: Command `dbt run` failed at 21:30:24.612953 after 3.39 seconds
[0m21:30:24.613305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077cce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085f8f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1189ded90>]}
[0m21:30:24.613579 [debug] [MainThread]: Flushing usage events
[0m21:30:24.909943 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:31:27.036442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105483eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106333fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106333c40>]}


============================== 21:31:27.039630 | 68df2f3f-5f32-4b3b-b27f-11bd9a7dce71 ==============================
[0m21:31:27.039630 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:31:27.040005 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_brands_recent', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:31:27.525277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '68df2f3f-5f32-4b3b-b27f-11bd9a7dce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10455a220>]}
[0m21:31:27.556476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '68df2f3f-5f32-4b3b-b27f-11bd9a7dce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d9e070>]}
[0m21:31:27.557149 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:31:27.678091 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:31:27.762935 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:31:27.763313 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:31:27.900687 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:31:27.909949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '68df2f3f-5f32-4b3b-b27f-11bd9a7dce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f20130>]}
[0m21:31:27.960754 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:31:27.964491 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:31:27.977240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '68df2f3f-5f32-4b3b-b27f-11bd9a7dce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f3fc70>]}
[0m21:31:27.977553 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:31:27.977754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '68df2f3f-5f32-4b3b-b27f-11bd9a7dce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150939700>]}
[0m21:31:27.978399 [info ] [MainThread]: 
[0m21:31:27.978616 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:31:27.978781 [info ] [MainThread]: 
[0m21:31:27.979065 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:31:27.979521 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:31:28.059915 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:31:28.060184 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:31:28.060352 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:29.340929 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.280 seconds
[0m21:31:29.353329 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m21:31:29.360952 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m21:31:29.370261 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:31:29.373266 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:31:29.373712 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:31:29.374100 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:31:29.374808 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:29.544274 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.170 seconds
[0m21:31:30.232908 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.858 seconds
[0m21:31:30.238482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '68df2f3f-5f32-4b3b-b27f-11bd9a7dce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f71820>]}
[0m21:31:30.243672 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:31:30.244613 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:31:30.245387 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m21:31:30.245972 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:31:30.262522 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:31:30.263541 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:31:30.297327 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:31:30.299863 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:31:30.300252 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with
    -- First identify the most recent month
    latest_months as (
        select
            max(date_trunc('month', scanned_timestamp)) as most_recent_month,
            dateadd('month', -1, max(date_trunc('month', scanned_timestamp))) as previous_month
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Aggregate receipt counts by brand and month
    monthly_data as (
        select
            b.brand_name,
            date_trunc('month', r.scanned_timestamp) as month_start,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipt_items ri
        inner join RAW.PUBLIC_staging.staging_receipts r 
            on ri.receipt_id = r.receipt_id
        left join RAW.PUBLIC_staging.staging_brands b 
            on ri.barcode = b.barcode
        cross join latest_months lm
        where 
            -- Focus on the most recent 2 months
            date_trunc('month', r.scanned_timestamp) in (lm.most_recent_month, lm.previous_month)
            and b.brand_id is not null
        group by b.brand_name, date_trunc('month', r.scanned_timestamp)
    ),
    
    -- Rank brands within each month
    ranked as (
        select
            brand_name,
            month_start,
            receipt_count,
            rank() over (
                partition by month_start order by receipt_count desc
            ) as rank_in_month,
            case
                when month_start = (select most_recent_month from latest_months) then false
                else true
            end as is_previous_month
        from monthly_data
    )

-- Final output sorted by month (newest first) and rank
select
    brand_name,
    month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from ranked
where rank_in_month <= 5  -- Only include top 5 brands per month
order by month_start desc, rank_in_month
        );
[0m21:31:31.887363 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.586 seconds
[0m21:31:31.927513 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68df2f3f-5f32-4b3b-b27f-11bd9a7dce71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151e56fd0>]}
[0m21:31:31.928284 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.68s]
[0m21:31:31.928884 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:31:31.930020 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:31:31.930375 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:31:31.930698 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:31:32.013850 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m21:31:32.014384 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m21:31:32.107482 [info ] [MainThread]: 
[0m21:31:32.108302 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.13 seconds (4.13s).
[0m21:31:32.109447 [debug] [MainThread]: Command end result
[0m21:31:32.192198 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:31:32.215323 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:31:32.256410 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:31:32.256763 [info ] [MainThread]: 
[0m21:31:32.257028 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:31:32.257217 [info ] [MainThread]: 
[0m21:31:32.257414 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:31:32.259353 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.266733, "process_in_blocks": "0", "process_kernel_time": 0.722355, "process_mem_max_rss": "165724160", "process_out_blocks": "0", "process_user_time": 2.989461}
[0m21:31:32.259932 [debug] [MainThread]: Command `dbt run` succeeded at 21:31:32.259675 after 5.27 seconds
[0m21:31:32.260732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105483eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d9e070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105608a00>]}
[0m21:31:32.263560 [debug] [MainThread]: Flushing usage events
[0m21:31:32.358946 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:40:05.974422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107813eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086c4fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086c4c40>]}


============================== 21:40:05.978056 | 5dca18b2-906f-4f69-aec0-170527fd4d7d ==============================
[0m21:40:05.978056 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:40:05.978419 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_brands_recent', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:40:06.645093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5dca18b2-906f-4f69-aec0-170527fd4d7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068ea220>]}
[0m21:40:06.676618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5dca18b2-906f-4f69-aec0-170527fd4d7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10812e070>]}
[0m21:40:06.677156 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:40:06.799324 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:40:06.885223 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:40:06.885600 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:40:07.022871 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m21:40:07.031715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5dca18b2-906f-4f69-aec0-170527fd4d7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e41aee0>]}
[0m21:40:07.081117 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:40:07.084831 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:40:07.097736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5dca18b2-906f-4f69-aec0-170527fd4d7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e40a7c0>]}
[0m21:40:07.098049 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:40:07.098253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5dca18b2-906f-4f69-aec0-170527fd4d7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dce15b0>]}
[0m21:40:07.098888 [info ] [MainThread]: 
[0m21:40:07.099100 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:40:07.099264 [info ] [MainThread]: 
[0m21:40:07.099548 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:40:07.099998 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:40:07.177168 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:40:07.177468 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:40:07.177646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:08.087469 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.910 seconds
[0m21:40:08.100214 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m21:40:08.101222 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m21:40:08.116842 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:40:08.119786 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:40:08.120305 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:40:08.120675 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:40:08.121342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:40:08.245793 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.125 seconds
[0m21:40:08.644344 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.523 seconds
[0m21:40:08.650408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5dca18b2-906f-4f69-aec0-170527fd4d7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e1bf730>]}
[0m21:40:08.655359 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:40:08.656287 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:40:08.657068 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m21:40:08.657664 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:40:08.673522 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:40:08.675268 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:40:08.707787 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:40:08.710844 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:40:08.711283 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with
    -- Get base staging tables
    stg_receipts as (
        select * from RAW.PUBLIC_staging.staging_receipts
    ),
    
    stg_receipt_items as (
        select * from RAW.PUBLIC_staging.staging_receipt_items
    ),
    
    stg_brands as (
        select * from RAW.PUBLIC_staging.staging_brands
    ),
    
    -- Determine the maximum date in the dataset
    max_date as (
        select max(scanned_timestamp) as max_date
        from stg_receipts
    ),
    
    -- Define the most recent complete month (month before current)
    recent_month as (
        select 
            date_trunc('month', max_date) - interval '1 month' as month_start,
            date_trunc('month', max_date) as month_end
        from max_date
    ),
    
    -- Define the previous month (month before the recent month)
    previous_month as (
        select 
            month_start - interval '1 month' as month_start,
            month_start as month_end
        from recent_month
    ),
    
    -- Combine both month ranges
    month_ranges as (
        select 
            month_start,
            month_end,
            'Current' as month_type
        from recent_month
        
        union all
        
        select
            month_start,
            month_end,
            'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipts from the two relevant months
    filtered_receipts as (
        select 
            r.*,
            mr.month_type
        from stg_receipts r
        cross join month_ranges mr
        where r.scanned_timestamp >= mr.month_start
          and r.scanned_timestamp < mr.month_end
    ),
    
    -- Count receipts by brand for each month
    brand_counts as (
        select
            b.brand_name,
            fr.month_type,
            count(distinct fr.receipt_id) as receipt_count
        from filtered_receipts fr
        join stg_receipt_items ri on fr.receipt_id = ri.receipt_id
        join stg_brands b on ri.barcode = b.barcode
        where b.brand_id is not null
        group by 
            b.brand_name,
            fr.month_type
    ),
    
    -- Rank the brands within each month
    ranked_brands as (
        select
            brand_name,
            month_type,
            receipt_count,
            rank() over (partition by month_type order by receipt_count desc) as rank_in_month,
            case
                when month_type = 'Previous' then true
                else false
            end as is_previous_month
        from brand_counts
    )

-- Final output with top 5 brands per month
select
    brand_name,
    case
        when month_type = 'Current' then (select month_start from recent_month)
        else (select month_start from previous_month)
    end as month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from ranked_brands
where rank_in_month <= 5
order by 
    case when month_type = 'Current' then 0 else 1 end,  -- Current month first
    rank_in_month
        );
[0m21:40:09.913158 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.201 seconds
[0m21:40:09.950537 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5dca18b2-906f-4f69-aec0-170527fd4d7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb1af40>]}
[0m21:40:09.951349 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.29s]
[0m21:40:09.951954 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:40:09.953148 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:40:09.953506 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:40:09.953829 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:40:10.046477 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m21:40:10.047084 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m21:40:10.142864 [info ] [MainThread]: 
[0m21:40:10.143737 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.04 seconds (3.04s).
[0m21:40:10.145071 [debug] [MainThread]: Command end result
[0m21:40:10.180950 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:40:10.182659 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:40:10.189619 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:40:10.189932 [info ] [MainThread]: 
[0m21:40:10.190307 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:40:10.190580 [info ] [MainThread]: 
[0m21:40:10.190903 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:40:10.193426 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.264398, "process_in_blocks": "0", "process_kernel_time": 0.609293, "process_mem_max_rss": "167428096", "process_out_blocks": "0", "process_user_time": 3.260425}
[0m21:40:10.193815 [debug] [MainThread]: Command `dbt run` succeeded at 21:40:10.193741 after 4.26 seconds
[0m21:40:10.194146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107813eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10812e070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11db79550>]}
[0m21:40:10.194475 [debug] [MainThread]: Flushing usage events
[0m21:40:10.353451 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:42:31.748573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103dbeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125a00d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125a0c70>]}


============================== 21:42:31.751722 | c2a5604b-44e2-43b0-8408-1254c69f34ca ==============================
[0m21:42:31.751722 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:42:31.752089 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select fct_brands_recent', 'send_anonymous_usage_stats': 'True'}
[0m21:42:32.253100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c2a5604b-44e2-43b0-8408-1254c69f34ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab641c0>]}
[0m21:42:32.287845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c2a5604b-44e2-43b0-8408-1254c69f34ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab943d0>]}
[0m21:42:32.288528 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:42:32.412971 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:42:32.510897 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:42:32.511299 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:42:32.648907 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:42:32.657529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c2a5604b-44e2-43b0-8408-1254c69f34ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b39f130>]}
[0m21:42:32.707261 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:42:32.709935 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:42:32.723519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c2a5604b-44e2-43b0-8408-1254c69f34ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b1e4e80>]}
[0m21:42:32.723850 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:42:32.724052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2a5604b-44e2-43b0-8408-1254c69f34ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10729eb50>]}
[0m21:42:32.724688 [info ] [MainThread]: 
[0m21:42:32.724899 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:42:32.725066 [info ] [MainThread]: 
[0m21:42:32.725357 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:42:32.725797 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:42:32.798938 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:42:32.799214 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:42:32.799386 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:42:34.128635 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.329 seconds
[0m21:42:34.141837 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m21:42:34.142907 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m21:42:34.158728 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:42:34.161642 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:42:34.162139 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:42:34.162510 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:42:34.163188 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:42:34.266492 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.104 seconds
[0m21:42:34.787333 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.624 seconds
[0m21:42:34.792909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2a5604b-44e2-43b0-8408-1254c69f34ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab2d9a0>]}
[0m21:42:34.799256 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:42:34.800166 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:42:34.800936 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m21:42:34.801435 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:42:34.816856 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:42:34.820025 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:42:34.851296 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:42:34.855590 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:42:34.856088 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with
    -- Get base staging tables
    stg_receipts as (
        select * from RAW.PUBLIC_staging.staging_receipts
    ),
    
    stg_receipt_items as (
        select * from RAW.PUBLIC_staging.staging_receipt_items
    ),
    
    stg_brands as (
        select * from RAW.PUBLIC_staging.staging_brands
    ),
    
    -- Determine the maximum date in the dataset
    max_date as (
        select max(scanned_timestamp) as max_date
        from stg_receipts
    ),
    
    -- Define the most recent complete month (month before current)
    recent_month as (
        select 
            date_trunc('month', max_date) - interval '1 month' as month_start,
            date_trunc('month', max_date) as month_end
        from max_date
    ),
    
    -- Define the previous month (month before the recent month)
    previous_month as (
        select 
            month_start - interval '1 month' as month_start,
            month_start as month_end
        from recent_month
    ),
    
    -- Combine both month ranges
    month_ranges as (
        select 
            month_start,
            month_end,
            'Current' as month_type
        from recent_month
        
        union all
        
        select
            month_start,
            month_end,
            'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipts from the two relevant months
    filtered_receipts as (
        select 
            r.*,
            mr.month_type
        from stg_receipts r
        cross join month_ranges mr
        where r.scanned_timestamp >= mr.month_start
          and r.scanned_timestamp < mr.month_end
    ),
    
    -- Count receipts by brand for each month
    brand_counts as (
        select
            b.brand_name,
            fr.month_type,
            count(distinct fr.receipt_id) as receipt_count
        from filtered_receipts fr
        join stg_receipt_items ri on fr.receipt_id = ri.receipt_id
        join stg_brands b on ri.barcode = b.barcode
        where b.brand_id is not null
        group by 
            b.brand_name,
            fr.month_type
    ),
    
    -- Rank the brands within each month
    ranked_brands as (
        select
            brand_name,
            month_type,
            receipt_count,
            rank() over (partition by month_type order by receipt_count desc) as rank_in_month,
            case
                when month_type = 'Previous' then true
                else false
            end as is_previous_month
        from brand_counts
    ),
    
    -- Ensure we have 5 rows per month even if data is missing
    current_month_brands as (
        select 
            brand_name,
            month_type,
            receipt_count,
            rank_in_month,
            is_previous_month
        from ranked_brands
        where month_type = 'Current' and rank_in_month <= 5
        
        union all
        
        select 
            'No Data' as brand_name,
            'Current' as month_type,
            0 as receipt_count,
            row_number() over (order by seq4()) + (select count(*) from ranked_brands where month_type = 'Current') as rank_in_month,
            false as is_previous_month
        from table(generator(rowcount => 5))
        where (select count(*) from ranked_brands where month_type = 'Current') < 5
        limit 5 - (select count(*) from ranked_brands where month_type = 'Current')
    ),
    
    previous_month_brands as (
        select 
            brand_name,
            month_type,
            receipt_count,
            rank_in_month,
            is_previous_month
        from ranked_brands
        where month_type = 'Previous' and rank_in_month <= 5
        
        union all
        
        select 
            'No Data' as brand_name,
            'Previous' as month_type,
            0 as receipt_count,
            row_number() over (order by seq4()) + (select count(*) from ranked_brands where month_type = 'Previous') as rank_in_month,
            true as is_previous_month
        from table(generator(rowcount => 5))
        where (select count(*) from ranked_brands where month_type = 'Previous') < 5
        limit 5 - (select count(*) from ranked_brands where month_type = 'Previous')
    )

-- Final output with guaranteed 5 rows per month
select
    brand_name,
    case
        when month_type = 'Current' then (select month_start from recent_month)
        else (select month_start from previous_month)
    end as month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from current_month_brands

union all

select
    brand_name,
    case
        when month_type = 'Current' then (select month_start from recent_month)
        else (select month_start from previous_month)
    end as month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from previous_month_brands

order by 
    case when is_previous_month then 1 else 0 end,
    rank_in_month
        );
[0m21:42:35.033121 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb1486-0000-ca41-0001-5dbe000101d2
[0m21:42:35.033420 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 123 at position 16 unexpected '-'.
syntax error line 124 at position 5 unexpected ','.
[0m21:42:35.038753 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 123 at position 16 unexpected '-'.
  syntax error line 124 at position 5 unexpected ','.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:42:35.040007 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2a5604b-44e2-43b0-8408-1254c69f34ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c2bcbb0>]}
[0m21:42:35.040409 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.24s]
[0m21:42:35.040754 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:42:35.041071 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 123 at position 16 unexpected '-'.
  syntax error line 124 at position 5 unexpected ','.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m21:42:35.041707 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:42:35.041884 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:42:35.042047 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:42:35.136160 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m21:42:35.136618 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m21:42:35.253690 [info ] [MainThread]: 
[0m21:42:35.254408 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.53 seconds (2.53s).
[0m21:42:35.255567 [debug] [MainThread]: Command end result
[0m21:42:35.289218 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:42:35.290893 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:42:35.297114 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:42:35.297428 [info ] [MainThread]: 
[0m21:42:35.297779 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:42:35.298068 [info ] [MainThread]: 
[0m21:42:35.298399 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 123 at position 16 unexpected '-'.
  syntax error line 124 at position 5 unexpected ','.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:42:35.298669 [info ] [MainThread]: 
[0m21:42:35.298945 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:42:35.301210 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5947676, "process_in_blocks": "0", "process_kernel_time": 0.585947, "process_mem_max_rss": "167559168", "process_out_blocks": "0", "process_user_time": 3.156102}
[0m21:42:35.301567 [debug] [MainThread]: Command `dbt run` failed at 21:42:35.301497 after 3.60 seconds
[0m21:42:35.301899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103dbeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab641c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b1e4dc0>]}
[0m21:42:35.302198 [debug] [MainThread]: Flushing usage events
[0m21:42:35.530455 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:44:15.000497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029ece20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10389bfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10389bc10>]}


============================== 21:44:15.003517 | 6d23cb63-1922-4d4f-b9a1-db0a820760f4 ==============================
[0m21:44:15.003517 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:44:15.003899 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_brands_recent', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:44:15.492088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6d23cb63-1922-4d4f-b9a1-db0a820760f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e14b50>]}
[0m21:44:15.524048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6d23cb63-1922-4d4f-b9a1-db0a820760f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d99b20>]}
[0m21:44:15.524816 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:44:15.649463 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:44:15.740044 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:44:15.740481 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:44:15.888957 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:44:15.898239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6d23cb63-1922-4d4f-b9a1-db0a820760f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115660130>]}
[0m21:44:15.949628 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:44:15.952305 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:44:15.966188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6d23cb63-1922-4d4f-b9a1-db0a820760f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11539e550>]}
[0m21:44:15.966510 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:44:15.966709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d23cb63-1922-4d4f-b9a1-db0a820760f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028c8550>]}
[0m21:44:15.967345 [info ] [MainThread]: 
[0m21:44:15.967552 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:44:15.967719 [info ] [MainThread]: 
[0m21:44:15.968013 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:44:15.968475 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:44:16.042361 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:44:16.042619 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:44:16.042785 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:44:16.905081 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.862 seconds
[0m21:44:16.917183 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m21:44:16.918157 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m21:44:16.933675 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:44:16.936663 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:44:16.937165 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:44:16.937558 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:44:16.938259 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:44:17.056198 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.118 seconds
[0m21:44:17.535095 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.597 seconds
[0m21:44:17.542226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d23cb63-1922-4d4f-b9a1-db0a820760f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d3c280>]}
[0m21:44:17.546556 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:44:17.547507 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:44:17.548271 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m21:44:17.548882 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:44:17.564941 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:44:17.566530 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:44:17.598481 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:44:17.603414 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:44:17.603953 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with
    -- Get base staging tables
    stg_receipts as (
        select * from RAW.PUBLIC_staging.staging_receipts
    ),
    
    stg_receipt_items as (
        select * from RAW.PUBLIC_staging.staging_receipt_items
    ),
    
    stg_brands as (
        select * from RAW.PUBLIC_staging.staging_brands
    ),
    
    -- Determine the maximum date in the dataset
    max_date as (
        select max(scanned_timestamp) as max_date
        from stg_receipts
    ),
    
    -- Define the most recent complete month (month before current)
    recent_month as (
        select 
            date_trunc('month', max_date) - interval '1 month' as month_start,
            date_trunc('month', max_date) as month_end
        from max_date
    ),
    
    -- Define the previous month (month before the recent month)
    previous_month as (
        select 
            month_start - interval '1 month' as month_start,
            month_start as month_end
        from recent_month
    ),
    
    -- Combine both month ranges
    month_ranges as (
        select 
            month_start,
            month_end,
            'Current' as month_type
        from recent_month
        
        union all
        
        select
            month_start,
            month_end,
            'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipts from the two relevant months
    filtered_receipts as (
        select 
            r.*,
            mr.month_type
        from stg_receipts r
        cross join month_ranges mr
        where r.scanned_timestamp >= mr.month_start
          and r.scanned_timestamp < mr.month_end
    ),
    
    -- Count receipts by brand for each month
    brand_counts as (
        select
            b.brand_name,
            fr.month_type,
            count(distinct fr.receipt_id) as receipt_count
        from filtered_receipts fr
        join stg_receipt_items ri on fr.receipt_id = ri.receipt_id
        join stg_brands b on ri.barcode = b.barcode
        where b.brand_id is not null
        group by 
            b.brand_name,
            fr.month_type
    ),
    
    -- Rank the brands within each month
    ranked_brands as (
        select
            brand_name,
            month_type,
            receipt_count,
            rank() over (partition by month_type order by receipt_count desc) as rank_in_month,
            case
                when month_type = 'Previous' then true
                else false
            end as is_previous_month
        from brand_counts
    ),
    
    -- Get current month top 5 brands
    current_month_brands as (
        select 
            brand_name,
            month_type,
            receipt_count,
            rank_in_month,
            is_previous_month
        from ranked_brands
        where month_type = 'Current' and rank_in_month <= 5
    ),
    
    -- Get previous month top 5 brands
    previous_month_brands as (
        select 
            brand_name,
            month_type,
            receipt_count,
            rank_in_month,
            is_previous_month
        from ranked_brands
        where month_type = 'Previous' and rank_in_month <= 5
    ),
    
    -- Fill gaps in current month if needed
    current_month_filler as (
        select 
            'No Data' as brand_name,
            'Current' as month_type,
            0 as receipt_count,
            (select count(*) from current_month_brands) + row_number() over (order by 1) as rank_in_month,
            false as is_previous_month
        from table(generator(rowcount => 5))
        limit greatest(0, 5 - (select count(*) from current_month_brands))
    ),
    
    -- Fill gaps in previous month if needed
    previous_month_filler as (
        select 
            'No Data' as brand_name,
            'Previous' as month_type,
            0 as receipt_count,
            (select count(*) from previous_month_brands) + row_number() over (order by 1) as rank_in_month,
            true as is_previous_month
        from table(generator(rowcount => 5))
        limit greatest(0, 5 - (select count(*) from previous_month_brands))
    ),
    
    -- Complete current month data (real + filler)
    full_current_month as (
        select * from current_month_brands
        union all
        select * from current_month_filler
    ),
    
    -- Complete previous month data (real + filler)
    full_previous_month as (
        select * from previous_month_brands
        union all
        select * from previous_month_filler
    )

-- Final output with guaranteed 5 rows per month
select
    brand_name,
    case
        when month_type = 'Current' then (select month_start from recent_month)
        else (select month_start from previous_month)
    end as month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from full_current_month

union all

select
    brand_name,
    case
        when month_type = 'Current' then (select month_start from recent_month)
        else (select month_start from previous_month)
    end as month_start,
    receipt_count,
    rank_in_month,
    is_previous_month
from full_previous_month

order by 
    case when is_previous_month then 1 else 0 end,
    rank_in_month
        );
[0m21:44:17.733544 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb1488-0000-c9ea-0000-00015dbe927d
[0m21:44:17.733890 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 135 at position 14 unexpected 'greatest'.
syntax error line 135 at position 14 unexpected 'greatest'.
syntax error line 135 at position 23 unexpected '0'.
syntax error line 135 at position 47 unexpected 'from'.
syntax error line 144 at position 88 unexpected ')'.
[0m21:44:17.739938 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 135 at position 14 unexpected 'greatest'.
  syntax error line 135 at position 14 unexpected 'greatest'.
  syntax error line 135 at position 23 unexpected '0'.
  syntax error line 135 at position 47 unexpected 'from'.
  syntax error line 144 at position 88 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:44:17.741288 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d23cb63-1922-4d4f-b9a1-db0a820760f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117f7bb20>]}
[0m21:44:17.741744 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.19s]
[0m21:44:17.742128 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:44:17.742458 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 135 at position 14 unexpected 'greatest'.
  syntax error line 135 at position 14 unexpected 'greatest'.
  syntax error line 135 at position 23 unexpected '0'.
  syntax error line 135 at position 47 unexpected 'from'.
  syntax error line 144 at position 88 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m21:44:17.743161 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:44:17.743370 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:44:17.743566 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:44:17.832116 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m21:44:17.832579 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m21:44:17.944768 [info ] [MainThread]: 
[0m21:44:17.945535 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.98 seconds (1.98s).
[0m21:44:17.946671 [debug] [MainThread]: Command end result
[0m21:44:17.982250 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:44:17.985325 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:44:17.991313 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:44:17.991617 [info ] [MainThread]: 
[0m21:44:17.991963 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:44:17.992251 [info ] [MainThread]: 
[0m21:44:17.992595 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 135 at position 14 unexpected 'greatest'.
  syntax error line 135 at position 14 unexpected 'greatest'.
  syntax error line 135 at position 23 unexpected '0'.
  syntax error line 135 at position 47 unexpected 'from'.
  syntax error line 144 at position 88 unexpected ')'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:44:17.992883 [info ] [MainThread]: 
[0m21:44:17.993163 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:44:17.995397 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.03597, "process_in_blocks": "0", "process_kernel_time": 0.783058, "process_mem_max_rss": "167559168", "process_out_blocks": "0", "process_user_time": 2.936595}
[0m21:44:17.995760 [debug] [MainThread]: Command `dbt run` failed at 21:44:17.995687 after 3.04 seconds
[0m21:44:17.996066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029ece20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11539e5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e82130>]}
[0m21:44:17.996358 [debug] [MainThread]: Flushing usage events
[0m21:44:18.219591 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:47:31.362133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049f8e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058a80a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058a8cd0>]}


============================== 21:47:31.365508 | f31df954-352b-4da7-b269-90a6902371f4 ==============================
[0m21:47:31.365508 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:47:31.366032 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:47:31.863612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f31df954-352b-4da7-b269-90a6902371f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10586a610>]}
[0m21:47:31.896322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f31df954-352b-4da7-b269-90a6902371f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10586a2e0>]}
[0m21:47:31.896982 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:47:32.020718 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:47:32.107313 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:47:32.107692 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:47:32.246347 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:47:32.255411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f31df954-352b-4da7-b269-90a6902371f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b1aeee0>]}
[0m21:47:32.307381 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:47:32.314155 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:47:32.333690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f31df954-352b-4da7-b269-90a6902371f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11afb2220>]}
[0m21:47:32.334033 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:47:32.334232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f31df954-352b-4da7-b269-90a6902371f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11aee7040>]}
[0m21:47:32.334900 [info ] [MainThread]: 
[0m21:47:32.335123 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:47:32.335293 [info ] [MainThread]: 
[0m21:47:32.335598 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:47:32.336120 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:47:32.411023 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:47:32.411307 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:47:32.411482 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:33.210946 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.799 seconds
[0m21:47:33.223745 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m21:47:33.231640 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m21:47:33.249322 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:47:33.251410 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:47:33.251742 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:47:33.252110 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:47:33.252420 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:33.359482 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.107 seconds
[0m21:47:33.718603 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.466 seconds
[0m21:47:33.725134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f31df954-352b-4da7-b269-90a6902371f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b16b9a0>]}
[0m21:47:33.730271 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:47:33.731214 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:47:33.732006 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m21:47:33.732594 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:47:33.749149 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:47:33.751827 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:47:33.783594 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:47:33.793192 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:47:33.793665 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with month_ranges as (
    -- Find the most recent and previous month with data
    select
        date_trunc('month', max(scanned_timestamp)) as current_month,
        dateadd('month', -1, date_trunc('month', max(scanned_timestamp))) as previous_month
    from RAW.PUBLIC_staging.staging_receipts
    where scanned_timestamp is not null
),

-- Count unique receipt scans by brand and month
brand_receipt_counts as (
    select
        b.brand_name,
        date_trunc('month', r.scanned_timestamp) as month_start,
        count(distinct r.receipt_id) as receipt_count
    from RAW.PUBLIC_staging.staging_receipt_items ri
    inner join RAW.PUBLIC_staging.staging_receipts r on ri.receipt_id = r.receipt_id
    inner join RAW.PUBLIC_staging.staging_brands b on ri.barcode = b.barcode
    cross join month_ranges m
    where 
        date_trunc('month', r.scanned_timestamp) in (m.current_month, m.previous_month)
        and b.brand_name is not null
    group by b.brand_name, date_trunc('month', r.scanned_timestamp)
),

-- Get current month rankings
current_month_ranks as (
    select
        brand_name,
        receipt_count,
        rank() over (order by receipt_count desc) as rank
    from brand_receipt_counts
    where month_start = (select current_month from month_ranges)
),

-- Get previous month rankings 
previous_month_ranks as (
    select
        brand_name,
        receipt_count,
        rank() over (order by receipt_count desc) as rank
    from brand_receipt_counts
    where month_start = (select previous_month from month_ranges)
),

-- Combine current month top 5 with their previous month rankings
combined_ranks as (
    select
        c.brand_name,
        c.receipt_count as current_receipt_count,
        c.rank as current_rank,
        p.receipt_count as previous_receipt_count,
        p.rank as previous_rank,
        case
            when p.rank is null then 'New to Top 5'
            when c.rank < p.rank then 'Moved Up'
            when c.rank > p.rank then 'Moved Down'
            else 'Unchanged'
        end as rank_change,
        case 
            when p.receipt_count is null or p.receipt_count = 0 then null
            else round((c.receipt_count - p.receipt_count) / p.receipt_count * 100, 2) 
        end as pct_change
    from current_month_ranks c
    left join previous_month_ranks p on c.brand_name = p.brand_name
    where c.rank <= 5  -- Get only top 5 from current month
)

-- Final output
select
    brand_name,
    current_receipt_count as receipt_count,
    current_rank as rank,
    previous_rank,
    rank_change,
    pct_change
from combined_ranks
order by current_rank
        );
[0m21:47:34.532763 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.738 seconds
[0m21:47:34.571990 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f31df954-352b-4da7-b269-90a6902371f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b7bc6a0>]}
[0m21:47:34.572750 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 0.84s]
[0m21:47:34.573338 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:47:34.574447 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:47:34.574790 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:47:34.575102 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:47:34.663963 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m21:47:34.664560 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m21:47:34.757797 [info ] [MainThread]: 
[0m21:47:34.758755 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.42 seconds (2.42s).
[0m21:47:34.760063 [debug] [MainThread]: Command end result
[0m21:47:34.795611 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:47:34.797192 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:47:34.804232 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:47:34.804535 [info ] [MainThread]: 
[0m21:47:34.804900 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:47:34.805171 [info ] [MainThread]: 
[0m21:47:34.805454 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:47:34.807741 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.4925427, "process_in_blocks": "0", "process_kernel_time": 0.585934, "process_mem_max_rss": "169771008", "process_out_blocks": "0", "process_user_time": 3.154406}
[0m21:47:34.808117 [debug] [MainThread]: Command `dbt run` succeeded at 21:47:34.808041 after 3.49 seconds
[0m21:47:34.808440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049f8e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ac049a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11afb23a0>]}
[0m21:47:34.808767 [debug] [MainThread]: Flushing usage events
[0m21:47:35.044111 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:51:34.402774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e68e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103d17fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103d17c40>]}


============================== 21:51:34.405841 | d9a105a7-fbea-45ee-aab1-ea6a3e73f8af ==============================
[0m21:51:34.405841 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:51:34.406217 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select fct_brands_recent', 'send_anonymous_usage_stats': 'True'}
[0m21:51:34.906698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd9a105a7-fbea-45ee-aab1-ea6a3e73f8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ce7250>]}
[0m21:51:34.937655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd9a105a7-fbea-45ee-aab1-ea6a3e73f8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103215b20>]}
[0m21:51:34.938221 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:51:35.059860 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:51:35.145465 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:51:35.145845 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:51:35.282828 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:51:35.291470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd9a105a7-fbea-45ee-aab1-ea6a3e73f8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109621ee0>]}
[0m21:51:35.341263 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:51:35.343608 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:51:35.356803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd9a105a7-fbea-45ee-aab1-ea6a3e73f8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10960ebe0>]}
[0m21:51:35.357127 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:51:35.357330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9a105a7-fbea-45ee-aab1-ea6a3e73f8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fc0280>]}
[0m21:51:35.357964 [info ] [MainThread]: 
[0m21:51:35.358178 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:51:35.358347 [info ] [MainThread]: 
[0m21:51:35.358630 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:51:35.359058 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:51:35.431310 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:51:35.431567 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:51:35.431732 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:51:36.194945 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.763 seconds
[0m21:51:36.207951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m21:51:36.215201 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m21:51:36.232120 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:51:36.234289 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:51:36.234627 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:51:36.234966 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:51:36.235277 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:51:36.354632 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.119 seconds
[0m21:51:36.670123 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.435 seconds
[0m21:51:36.676429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9a105a7-fbea-45ee-aab1-ea6a3e73f8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095db550>]}
[0m21:51:36.681106 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:51:36.682017 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:51:36.683030 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m21:51:36.683632 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:51:36.700446 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:51:36.701769 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:51:36.734426 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:51:36.737497 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:51:36.737914 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. What are the top 5 brands by receipts scanned for most recent month?
-- 2. How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with 
    -- Debugging CTE to check available months
    available_months as (
        select
            date_trunc('month', scanned_timestamp) as month,
            count(*) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts
        where scanned_timestamp is not null
        group by date_trunc('month', scanned_timestamp)
        order by month desc
        limit 5
    ),

    -- Debugging CTE to check join success
    join_check as (
        select
            count(distinct r.receipt_id) as total_receipts,
            count(distinct case when b.brand_id is not null then r.receipt_id end) as receipts_with_brands
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri on r.receipt_id = ri.receipt_id
        left join RAW.PUBLIC_staging.staging_brands b on ri.barcode = b.barcode
    ),

    -- Simplified approach using a date range instead of dynamic months
    brand_monthly_data as (
        select
            b.brand_name,
            date_trunc('month', r.scanned_timestamp) as month_start,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri on r.receipt_id = ri.receipt_id
        left join RAW.PUBLIC_staging.staging_brands b on ri.barcode = b.barcode
        where 
            r.scanned_timestamp is not null
            and b.brand_name is not null
        group by b.brand_name, date_trunc('month', r.scanned_timestamp)
    ),

    -- Get the two most recent months with data
    recent_months as (
        select distinct month_start
        from brand_monthly_data
        order by month_start desc
        limit 2
    ),

    -- Filter to just those months and rank brands
    ranked_brands as (
        select
            bmd.brand_name,
            bmd.month_start,
            bmd.receipt_count,
            rank() over (partition by bmd.month_start order by bmd.receipt_count desc) as rank_in_month,
            case
                when rm.month_start = (select max(month_start) from recent_months) then false
                else true
            end as is_previous_month
        from brand_monthly_data bmd
        join recent_months rm on bmd.month_start = rm.month_start
    )

-- First show debugging info
select 'Available Months' as debug_type, 
       month::string as debug_value, 
       receipt_count::string as count
from available_months

union all

select 'Join Check', 
       'Total Receipts: ' || total_receipts::string, 
       'Receipts with Brands: ' || receipts_with_brands::string
from join_check

-- Then show actual results if data exists
union all

select 'Results', 
       brand_name, 
       rank_in_month::string
from ranked_brands
where rank_in_month <= 5
order by is_previous_month, rank_in_month
        );
[0m21:51:36.936740 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb148f-0000-ca41-0001-5dbe000101da
[0m21:51:36.937130 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 91 at position 9
invalid identifier 'IS_PREVIOUS_MONTH'
[0m21:51:36.944027 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 91 at position 9
  invalid identifier 'IS_PREVIOUS_MONTH'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:51:36.945534 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9a105a7-fbea-45ee-aab1-ea6a3e73f8af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c03be0>]}
[0m21:51:36.946033 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.26s]
[0m21:51:36.946462 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:51:36.946845 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 91 at position 9
  invalid identifier 'IS_PREVIOUS_MONTH'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m21:51:36.947621 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:51:36.947844 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:51:36.948055 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:51:37.030707 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m21:51:37.031145 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m21:51:37.107250 [info ] [MainThread]: 
[0m21:51:37.107809 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.75 seconds (1.75s).
[0m21:51:37.108600 [debug] [MainThread]: Command end result
[0m21:51:37.137443 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:51:37.138780 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:51:37.144956 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:51:37.145277 [info ] [MainThread]: 
[0m21:51:37.145603 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:51:37.145861 [info ] [MainThread]: 
[0m21:51:37.146136 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 91 at position 9
  invalid identifier 'IS_PREVIOUS_MONTH'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m21:51:37.146360 [info ] [MainThread]: 
[0m21:51:37.146651 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:51:37.148594 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.7863932, "process_in_blocks": "0", "process_kernel_time": 0.833396, "process_mem_max_rss": "168607744", "process_out_blocks": "0", "process_user_time": 2.858228}
[0m21:51:37.148920 [debug] [MainThread]: Command `dbt run` failed at 21:51:37.148858 after 2.79 seconds
[0m21:51:37.149202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e68e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095d9c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095d98e0>]}
[0m21:51:37.149486 [debug] [MainThread]: Flushing usage events
[0m21:51:37.374093 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:52:52.044997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bd7eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a870d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a87c70>]}


============================== 21:52:52.048859 | 3d814a2a-1d22-4f8b-937a-6ccb1c4e48c1 ==============================
[0m21:52:52.048859 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:52:52.049275 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:52:52.610253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d814a2a-1d22-4f8b-937a-6ccb1c4e48c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ad311c0>]}
[0m21:52:52.641645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d814a2a-1d22-4f8b-937a-6ccb1c4e48c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ad603d0>]}
[0m21:52:52.642182 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:52:52.764247 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:52:52.849981 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:52:52.850389 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:52:52.990621 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:52:52.999176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d814a2a-1d22-4f8b-937a-6ccb1c4e48c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b354130>]}
[0m21:52:53.048841 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:52:53.051521 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:52:53.065181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d814a2a-1d22-4f8b-937a-6ccb1c4e48c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b198e20>]}
[0m21:52:53.065601 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:52:53.065829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d814a2a-1d22-4f8b-937a-6ccb1c4e48c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b2dad30>]}
[0m21:52:53.066566 [info ] [MainThread]: 
[0m21:52:53.066803 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:52:53.067029 [info ] [MainThread]: 
[0m21:52:53.067340 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:52:53.067830 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:52:53.147324 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:52:53.147588 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:52:53.147756 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:52:54.027909 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.880 seconds
[0m21:52:54.040758 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m21:52:54.048612 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m21:52:54.065967 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:52:54.068063 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:52:54.068414 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:52:54.068770 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:52:54.069083 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:52:54.197722 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.128 seconds
[0m21:52:54.650008 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.581 seconds
[0m21:52:54.653277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d814a2a-1d22-4f8b-937a-6ccb1c4e48c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11acf99a0>]}
[0m21:52:54.656114 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:52:54.656718 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:52:54.657221 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m21:52:54.657590 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:52:54.668986 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:52:54.670579 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:52:54.695785 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:52:54.698073 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:52:54.698371 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top 5 brands by receipts scanned for most recent month?



with 
    -- Find the most recent month with data
    recent_month as (
        select date_trunc('month', max(scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
        where scanned_timestamp is not null
    ),
    
    -- Count receipts by brand for most recent month
    brand_counts as (
        select
            b.brand_name,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join RAW.PUBLIC_staging.staging_brands b 
            on ri.barcode = b.barcode
        where 
            date_trunc('month', r.scanned_timestamp) = (select month_start from recent_month)
            and b.brand_name is not null
        group by b.brand_name
    )

-- Get top 5 brands by receipt count
select
    brand_name,
    receipt_count,
    rank() over (order by receipt_count desc) as rank
from brand_counts
order by receipt_count desc
limit 5
        );
[0m21:52:56.065587 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.366 seconds
[0m21:52:56.105407 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d814a2a-1d22-4f8b-937a-6ccb1c4e48c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f9a7580>]}
[0m21:52:56.106166 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.45s]
[0m21:52:56.106755 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:52:56.107908 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:52:56.108262 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:52:56.108587 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:52:56.201962 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m21:52:56.202589 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m21:52:56.284087 [info ] [MainThread]: 
[0m21:52:56.285037 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.22 seconds (3.22s).
[0m21:52:56.286366 [debug] [MainThread]: Command end result
[0m21:52:56.322114 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:52:56.324183 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:52:56.331342 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:52:56.331640 [info ] [MainThread]: 
[0m21:52:56.332011 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:52:56.332283 [info ] [MainThread]: 
[0m21:52:56.332565 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:52:56.334826 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.334967, "process_in_blocks": "0", "process_kernel_time": 0.505163, "process_mem_max_rss": "169426944", "process_out_blocks": "0", "process_user_time": 3.178851}
[0m21:52:56.335189 [debug] [MainThread]: Command `dbt run` succeeded at 21:52:56.335116 after 4.34 seconds
[0m21:52:56.335504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bd7eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ad603d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b198fa0>]}
[0m21:52:56.335835 [debug] [MainThread]: Flushing usage events
[0m21:52:56.497560 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:55:13.960509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f5be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a21ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a21fc40>]}


============================== 21:55:13.963675 | 13c6ed97-cf2c-448e-953c-2c3e716ac9db ==============================
[0m21:55:13.963675 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:55:13.964051 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select fct_brands_recent', 'send_anonymous_usage_stats': 'True'}
[0m21:55:14.450633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '13c6ed97-cf2c-448e-953c-2c3e716ac9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1ef250>]}
[0m21:55:14.482155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '13c6ed97-cf2c-448e-953c-2c3e716ac9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10951db20>]}
[0m21:55:14.482688 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:55:14.605281 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:55:14.691519 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:55:14.691896 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:55:14.829503 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m21:55:14.838335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '13c6ed97-cf2c-448e-953c-2c3e716ac9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f0ddee0>]}
[0m21:55:14.888466 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:55:14.891172 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:55:14.904045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '13c6ed97-cf2c-448e-953c-2c3e716ac9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f0cabe0>]}
[0m21:55:14.904359 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:55:14.904560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '13c6ed97-cf2c-448e-953c-2c3e716ac9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f864280>]}
[0m21:55:14.905207 [info ] [MainThread]: 
[0m21:55:14.905409 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:55:14.905574 [info ] [MainThread]: 
[0m21:55:14.905889 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:55:14.906397 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:55:14.981338 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:55:14.981617 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:55:14.981791 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:16.149247 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.167 seconds
[0m21:55:16.161731 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m21:55:16.162759 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m21:55:16.184506 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:55:16.188722 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:55:16.189084 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:55:16.189419 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:55:16.190006 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:16.330070 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.140 seconds
[0m21:55:16.656704 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.466 seconds
[0m21:55:16.663856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '13c6ed97-cf2c-448e-953c-2c3e716ac9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f0942e0>]}
[0m21:55:16.667833 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:55:16.668770 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:55:16.669574 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m21:55:16.670172 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:55:16.687556 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:55:16.689653 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:55:16.720549 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:55:16.724220 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:55:16.724624 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top 5 brands by receipts scanned for most recent month?



with 
    -- Get distinct months with receipt data
    available_months as (
        select distinct
            date_trunc('month', scanned_timestamp) as month_start
        from RAW.PUBLIC_staging.staging_receipts
        where scanned_timestamp is not null
        order by month_start desc
    ),
    
    -- Get most recent month and previous month
    selected_months as (
        select
            month_start,
            row_number() over (order by month_start desc) as month_rank
        from available_months
        limit 2
    ),

    -- Get recent month data
    recent_month_data as (
        select 
            b.brand_name as best_estimated_brand,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri on r.receipt_id = ri.receipt_id
        join RAW.PUBLIC_staging.staging_brands b on ri.barcode = b.barcode
        join selected_months sm on date_trunc('month', r.scanned_timestamp) = sm.month_start
        where sm.month_rank = 1 and b.brand_name is not null
        group by b.brand_name
    ),

    -- Get previous month data
    previous_month_data as (
        select 
            b.brand_name as best_estimated_brand,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri on r.receipt_id = ri.receipt_id
        join RAW.PUBLIC_staging.staging_brands b on ri.barcode = b.barcode
        join selected_months sm on date_trunc('month', r.scanned_timestamp) = sm.month_start
        where sm.month_rank = 2 and b.brand_name is not null
        group by b.brand_name
    ),

    -- Rank recent month brands
    recent as (
        select 
            best_estimated_brand,
            receipt_count,
            row_number() over (order by receipt_count desc) as recent_rank
        from recent_month_data
    ),

    -- Rank previous month brands
    previous as (
        select 
            best_estimated_brand,
            receipt_count,
            row_number() over (order by receipt_count desc) as previous_rank
        from previous_month_data
    ),

    -- Join for comparison
    comparison as (
        select 
            r.best_estimated_brand,
            r.receipt_count as recent_receipt_count,
            r.recent_rank,
            p.receipt_count as previous_receipt_count,
            p.previous_rank
        from recent r
        left join previous p on r.best_estimated_brand = p.best_estimated_brand
    )

-- Get top 5 brands by recent month receipts
select *
from comparison
where recent_rank <= 5
order by recent_rank
        );
[0m21:55:17.887465 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.162 seconds
[0m21:55:17.926542 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '13c6ed97-cf2c-448e-953c-2c3e716ac9db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f7f17c0>]}
[0m21:55:17.927311 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.26s]
[0m21:55:17.927902 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:55:17.929074 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:55:17.929432 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:55:17.929749 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:55:18.020517 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m21:55:18.021060 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m21:55:18.115833 [info ] [MainThread]: 
[0m21:55:18.117053 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.21 seconds (3.21s).
[0m21:55:18.118555 [debug] [MainThread]: Command end result
[0m21:55:18.154317 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:55:18.156344 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:55:18.163514 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:55:18.163872 [info ] [MainThread]: 
[0m21:55:18.164241 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:55:18.164517 [info ] [MainThread]: 
[0m21:55:18.164799 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:55:18.167078 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.252353, "process_in_blocks": "0", "process_kernel_time": 0.629343, "process_mem_max_rss": "170852352", "process_out_blocks": "0", "process_user_time": 3.203441}
[0m21:55:18.167459 [debug] [MainThread]: Command `dbt run` succeeded at 21:55:18.167384 after 4.25 seconds
[0m21:55:18.167791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f5be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10951db20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f094190>]}
[0m21:55:18.168127 [debug] [MainThread]: Flushing usage events
[0m21:55:18.335996 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:58:13.959199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10328beb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10413bfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10413bc40>]}


============================== 21:58:13.962350 | 87974f74-095d-46d6-a9fe-6b2b1a46ceb3 ==============================
[0m21:58:13.962350 [info ] [MainThread]: Running with dbt=1.9.3
[0m21:58:13.962725 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select fct_brands_recent', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:58:14.436207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '87974f74-095d-46d6-a9fe-6b2b1a46ceb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102362220>]}
[0m21:58:14.467624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '87974f74-095d-46d6-a9fe-6b2b1a46ceb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ba6070>]}
[0m21:58:14.468175 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m21:58:14.590047 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m21:58:14.675681 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:58:14.676069 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m21:58:14.813761 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m21:58:14.822793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '87974f74-095d-46d6-a9fe-6b2b1a46ceb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123320130>]}
[0m21:58:14.872942 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:58:14.875666 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:58:14.890737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '87974f74-095d-46d6-a9fe-6b2b1a46ceb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12333fe50>]}
[0m21:58:14.891052 [info ] [MainThread]: Found 5 models, 3 sources, 472 macros
[0m21:58:14.891252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87974f74-095d-46d6-a9fe-6b2b1a46ceb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12334ea60>]}
[0m21:58:14.891914 [info ] [MainThread]: 
[0m21:58:14.892123 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:58:14.892288 [info ] [MainThread]: 
[0m21:58:14.892575 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:58:14.893036 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m21:58:14.970758 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m21:58:14.971022 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m21:58:14.971188 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:58:15.964374 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.993 seconds
[0m21:58:15.975775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m21:58:15.982866 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m21:58:15.992599 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m21:58:15.995603 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m21:58:15.996056 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m21:58:15.996439 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m21:58:15.996959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:58:16.108774 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.112 seconds
[0m21:58:16.483721 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.486 seconds
[0m21:58:16.489851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87974f74-095d-46d6-a9fe-6b2b1a46ceb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1023f0e50>]}
[0m21:58:16.494843 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m21:58:16.495747 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m21:58:16.496516 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m21:58:16.497045 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m21:58:16.512674 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m21:58:16.514045 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m21:58:16.545469 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m21:58:16.547686 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m21:58:16.548032 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top 5 brands by receipts scanned for most recent month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get most recent month's receipts
    recent_month_receipts as (
        select 
            r.receipt_id,
            ri.barcode
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join most_recent_month m
            on date_trunc('month', r.scanned_timestamp) = m.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Count receipts by brand
    receipt_count_by_brand as (
        select 
            b.brand_name,
            b.brand_id,
            count(distinct r.receipt_id) as receipt_count
        from recent_month_receipts r
        join RAW.PUBLIC_staging.staging_brands b 
            on r.barcode = b.barcode
        where b.brand_name is not null
        group by b.brand_name, b.brand_id
    ),
    
    -- Rank brands by receipt count
    ranked_brands as (
        select 
            brand_name, 
            brand_id,
            receipt_count,
            row_number() over (order by receipt_count desc) as rank
        from receipt_count_by_brand
    )

-- Return top 5 brands
select 
    brand_name,
    brand_id,
    receipt_count,
    rank
from ranked_brands
where rank <= 5
order by rank
        );
[0m21:58:17.491711 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.943 seconds
[0m21:58:17.530733 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87974f74-095d-46d6-a9fe-6b2b1a46ceb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123b60fd0>]}
[0m21:58:17.531554 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.03s]
[0m21:58:17.532164 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m21:58:17.533321 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:58:17.533629 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m21:58:17.533935 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m21:58:17.619300 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m21:58:17.619851 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m21:58:17.718910 [info ] [MainThread]: 
[0m21:58:17.719861 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.83 seconds (2.83s).
[0m21:58:17.721159 [debug] [MainThread]: Command end result
[0m21:58:17.757467 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m21:58:17.759030 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m21:58:17.766038 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m21:58:17.766335 [info ] [MainThread]: 
[0m21:58:17.766702 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:58:17.766973 [info ] [MainThread]: 
[0m21:58:17.767251 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:58:17.769562 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8538349, "process_in_blocks": "0", "process_kernel_time": 0.545686, "process_mem_max_rss": "166445056", "process_out_blocks": "0", "process_user_time": 3.164486}
[0m21:58:17.769968 [debug] [MainThread]: Command `dbt run` succeeded at 21:58:17.769887 after 3.85 seconds
[0m21:58:17.770305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10328beb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12333fe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033eb790>]}
[0m21:58:17.770647 [debug] [MainThread]: Flushing usage events
[0m21:58:17.921394 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:07:14.556366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d73e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c240a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c24cd0>]}


============================== 22:07:14.559416 | bc35fa8b-7a1c-4678-9dbc-e9e8cb324ce2 ==============================
[0m22:07:14.559416 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:07:14.559790 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:07:15.071839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bc35fa8b-7a1c-4678-9dbc-e9e8cb324ce2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103be4610>]}
[0m22:07:15.103166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bc35fa8b-7a1c-4678-9dbc-e9e8cb324ce2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103be42e0>]}
[0m22:07:15.103702 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:07:15.226693 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:07:15.311997 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m22:07:15.312348 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://models/staging/exploratory_analysis.sql
[0m22:07:15.312581 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:07:15.452795 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m22:07:15.461505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc35fa8b-7a1c-4678-9dbc-e9e8cb324ce2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135fa0130>]}
[0m22:07:15.511650 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:07:15.513924 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:07:15.527690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc35fa8b-7a1c-4678-9dbc-e9e8cb324ce2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135f962e0>]}
[0m22:07:15.528005 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:07:15.528206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc35fa8b-7a1c-4678-9dbc-e9e8cb324ce2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135f8c730>]}
[0m22:07:15.528860 [info ] [MainThread]: 
[0m22:07:15.529070 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:07:15.529235 [info ] [MainThread]: 
[0m22:07:15.529522 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:07:15.529983 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:07:15.634452 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:07:15.634715 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:07:15.634883 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:07:16.633663 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.999 seconds
[0m22:07:16.645745 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m22:07:16.653318 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m22:07:16.662431 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:07:16.665470 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:07:16.665915 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:07:16.666287 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:07:16.666965 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:07:16.790688 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.124 seconds
[0m22:07:17.287260 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.620 seconds
[0m22:07:17.293609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc35fa8b-7a1c-4678-9dbc-e9e8cb324ce2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1325ed9a0>]}
[0m22:07:17.298914 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:07:17.299873 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:07:17.300666 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m22:07:17.301269 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:07:17.316091 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:07:17.317415 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:07:17.459058 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:07:17.464394 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:07:17.464834 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top 5 brands by receipts scanned for most recent month?



with 
    -- First check if we have any data at all
    data_check as (
        select count(*) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts
        where scanned_timestamp is not null
    ),

    -- Find the most recent month with data
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
        where scanned_timestamp is not null
    ),
    
    -- Get most recent month's receipts
    recent_month_receipts as (
        select 
            r.receipt_id,
            ri.barcode
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        cross join most_recent_month m
        where 
            date_trunc('month', r.scanned_timestamp) = m.month_start
            and r.scanned_timestamp is not null
    ),
    
    -- Count receipts by brand
    receipt_count_by_brand as (
        select 
            coalesce(b.brand_name, 'Unknown Brand') as brand_name,
            coalesce(b.brand_id, 'Unknown') as brand_id,
            count(distinct r.receipt_id) as receipt_count
        from recent_month_receipts r
        left join RAW.PUBLIC_staging.staging_brands b 
            on r.barcode = b.barcode
        group by coalesce(b.brand_name, 'Unknown Brand'), coalesce(b.brand_id, 'Unknown')
        having count(distinct r.receipt_id) > 0
    ),
    
    -- Rank brands by receipt count
    ranked_brands as (
        select 
            brand_name, 
            brand_id,
            receipt_count,
            row_number() over (order by receipt_count desc) as rank
        from receipt_count_by_brand
    )

-- Return top 5 brands
select 
    brand_name,
    brand_id,
    receipt_count,
    rank
from ranked_brands
where rank <= 5
order by rank
        );
[0m22:07:18.582282 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.116 seconds
[0m22:07:18.632987 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc35fa8b-7a1c-4678-9dbc-e9e8cb324ce2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1367b5520>]}
[0m22:07:18.634077 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.33s]
[0m22:07:18.634716 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:07:18.636552 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:07:18.636834 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:07:18.637128 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:07:18.719434 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m22:07:18.719786 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m22:07:18.837817 [info ] [MainThread]: 
[0m22:07:18.838505 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.31 seconds (3.31s).
[0m22:07:18.839894 [debug] [MainThread]: Command end result
[0m22:07:18.871340 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:07:18.873782 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:07:18.880292 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:07:18.880578 [info ] [MainThread]: 
[0m22:07:18.880938 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:07:18.881176 [info ] [MainThread]: 
[0m22:07:18.881446 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:07:18.883735 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.370106, "process_in_blocks": "0", "process_kernel_time": 0.746688, "process_mem_max_rss": "166952960", "process_out_blocks": "0", "process_user_time": 2.959809}
[0m22:07:18.884111 [debug] [MainThread]: Command `dbt run` succeeded at 22:07:18.884048 after 4.37 seconds
[0m22:07:18.884454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d73e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103be42e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135f52790>]}
[0m22:07:18.884731 [debug] [MainThread]: Flushing usage events
[0m22:07:18.978558 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:11:38.312202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038abeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10495ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10495fc40>]}


============================== 22:11:38.315293 | 389d89ef-ce56-4f35-8dd8-5bd456dff91b ==============================
[0m22:11:38.315293 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:11:38.315655 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:11:38.833418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '389d89ef-ce56-4f35-8dd8-5bd456dff91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10264a220>]}
[0m22:11:38.866739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '389d89ef-ce56-4f35-8dd8-5bd456dff91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042ca070>]}
[0m22:11:38.867402 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:11:38.991437 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:11:39.077416 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:11:39.077795 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:11:39.214785 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m22:11:39.223865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '389d89ef-ce56-4f35-8dd8-5bd456dff91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12dc69ee0>]}
[0m22:11:39.275021 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:11:39.278938 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:11:39.292413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '389d89ef-ce56-4f35-8dd8-5bd456dff91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12dc4adf0>]}
[0m22:11:39.292740 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:11:39.292933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '389d89ef-ce56-4f35-8dd8-5bd456dff91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d8a2df0>]}
[0m22:11:39.293580 [info ] [MainThread]: 
[0m22:11:39.293785 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:11:39.293953 [info ] [MainThread]: 
[0m22:11:39.294240 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:11:39.294677 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:11:39.372889 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:11:39.373145 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:11:39.373311 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:11:40.415281 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.042 seconds
[0m22:11:40.428764 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m22:11:40.436563 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m22:11:40.454664 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:11:40.455385 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:11:40.455727 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:11:40.456053 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:11:40.456383 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:11:40.578146 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.121 seconds
[0m22:11:40.963312 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.507 seconds
[0m22:11:40.967081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '389d89ef-ce56-4f35-8dd8-5bd456dff91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d3adc70>]}
[0m22:11:40.971137 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:11:40.971775 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:11:40.972327 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m22:11:40.972749 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:11:40.985880 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:11:40.987485 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:11:41.015650 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:11:41.017218 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:11:41.017530 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the brands by receipts scanned for most recent month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get most recent month's receipts
    recent_month_receipts as (
        select 
            r.receipt_id,
            ri.barcode
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join most_recent_month m
            on date_trunc('month', r.scanned_timestamp) = m.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Count receipts by brand
    receipt_count_by_brand as (
        select 
            b.brand_name,
            b.brand_id,
            count(distinct r.receipt_id) as receipt_count
        from recent_month_receipts r
        join RAW.PUBLIC_staging.staging_brands b 
            on r.barcode = b.barcode
        where b.brand_name is not null
        group by b.brand_name, b.brand_id
    )
    
-- Return all brands by count (no top 5 limit)
select
    brand_name,
    brand_id,
    receipt_count
from receipt_count_by_brand
order by receipt_count desc
        );
[0m22:11:42.762959 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.745 seconds
[0m22:11:42.804018 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '389d89ef-ce56-4f35-8dd8-5bd456dff91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12eb73100>]}
[0m22:11:42.804933 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.83s]
[0m22:11:42.805878 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:11:42.807139 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:11:42.807460 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:11:42.807766 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:11:42.905220 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m22:11:42.905853 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m22:11:43.000159 [info ] [MainThread]: 
[0m22:11:43.001299 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.71 seconds (3.71s).
[0m22:11:43.002873 [debug] [MainThread]: Command end result
[0m22:11:43.039830 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:11:43.041760 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:11:43.048532 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:11:43.048835 [info ] [MainThread]: 
[0m22:11:43.049212 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:11:43.049537 [info ] [MainThread]: 
[0m22:11:43.049890 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:11:43.052257 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.781871, "process_in_blocks": "0", "process_kernel_time": 0.729211, "process_mem_max_rss": "166854656", "process_out_blocks": "0", "process_user_time": 2.877398}
[0m22:11:43.052659 [debug] [MainThread]: Command `dbt run` succeeded at 22:11:43.052581 after 4.78 seconds
[0m22:11:43.052992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038abeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031d42e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029c3df0>]}
[0m22:11:43.053329 [debug] [MainThread]: Flushing usage events
[0m22:11:43.281340 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:13:03.704679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e8feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103d3ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103d3fc40>]}


============================== 22:13:03.707928 | 9c950d10-a84d-4cbe-8445-18f3957c1afb ==============================
[0m22:13:03.707928 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:13:03.708307 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:13:04.203959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c950d10-a84d-4cbe-8445-18f3957c1afb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101f66220>]}
[0m22:13:04.235483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c950d10-a84d-4cbe-8445-18f3957c1afb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037aa070>]}
[0m22:13:04.236027 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:13:04.359067 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:13:04.445578 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:13:04.445972 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:13:04.587713 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m22:13:04.597551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c950d10-a84d-4cbe-8445-18f3957c1afb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d6e9f10>]}
[0m22:13:04.651474 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:13:04.667873 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:13:04.687982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c950d10-a84d-4cbe-8445-18f3957c1afb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d6cb610>]}
[0m22:13:04.688376 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:13:04.688633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c950d10-a84d-4cbe-8445-18f3957c1afb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d6cf670>]}
[0m22:13:04.689314 [info ] [MainThread]: 
[0m22:13:04.689541 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:13:04.689715 [info ] [MainThread]: 
[0m22:13:04.690024 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:13:04.690479 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:13:04.765048 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:13:04.765327 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:13:04.765498 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:05.821994 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.056 seconds
[0m22:13:05.832426 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m22:13:05.833120 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m22:13:05.842307 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:13:05.844294 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:13:05.844613 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:13:05.844843 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:13:05.845269 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:05.935899 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.091 seconds
[0m22:13:06.137997 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.293 seconds
[0m22:13:06.141153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c950d10-a84d-4cbe-8445-18f3957c1afb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d694100>]}
[0m22:13:06.144579 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:13:06.145157 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:13:06.145641 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m22:13:06.146023 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:13:06.156192 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:13:06.157554 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:13:06.183474 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:13:06.184800 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:13:06.185082 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What is the most recent month with receipt data?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    )
    
-- Just return the most recent month
select
    month_start
from most_recent_month
        );
[0m22:13:07.549461 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.364 seconds
[0m22:13:07.588136 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c950d10-a84d-4cbe-8445-18f3957c1afb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ddf73d0>]}
[0m22:13:07.588987 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.44s]
[0m22:13:07.589598 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:13:07.590667 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:13:07.591008 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:13:07.591317 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:13:07.695849 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m22:13:07.696438 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m22:13:07.782650 [info ] [MainThread]: 
[0m22:13:07.783411 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.09 seconds (3.09s).
[0m22:13:07.784427 [debug] [MainThread]: Command end result
[0m22:13:07.824122 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:13:07.825716 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:13:07.833396 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:13:07.833762 [info ] [MainThread]: 
[0m22:13:07.834103 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:13:07.834351 [info ] [MainThread]: 
[0m22:13:07.834614 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:13:07.836725 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.17686, "process_in_blocks": "0", "process_kernel_time": 0.517732, "process_mem_max_rss": "166674432", "process_out_blocks": "0", "process_user_time": 3.165974}
[0m22:13:07.837055 [debug] [MainThread]: Command `dbt run` succeeded at 22:13:07.836993 after 4.18 seconds
[0m22:13:07.837357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e8feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037aa070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d6cb610>]}
[0m22:13:07.837735 [debug] [MainThread]: Flushing usage events
[0m22:13:08.053551 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:15:00.279674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105487e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106337fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106337c40>]}


============================== 22:15:00.282948 | 8c61115f-f4fa-47ee-9507-c5e3bcb1fc23 ==============================
[0m22:15:00.282948 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:15:00.283347 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:15:00.776840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c61115f-f4fa-47ee-9507-c5e3bcb1fc23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106307250>]}
[0m22:15:00.808380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c61115f-f4fa-47ee-9507-c5e3bcb1fc23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105835b20>]}
[0m22:15:00.808959 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:15:00.931625 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:15:01.017632 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:15:01.018015 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:15:01.155741 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m22:15:01.164333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c61115f-f4fa-47ee-9507-c5e3bcb1fc23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bc4ce80>]}
[0m22:15:01.214102 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:15:01.216990 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:15:01.230202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c61115f-f4fa-47ee-9507-c5e3bcb1fc23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bc2c820>]}
[0m22:15:01.230521 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:15:01.230723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c61115f-f4fa-47ee-9507-c5e3bcb1fc23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bc34520>]}
[0m22:15:01.231377 [info ] [MainThread]: 
[0m22:15:01.231585 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:15:01.231751 [info ] [MainThread]: 
[0m22:15:01.232044 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:15:01.232496 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:15:01.304607 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:15:01.304874 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:15:01.305047 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:15:02.761512 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.456 seconds
[0m22:15:02.772302 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m22:15:02.779826 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m22:15:02.797041 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:15:02.797728 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:15:02.798045 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:15:02.798367 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:15:02.798656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:15:02.922884 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.124 seconds
[0m22:15:03.398085 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.599 seconds
[0m22:15:03.402803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c61115f-f4fa-47ee-9507-c5e3bcb1fc23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11baa7610>]}
[0m22:15:03.407723 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:15:03.408699 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:15:03.409495 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m22:15:03.410099 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:15:03.425256 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:15:03.426967 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:15:03.460144 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:15:03.461565 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:15:03.461959 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What is the most recent month with receipt data?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    )
    
 -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    )
    
-- Return both months
select
    month_start as most_recent_month,
    prev_month_start as previous_month
from most_recent_month
cross join previous_month
        );
[0m22:15:03.727339 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb14a7-0000-caaf-0001-5dbe0001906e
[0m22:15:03.727736 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 17 at position 4 unexpected 'previous_month'.
syntax error line 19 at position 46 unexpected 'as'.
[0m22:15:03.734566 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 17 at position 4 unexpected 'previous_month'.
  syntax error line 19 at position 46 unexpected 'as'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m22:15:03.736047 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c61115f-f4fa-47ee-9507-c5e3bcb1fc23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c25ac10>]}
[0m22:15:03.736540 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.33s]
[0m22:15:03.736967 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:15:03.737330 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 17 at position 4 unexpected 'previous_month'.
  syntax error line 19 at position 46 unexpected 'as'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m22:15:03.738131 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:15:03.738385 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:15:03.738610 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:15:03.814712 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m22:15:03.815147 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m22:15:03.909258 [info ] [MainThread]: 
[0m22:15:03.909915 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.68 seconds (2.68s).
[0m22:15:03.910882 [debug] [MainThread]: Command end result
[0m22:15:03.941563 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:15:03.942958 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:15:03.948941 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:15:03.949223 [info ] [MainThread]: 
[0m22:15:03.949536 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:15:03.949794 [info ] [MainThread]: 
[0m22:15:03.950094 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  001003 (42000): SQL compilation error:
  syntax error line 17 at position 4 unexpected 'previous_month'.
  syntax error line 19 at position 46 unexpected 'as'.
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m22:15:03.950339 [info ] [MainThread]: 
[0m22:15:03.950592 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:15:03.952639 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.7152653, "process_in_blocks": "0", "process_kernel_time": 0.676539, "process_mem_max_rss": "168132608", "process_out_blocks": "0", "process_user_time": 3.047177}
[0m22:15:03.952958 [debug] [MainThread]: Command `dbt run` failed at 22:15:03.952893 after 3.72 seconds
[0m22:15:03.953252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105487e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bc14520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105636700>]}
[0m22:15:03.953554 [debug] [MainThread]: Flushing usage events
[0m22:15:04.305387 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:16:02.168718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f8feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e3ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e3fc40>]}


============================== 22:16:02.171560 | 45bba669-badc-42ac-b289-7117f9b79128 ==============================
[0m22:16:02.171560 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:16:02.171948 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:16:02.648423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45bba669-badc-42ac-b289-7117f9b79128', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104066220>]}
[0m22:16:02.680279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45bba669-badc-42ac-b289-7117f9b79128', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058aa070>]}
[0m22:16:02.680842 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:16:02.817247 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:16:02.926228 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:16:02.926845 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:16:03.068127 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m22:16:03.076612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45bba669-badc-42ac-b289-7117f9b79128', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f6e8f10>]}
[0m22:16:03.127120 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:16:03.129827 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:16:03.142564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45bba669-badc-42ac-b289-7117f9b79128', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f3e7fa0>]}
[0m22:16:03.142889 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:16:03.143091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45bba669-badc-42ac-b289-7117f9b79128', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104066b50>]}
[0m22:16:03.143747 [info ] [MainThread]: 
[0m22:16:03.143968 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:16:03.144137 [info ] [MainThread]: 
[0m22:16:03.144429 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:16:03.144884 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:16:03.217702 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:16:03.217960 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:16:03.218128 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:16:04.075630 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.857 seconds
[0m22:16:04.088471 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m22:16:04.095555 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m22:16:04.111021 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:16:04.115364 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:16:04.115710 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:16:04.116049 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:16:04.116634 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:16:04.231576 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.115 seconds
[0m22:16:04.614351 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.497 seconds
[0m22:16:04.620720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45bba669-badc-42ac-b289-7117f9b79128', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040f4e50>]}
[0m22:16:04.625650 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:16:04.626611 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:16:04.627381 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m22:16:04.627973 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:16:04.643810 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:16:04.644796 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:16:04.677755 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:16:04.679040 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:16:04.679357 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What is the most recent month with receipt data?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),  -- Added comma here
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    )  -- No comma after last CTE
    
-- Return both months
select
    month_start as most_recent_month,
    prev_month_start as previous_month
from most_recent_month
cross join previous_month
        );
[0m22:16:06.025436 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.346 seconds
[0m22:16:06.044614 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45bba669-badc-42ac-b289-7117f9b79128', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fdf3880>]}
[0m22:16:06.045116 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.42s]
[0m22:16:06.045487 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:16:06.046240 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:16:06.046443 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:16:06.046630 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:16:06.204095 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m22:16:06.204575 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m22:16:06.275824 [info ] [MainThread]: 
[0m22:16:06.276217 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.13 seconds (3.13s).
[0m22:16:06.276886 [debug] [MainThread]: Command end result
[0m22:16:06.294241 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:16:06.296209 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:16:06.300667 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:16:06.300955 [info ] [MainThread]: 
[0m22:16:06.301560 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:16:06.301746 [info ] [MainThread]: 
[0m22:16:06.302635 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:16:06.305178 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.1777334, "process_in_blocks": "0", "process_kernel_time": 0.696731, "process_mem_max_rss": "167002112", "process_out_blocks": "0", "process_user_time": 2.992739}
[0m22:16:06.305497 [debug] [MainThread]: Command `dbt run` succeeded at 22:16:06.305446 after 4.18 seconds
[0m22:16:06.305999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f8feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058aa070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f3e7e20>]}
[0m22:16:06.306830 [debug] [MainThread]: Flushing usage events
[0m22:16:06.381359 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:20:07.145314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d6ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f1ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f1fc40>]}


============================== 22:20:07.148311 | 9f18e141-abf2-4129-b9ab-e6c412655755 ==============================
[0m22:20:07.148311 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:20:07.148682 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:20:07.628986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f18e141-abf2-4129-b9ab-e6c412655755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120eef250>]}
[0m22:20:07.660288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f18e141-abf2-4129-b9ab-e6c412655755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107119b20>]}
[0m22:20:07.660946 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:20:07.786313 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:20:07.872920 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:20:07.873319 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:20:08.011390 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m22:20:08.020031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9f18e141-abf2-4129-b9ab-e6c412655755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ac6aee0>]}
[0m22:20:08.069489 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:20:08.072411 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:20:08.086105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9f18e141-abf2-4129-b9ab-e6c412655755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14aa60880>]}
[0m22:20:08.086481 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:20:08.086691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f18e141-abf2-4129-b9ab-e6c412655755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a7c3310>]}
[0m22:20:08.087365 [info ] [MainThread]: 
[0m22:20:08.087586 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:20:08.087757 [info ] [MainThread]: 
[0m22:20:08.088047 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:20:08.088536 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:20:08.161729 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:20:08.162001 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:20:08.162170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:20:09.022080 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.860 seconds
[0m22:20:09.034971 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m22:20:09.042189 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m22:20:09.052031 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:20:09.055051 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:20:09.055479 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:20:09.055855 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:20:09.056569 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:20:09.229575 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.173 seconds
[0m22:20:09.583051 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.526 seconds
[0m22:20:09.588225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f18e141-abf2-4129-b9ab-e6c412655755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ac15430>]}
[0m22:20:09.593388 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:20:09.594374 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:20:09.595176 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m22:20:09.595765 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:20:09.613483 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:20:09.615313 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:20:09.647960 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:20:09.651714 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:20:09.652783 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What is the most recent month with receipt data, and what are the associated receipt items?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get most recent month's receipts and items
    recent_month_data as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            ri.barcode,
            ri.item_index,
            ri.description,
            ri.quantity,
            ri.total_final_price,
            'Recent' as month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join most_recent_month m
            on date_trunc('month', r.scanned_timestamp) = m.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Get previous month's receipts and items
    previous_month_data as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            ri.barcode,
            ri.item_index,
            ri.description,
            ri.quantity,
            ri.total_final_price,
            'Previous' as month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join previous_month p
            on date_trunc('month', r.scanned_timestamp) = p.prev_month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Combine the data from both months
    combined_months_data as (
        select
            receipt_id,
            scanned_timestamp,
            barcode,
            item_index,
            description,
            quantity,
            total_final_price,
            month_type
        from recent_month_data
        
        union all
        
        select
            receipt_id,
            scanned_timestamp,
            barcode,
            item_index,
            description,
            quantity,
            total_final_price,
            month_type
        from previous_month_data
    ),
    
    -- Get months for reference
    month_reference as (
        select
            month_start as recent_month_start,
            prev_month_start as previous_month_start
        from most_recent_month
        cross join previous_month
    )

-- Return the receipt items along with month information
select
    cmd.*,
    mr.recent_month_start,
    mr.previous_month_start
from combined_months_data cmd
cross join month_reference mr
order by 
    case when month_type = 'Recent' then 1 else 2 end,
    scanned_timestamp,
    receipt_id,
    item_index
        );
[0m22:20:09.868991 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb14ac-0000-cabe-0001-5dbe0001a076
[0m22:20:09.869404 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 29 at position 12
invalid identifier 'RI.ITEM_INDEX'
[0m22:20:09.876428 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 29 at position 12
  invalid identifier 'RI.ITEM_INDEX'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m22:20:09.878021 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f18e141-abf2-4129-b9ab-e6c412655755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bc624c0>]}
[0m22:20:09.878521 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.28s]
[0m22:20:09.878959 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:20:09.879326 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 29 at position 12
  invalid identifier 'RI.ITEM_INDEX'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m22:20:09.880100 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:20:09.880316 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:20:09.880514 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:20:09.963490 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m22:20:09.963909 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m22:20:10.151359 [info ] [MainThread]: 
[0m22:20:10.152557 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.06 seconds (2.06s).
[0m22:20:10.154179 [debug] [MainThread]: Command end result
[0m22:20:10.190335 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:20:10.191932 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:20:10.199130 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:20:10.199434 [info ] [MainThread]: 
[0m22:20:10.199786 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:20:10.200066 [info ] [MainThread]: 
[0m22:20:10.200393 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 29 at position 12
  invalid identifier 'RI.ITEM_INDEX'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m22:20:10.200661 [info ] [MainThread]: 
[0m22:20:10.200941 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:20:10.203198 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.0984097, "process_in_blocks": "0", "process_kernel_time": 0.741355, "process_mem_max_rss": "168198144", "process_out_blocks": "0", "process_user_time": 2.959415}
[0m22:20:10.203559 [debug] [MainThread]: Command `dbt run` failed at 22:20:10.203487 after 3.10 seconds
[0m22:20:10.203894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d6ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14aa606a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f1a700>]}
[0m22:20:10.204232 [debug] [MainThread]: Flushing usage events
[0m22:20:10.429917 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:23:02.427451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b5ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11051f0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11051fc70>]}


============================== 22:23:02.430805 | 7516fbe0-8958-46bc-8795-0b73b4addf03 ==============================
[0m22:23:02.430805 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:23:02.431178 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:23:02.940782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7516fbe0-8958-46bc-8795-0b73b4addf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120d48d30>]}
[0m22:23:02.972360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7516fbe0-8958-46bc-8795-0b73b4addf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e7cb80>]}
[0m22:23:02.972917 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:23:03.095911 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:23:03.196668 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:23:03.197094 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:23:03.337992 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m22:23:03.346638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7516fbe0-8958-46bc-8795-0b73b4addf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1215e8ee0>]}
[0m22:23:03.396334 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:23:03.400332 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:23:03.413647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7516fbe0-8958-46bc-8795-0b73b4addf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1213e8a90>]}
[0m22:23:03.413966 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:23:03.414166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7516fbe0-8958-46bc-8795-0b73b4addf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121009640>]}
[0m22:23:03.414824 [info ] [MainThread]: 
[0m22:23:03.415030 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:23:03.415202 [info ] [MainThread]: 
[0m22:23:03.415487 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:23:03.415951 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:23:03.489042 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:23:03.489290 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:23:03.489457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:04.610087 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.120 seconds
[0m22:23:04.620581 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m22:23:04.621257 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m22:23:04.634153 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:23:04.636671 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:23:04.637067 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:23:04.637326 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:23:04.637830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:04.763284 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.126 seconds
[0m22:23:05.074474 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.436 seconds
[0m22:23:05.081514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7516fbe0-8958-46bc-8795-0b73b4addf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1300a5310>]}
[0m22:23:05.087343 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:23:05.088301 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:23:05.089093 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m22:23:05.089696 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:23:05.105860 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:23:05.107388 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:23:05.140568 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:23:05.143547 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:23:05.143957 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What is the most recent month with receipt data, and what are the associated receipt items?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get most recent month's receipts and items
    recent_month_data as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            ri.barcode,
            ri.description,
            ri.quantity,
            ri.total_final_price,
            'Recent' as month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join most_recent_month m
            on date_trunc('month', r.scanned_timestamp) = m.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Get previous month's receipts and items
    previous_month_data as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            ri.barcode,
            ri.description,
            ri.quantity,
            ri.total_final_price,
            'Previous' as month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join previous_month p
            on date_trunc('month', r.scanned_timestamp) = p.prev_month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Combine the data from both months
    combined_months_data as (
        select
            receipt_id,
            scanned_timestamp,
            barcode,
            description,
            quantity,
            total_final_price,
            month_type
        from recent_month_data
        
        union all
        
        select
            receipt_id,
            scanned_timestamp,
            barcode,
            description,
            quantity,
            total_final_price,
            month_type
        from previous_month_data
    ),
    
    -- Get months for reference
    month_reference as (
        select
            month_start as recent_month_start,
            prev_month_start as previous_month_start
        from most_recent_month
        cross join previous_month
    )

-- Return the receipt items along with month information
select
    cmd.*,
    mr.recent_month_start,
    mr.previous_month_start
from combined_months_data cmd
cross join month_reference mr
order by 
    case when month_type = 'Recent' then 1 else 2 end,
    scanned_timestamp,
    receipt_id
        );
[0m22:23:05.311879 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb14af-0000-ca32-0001-5dbe000120ee
[0m22:23:05.312228 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 30 at position 12
invalid identifier 'RI.QUANTITY'
[0m22:23:05.317955 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 30 at position 12
  invalid identifier 'RI.QUANTITY'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m22:23:05.319370 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7516fbe0-8958-46bc-8795-0b73b4addf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1307e24f0>]}
[0m22:23:05.319821 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.23s]
[0m22:23:05.320198 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:23:05.320522 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 30 at position 12
  invalid identifier 'RI.QUANTITY'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m22:23:05.321225 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:23:05.321442 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:23:05.321637 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:23:05.390230 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m22:23:05.390635 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m22:23:05.463194 [info ] [MainThread]: 
[0m22:23:05.463713 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.05 seconds (2.05s).
[0m22:23:05.464513 [debug] [MainThread]: Command end result
[0m22:23:05.491412 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:23:05.492847 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:23:05.498546 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:23:05.498810 [info ] [MainThread]: 
[0m22:23:05.499100 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:23:05.499340 [info ] [MainThread]: 
[0m22:23:05.499610 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 30 at position 12
  invalid identifier 'RI.QUANTITY'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m22:23:05.499827 [info ] [MainThread]: 
[0m22:23:05.500055 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:23:05.502160 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.118957, "process_in_blocks": "0", "process_kernel_time": 0.671758, "process_mem_max_rss": "168083456", "process_out_blocks": "0", "process_user_time": 3.015519}
[0m22:23:05.502489 [debug] [MainThread]: Command `dbt run` failed at 22:23:05.502422 after 3.12 seconds
[0m22:23:05.502778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b5ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1210c6bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059ac730>]}
[0m22:23:05.503062 [debug] [MainThread]: Flushing usage events
[0m22:23:05.653982 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:24:18.772352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074dbe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10838b0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10838bc70>]}


============================== 22:24:18.775358 | c91094d9-034a-4d9c-99ed-901e1790ea00 ==============================
[0m22:24:18.775358 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:24:18.775738 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:24:19.248482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c91094d9-034a-4d9c-99ed-901e1790ea00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132220d30>]}
[0m22:24:19.279810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c91094d9-034a-4d9c-99ed-901e1790ea00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107de8b80>]}
[0m22:24:19.280331 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:24:19.402483 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:24:19.488837 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:24:19.489220 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:24:19.628586 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m22:24:19.637291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c91094d9-034a-4d9c-99ed-901e1790ea00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132aa8ee0>]}
[0m22:24:19.687920 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:24:19.690713 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:24:19.704354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c91094d9-034a-4d9c-99ed-901e1790ea00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1327a7a90>]}
[0m22:24:19.704695 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:24:19.704900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c91094d9-034a-4d9c-99ed-901e1790ea00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1322c9640>]}
[0m22:24:19.705549 [info ] [MainThread]: 
[0m22:24:19.705754 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:24:19.705921 [info ] [MainThread]: 
[0m22:24:19.706233 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:24:19.706712 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:24:19.780686 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:24:19.780940 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:24:19.781104 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:24:20.605732 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.824 seconds
[0m22:24:20.618014 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m22:24:20.619060 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m22:24:20.640970 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:24:20.645258 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:24:20.645610 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:24:20.645936 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:24:20.646348 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:24:20.769280 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.123 seconds
[0m22:24:21.129463 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.483 seconds
[0m22:24:21.136516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c91094d9-034a-4d9c-99ed-901e1790ea00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b65310>]}
[0m22:24:21.141268 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:24:21.142223 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:24:21.142998 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m22:24:21.143581 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:24:21.159893 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:24:21.162091 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:24:21.195031 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:24:21.198093 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:24:21.198514 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What is the most recent month with receipt data, and what are the associated receipt items?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get most recent month's receipts and items
    recent_month_data as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            ri.barcode,
            ri.description,
            -- Removed quantity field that doesn't exist
            ri.total_final_price,
            'Recent' as month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join most_recent_month m
            on date_trunc('month', r.scanned_timestamp) = m.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Get previous month's receipts and items
    previous_month_data as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            ri.barcode,
            ri.description,
            -- Removed quantity field that doesn't exist
            ri.total_final_price,
            'Previous' as month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on r.receipt_id = ri.receipt_id
        join previous_month p
            on date_trunc('month', r.scanned_timestamp) = p.prev_month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Combine the data from both months
    combined_months_data as (
        select
            receipt_id,
            scanned_timestamp,
            barcode,
            description,
            -- Removed quantity field that doesn't exist
            total_final_price,
            month_type
        from recent_month_data
        
        union all
        
        select
            receipt_id,
            scanned_timestamp,
            barcode,
            description,
            -- Removed quantity field that doesn't exist
            total_final_price,
            month_type
        from previous_month_data
    ),
    
    -- Get months for reference
    month_reference as (
        select
            month_start as recent_month_start,
            prev_month_start as previous_month_start
        from most_recent_month
        cross join previous_month
    )

-- Return the receipt items along with month information
select
    cmd.*,
    mr.recent_month_start,
    mr.previous_month_start
from combined_months_data cmd
cross join month_reference mr
order by 
    case when month_type = 'Recent' then 1 else 2 end,
    scanned_timestamp,
    receipt_id
        );
[0m22:24:21.388363 [debug] [Thread-1  ]: Snowflake adapter: Snowflake query id: 01bb14b0-0000-ca41-0001-5dbe0001021a
[0m22:24:21.388755 [debug] [Thread-1  ]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 31 at position 12
invalid identifier 'RI.TOTAL_FINAL_PRICE'
[0m22:24:21.395451 [debug] [Thread-1  ]: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 31 at position 12
  invalid identifier 'RI.TOTAL_FINAL_PRICE'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m22:24:21.396997 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c91094d9-034a-4d9c-99ed-901e1790ea00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13316b4c0>]}
[0m22:24:21.397526 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model PUBLIC.fct_brands_recent ................. [[31mERROR[0m in 0.25s]
[0m22:24:21.397950 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:24:21.398310 [debug] [Thread-7  ]: Marking all children of 'model.fetch_analytics.fct_brands_recent' to be skipped because of status 'error'.  Reason: Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 31 at position 12
  invalid identifier 'RI.TOTAL_FINAL_PRICE'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql.
[0m22:24:21.399129 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:24:21.399370 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:24:21.399586 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:24:21.479315 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m22:24:21.479728 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m22:24:21.566328 [info ] [MainThread]: 
[0m22:24:21.566965 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.86 seconds (1.86s).
[0m22:24:21.567882 [debug] [MainThread]: Command end result
[0m22:24:21.597371 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:24:21.599257 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:24:21.605045 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:24:21.605321 [info ] [MainThread]: 
[0m22:24:21.605626 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:24:21.605878 [info ] [MainThread]: 
[0m22:24:21.606168 [error] [MainThread]:   Database Error in model fct_brands_recent (models/reporting/fct_brands_recent.sql)
  000904 (42000): SQL compilation error: error line 31 at position 12
  invalid identifier 'RI.TOTAL_FINAL_PRICE'
  compiled code at target/run/fetch_analytics/models/reporting/fct_brands_recent.sql
[0m22:24:21.606404 [info ] [MainThread]: 
[0m22:24:21.606650 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:24:21.608647 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.8772974, "process_in_blocks": "0", "process_kernel_time": 0.68678, "process_mem_max_rss": "167084032", "process_out_blocks": "0", "process_user_time": 2.986115}
[0m22:24:21.608975 [debug] [MainThread]: Command `dbt run` failed at 22:24:21.608910 after 2.88 seconds
[0m22:24:21.609261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074dbe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132386bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10732d730>]}
[0m22:24:21.609549 [debug] [MainThread]: Flushing usage events
[0m22:24:21.747411 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:27:25.201503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106abce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10796b0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10796bcd0>]}


============================== 22:27:25.204733 | 993bfa82-94ef-4fdb-919e-a64eee29daf5 ==============================
[0m22:27:25.204733 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:27:25.205108 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:27:25.691889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '993bfa82-94ef-4fdb-919e-a64eee29daf5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792e610>]}
[0m22:27:25.723718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '993bfa82-94ef-4fdb-919e-a64eee29daf5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792e2e0>]}
[0m22:27:25.724356 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:27:25.852787 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:27:25.941420 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:27:25.941827 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:27:26.079686 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m22:27:26.088251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '993bfa82-94ef-4fdb-919e-a64eee29daf5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1388a8fa0>]}
[0m22:27:26.138080 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:27:26.140866 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:27:26.156428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '993bfa82-94ef-4fdb-919e-a64eee29daf5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1388717f0>]}
[0m22:27:26.156787 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:27:26.156985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '993bfa82-94ef-4fdb-919e-a64eee29daf5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c89400>]}
[0m22:27:26.157636 [info ] [MainThread]: 
[0m22:27:26.157843 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:27:26.158011 [info ] [MainThread]: 
[0m22:27:26.158301 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:27:26.158737 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:27:26.232817 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:27:26.233075 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:27:26.233243 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:27:27.116898 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.883 seconds
[0m22:27:27.130172 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m22:27:27.138183 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m22:27:27.155742 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:27:27.157700 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:27:27.158106 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:27:27.158485 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:27:27.158802 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:27:27.584095 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.425 seconds
[0m22:27:27.673411 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.514 seconds
[0m22:27:27.680066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '993bfa82-94ef-4fdb-919e-a64eee29daf5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c20e20>]}
[0m22:27:27.685683 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:27:27.686601 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:27:27.687385 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m22:27:27.687972 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:27:27.703729 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:27:27.705587 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:27:27.737286 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:27:27.739694 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:27:27.740056 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top brands by receipts scanned for most recent month and previous month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get month ranges for filtering
    month_ranges as (
        select month_start, 'Current' as month_type
        from most_recent_month
        
        union all
        
        select prev_month_start as month_start, 'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipt data with month type indicator
    month_receipts as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            date_trunc('month', r.scanned_timestamp) as receipt_month,
            mr.month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join month_ranges mr
            on date_trunc('month', r.scanned_timestamp) = mr.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Join with receipt items
    receipt_details as (
        select
            mr.receipt_id,
            mr.scanned_timestamp,
            mr.month_type,
            ri.barcode,
            ri.description,
            ri.final_price,
            ri.quantity_purchased,
            ri.brand_code
        from month_receipts mr
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on mr.receipt_id = ri.receipt_id
    )

-- Return the combined results
select
    receipt_id,
    scanned_timestamp,
    month_type,
    barcode,
    description,
    final_price,
    quantity_purchased,
    brand_code
from receipt_details
order by
    case when month_type = 'Current' then 1 else 2 end,
    scanned_timestamp,
    receipt_id
        );
[0m22:27:29.373409 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.632 seconds
[0m22:27:29.414047 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '993bfa82-94ef-4fdb-919e-a64eee29daf5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139093100>]}
[0m22:27:29.414916 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.72s]
[0m22:27:29.415567 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:27:29.416829 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:27:29.417209 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:27:29.417523 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:27:29.508800 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m22:27:29.509399 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m22:27:29.603939 [info ] [MainThread]: 
[0m22:27:29.604738 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.45 seconds (3.45s).
[0m22:27:29.606087 [debug] [MainThread]: Command end result
[0m22:27:29.642264 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:27:29.644531 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:27:29.651459 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:27:29.651833 [info ] [MainThread]: 
[0m22:27:29.652229 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:27:29.652511 [info ] [MainThread]: 
[0m22:27:29.652812 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:27:29.655145 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4968944, "process_in_blocks": "0", "process_kernel_time": 0.621646, "process_mem_max_rss": "165691392", "process_out_blocks": "0", "process_user_time": 3.072552}
[0m22:27:29.655508 [debug] [MainThread]: Command `dbt run` succeeded at 22:27:29.655443 after 4.50 seconds
[0m22:27:29.655842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106abce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f34bc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1388717f0>]}
[0m22:27:29.656157 [debug] [MainThread]: Flushing usage events
[0m22:27:29.820267 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:49:08.959051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dd3e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c840a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c84c70>]}


============================== 22:49:08.962301 | b08831aa-2326-4dcc-a560-109897fc8b25 ==============================
[0m22:49:08.962301 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:49:08.962664 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:49:09.630289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b08831aa-2326-4dcc-a560-109897fc8b25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b48d30>]}
[0m22:49:09.661932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b08831aa-2326-4dcc-a560-109897fc8b25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076e0b80>]}
[0m22:49:09.662579 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:49:09.783953 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:49:09.869644 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:49:09.870014 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:49:10.009155 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m22:49:10.017802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b08831aa-2326-4dcc-a560-109897fc8b25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1301e9fd0>]}
[0m22:49:10.067870 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:49:10.070505 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:49:10.083843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b08831aa-2326-4dcc-a560-109897fc8b25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127fd0f70>]}
[0m22:49:10.084151 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:49:10.084349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b08831aa-2326-4dcc-a560-109897fc8b25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1301265e0>]}
[0m22:49:10.085023 [info ] [MainThread]: 
[0m22:49:10.085227 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:49:10.085395 [info ] [MainThread]: 
[0m22:49:10.085684 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:49:10.086130 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:49:10.160322 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:49:10.160602 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:49:10.160774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:11.237398 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.076 seconds
[0m22:49:11.243059 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m22:49:11.243578 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m22:49:11.253873 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:49:11.256191 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:49:11.256568 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:49:11.256831 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:49:11.257181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:11.383336 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.126 seconds
[0m22:49:11.848649 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.591 seconds
[0m22:49:11.855225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b08831aa-2326-4dcc-a560-109897fc8b25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130197f70>]}
[0m22:49:11.860604 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:49:11.861526 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:49:11.862286 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m22:49:11.862889 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:49:11.878710 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:49:11.880761 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:49:11.912865 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:49:11.915846 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:49:11.916265 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top brands by receipts scanned for most recent month and previous month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get month ranges for filtering
    month_ranges as (
        select month_start, 'Current' as month_type
        from most_recent_month
        
        union all
        
        select prev_month_start as month_start, 'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipt data with month type indicator
    month_receipts as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            date_trunc('month', r.scanned_timestamp) as receipt_month,
            mr.month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join month_ranges mr
            on date_trunc('month', r.scanned_timestamp) = mr.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Join with receipt items
    receipt_details as (
        select
            mr.receipt_id,
            mr.scanned_timestamp,
            mr.month_type,
            ri.barcode,
            ri.brand_code
        from month_receipts mr
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on mr.receipt_id = ri.receipt_id
    ),
    
    -- Join with brands
    receipt_brands as (
        select
            rd.receipt_id,
            rd.scanned_timestamp,
            rd.month_type,
            rd.barcode,
            rd.brand_code,
            b.brand_name
        from receipt_details rd
        left join RAW.PUBLIC_staging.staging_brands b
            on rd.brand_code = b.brand_code
    ),
    
    -- Count distinct receipts by brand and month type
    brand_counts as (
        select
            brand_name,
            month_type,
            count(distinct receipt_id) as receipt_count
        from receipt_brands
        where brand_name is not null
        group by brand_name, month_type
    ),
    
    -- Rank brands within each month
    ranked_brands as (
        select
            brand_name,
            month_type,
            receipt_count,
            rank() over (
                partition by month_type 
                order by receipt_count desc
            ) as rank_in_month
        from brand_counts
    )

-- Return the full results with brand ranking data
select
    rb.receipt_id,
    rb.scanned_timestamp,
    rb.month_type,
    rb.barcode,
    rb.brand_code,
    rb.brand_name,
    coalesce(rnk.receipt_count, 0) as brand_receipt_count,
    coalesce(rnk.rank_in_month, 999999) as brand_rank
from receipt_brands rb
left join ranked_brands rnk
    on rb.brand_name = rnk.brand_name
    and rb.month_type = rnk.month_type
order by
    case when rb.month_type = 'Current' then 1 else 2 end,
    coalesce(rnk.rank_in_month, 999999),
    rb.scanned_timestamp,
    rb.receipt_id
        );
[0m22:49:13.595483 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.679 seconds
[0m22:49:13.630227 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b08831aa-2326-4dcc-a560-109897fc8b25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1349f4490>]}
[0m22:49:13.630780 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.77s]
[0m22:49:13.631206 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:49:13.632018 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:49:13.632238 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:49:13.632478 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:49:13.727295 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m22:49:13.727668 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m22:49:13.816353 [info ] [MainThread]: 
[0m22:49:13.817418 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.73 seconds (3.73s).
[0m22:49:13.818916 [debug] [MainThread]: Command end result
[0m22:49:13.838756 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:49:13.839813 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:49:13.844449 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:49:13.844674 [info ] [MainThread]: 
[0m22:49:13.844922 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:49:13.845108 [info ] [MainThread]: 
[0m22:49:13.845306 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:49:13.846977 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.9338202, "process_in_blocks": "0", "process_kernel_time": 0.579908, "process_mem_max_rss": "169902080", "process_out_blocks": "0", "process_user_time": 3.190798}
[0m22:49:13.847353 [debug] [MainThread]: Command `dbt run` succeeded at 22:49:13.847280 after 4.93 seconds
[0m22:49:13.847601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dd3e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076e0b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130195700>]}
[0m22:49:13.847843 [debug] [MainThread]: Flushing usage events
[0m22:49:14.002428 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:59:06.226847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107100df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107faffa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fafc10>]}


============================== 22:59:06.230012 | d54f3f3d-292a-413f-b522-0533edbe0a60 ==============================
[0m22:59:06.230012 [info ] [MainThread]: Running with dbt=1.9.3
[0m22:59:06.230388 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select fct_brands_recent', 'send_anonymous_usage_stats': 'True'}
[0m22:59:06.767873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd54f3f3d-292a-413f-b522-0533edbe0a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f7f3a0>]}
[0m22:59:06.800570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd54f3f3d-292a-413f-b522-0533edbe0a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074ad700>]}
[0m22:59:06.801199 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m22:59:06.931869 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m22:59:07.017123 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:59:07.017510 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m22:59:07.156011 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m22:59:07.164658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd54f3f3d-292a-413f-b522-0533edbe0a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130469f70>]}
[0m22:59:07.214828 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:59:07.217523 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:59:07.230911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd54f3f3d-292a-413f-b522-0533edbe0a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130268a90>]}
[0m22:59:07.231224 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m22:59:07.231421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd54f3f3d-292a-413f-b522-0533edbe0a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e07790>]}
[0m22:59:07.232043 [info ] [MainThread]: 
[0m22:59:07.232249 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:59:07.232414 [info ] [MainThread]: 
[0m22:59:07.232698 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:59:07.233132 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m22:59:07.309914 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m22:59:07.310190 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m22:59:07.310357 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:59:08.401321 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.091 seconds
[0m22:59:08.406162 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m22:59:08.406609 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m22:59:08.413665 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m22:59:08.415424 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m22:59:08.415645 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m22:59:08.415837 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m22:59:08.416084 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:59:08.538514 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.122 seconds
[0m22:59:08.930266 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.514 seconds
[0m22:59:08.934695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd54f3f3d-292a-413f-b522-0533edbe0a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1302babb0>]}
[0m22:59:08.939104 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m22:59:08.939859 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m22:59:08.940507 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m22:59:08.941002 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m22:59:08.955359 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m22:59:08.956882 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m22:59:08.987127 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m22:59:08.990457 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m22:59:08.990863 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top brands by receipts scanned for most recent month and previous month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get month ranges for filtering
    month_ranges as (
        select month_start, 'Current' as month_type
        from most_recent_month
        
        union all
        
        select prev_month_start as month_start, 'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipt data with month type indicator
    month_receipts as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            date_trunc('month', r.scanned_timestamp) as receipt_month,
            mr.month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join month_ranges mr
            on date_trunc('month', r.scanned_timestamp) = mr.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Join with receipt items
    receipt_details as (
        select
            mr.receipt_id,
            mr.scanned_timestamp,
            mr.month_type,
            ri.barcode,
            ri.brand_code
        from month_receipts mr
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on mr.receipt_id = ri.receipt_id
    ),
    
    -- Join with brands to get brand information
    receipt_brands as (
        select
            rd.receipt_id,
            rd.scanned_timestamp,
            rd.month_type,
            rd.barcode,
            rd.brand_code,
            b.brand_name,
            b.brand_id,
            b.category
        from receipt_details rd
        left join RAW.PUBLIC_staging.staging_brands b 
            on rd.brand_code = b.brand_code
    ),

    -- Count distinct receipts by brand and month type
    brand_counts as (
        select
            brand_name,
            month_type,
            count(distinct receipt_id) as receipt_count
        from receipt_brands
        where brand_name is not null
        group by brand_name, month_type
    ),
    
    -- Rank brands by receipt count within each month
    ranked_brands as (
        select
            brand_name,
            month_type,
            receipt_count,
            rank() over (partition by month_type order by receipt_count desc) as rank_in_month
        from brand_counts
    )

-- Return the combined results with brand information and rankings
select
    rb.receipt_id,
    rb.scanned_timestamp,
    rb.month_type,
    rb.barcode,
    rb.brand_code,
    rb.brand_name,
    rb.brand_id,
    rb.category,
    coalesce(rnk.receipt_count, 0) as receipt_count,
    coalesce(rnk.rank_in_month, 999999) as brand_rank
from receipt_brands rb
left join ranked_brands rnk
    on rb.brand_name = rnk.brand_name
    and rb.month_type = rnk.month_type
order by
    case when rb.month_type = 'Current' then 1 else 2 end,
    coalesce(rnk.rank_in_month, 999999),
    rb.scanned_timestamp,
    rb.receipt_id
        );
[0m22:59:11.138617 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 2.147 seconds
[0m22:59:11.172191 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd54f3f3d-292a-413f-b522-0533edbe0a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130d76430>]}
[0m22:59:11.172995 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 2.23s]
[0m22:59:11.173598 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m22:59:11.174651 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:59:11.174990 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m22:59:11.175263 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m22:59:11.259099 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m22:59:11.259643 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m22:59:13.550858 [info ] [MainThread]: 
[0m22:59:13.551356 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.32 seconds (6.32s).
[0m22:59:13.551975 [debug] [MainThread]: Command end result
[0m22:59:13.571689 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m22:59:13.573867 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m22:59:13.579289 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m22:59:13.579550 [info ] [MainThread]: 
[0m22:59:13.579825 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:59:13.580018 [info ] [MainThread]: 
[0m22:59:13.580224 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:59:13.581853 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.4016204, "process_in_blocks": "0", "process_kernel_time": 0.748826, "process_mem_max_rss": "166363136", "process_out_blocks": "0", "process_user_time": 2.827667}
[0m22:59:13.582114 [debug] [MainThread]: Command `dbt run` succeeded at 22:59:13.582062 after 7.40 seconds
[0m22:59:13.582353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107100df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074ad700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e42310>]}
[0m22:59:13.582585 [debug] [MainThread]: Flushing usage events
[0m22:59:13.802853 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:05:16.276982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10543ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062ebfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062ebc40>]}


============================== 23:05:16.280159 | a09b64f8-b7f8-48ad-adeb-8a9185ad1e35 ==============================
[0m23:05:16.280159 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:05:16.280531 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:05:16.957795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a09b64f8-b7f8-48ad-adeb-8a9185ad1e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062bb250>]}
[0m23:05:16.989343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a09b64f8-b7f8-48ad-adeb-8a9185ad1e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057e9b20>]}
[0m23:05:16.989916 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:05:17.116718 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:05:17.205010 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:05:17.205403 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m23:05:17.349951 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m23:05:17.358853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a09b64f8-b7f8-48ad-adeb-8a9185ad1e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139669fa0>]}
[0m23:05:17.410520 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:05:17.413199 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:05:17.428229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a09b64f8-b7f8-48ad-adeb-8a9185ad1e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1394680d0>]}
[0m23:05:17.428590 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:05:17.428787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a09b64f8-b7f8-48ad-adeb-8a9185ad1e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13878ef40>]}
[0m23:05:17.429439 [info ] [MainThread]: 
[0m23:05:17.429661 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:05:17.429832 [info ] [MainThread]: 
[0m23:05:17.430115 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:05:17.430565 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:05:17.518668 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:05:17.518956 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:05:17.519125 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:05:18.611635 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.092 seconds
[0m23:05:18.623654 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m23:05:18.630738 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m23:05:18.648134 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:05:18.650380 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:05:18.650712 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:05:18.651037 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:05:18.651341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:05:18.756780 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.105 seconds
[0m23:05:19.121993 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.470 seconds
[0m23:05:19.128811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a09b64f8-b7f8-48ad-adeb-8a9185ad1e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045a1dc0>]}
[0m23:05:19.133762 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:05:19.134684 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:05:19.135485 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m23:05:19.136074 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:05:19.151842 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:05:19.153798 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:05:19.185962 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:05:19.190141 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:05:19.190544 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top brands by receipts scanned for most recent month and previous month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get month ranges for filtering
    month_ranges as (
        select month_start, 'Current' as month_type
        from most_recent_month
        
        union all
        
        select prev_month_start as month_start, 'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipt data with month type indicator
    month_receipts as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            date_trunc('month', r.scanned_timestamp) as receipt_month,
            mr.month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join month_ranges mr
            on date_trunc('month', r.scanned_timestamp) = mr.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Join with receipt items
    receipt_details as (
        select
            mr.receipt_id,
            mr.scanned_timestamp,
            mr.month_type,
            ri.barcode,
            ri.brand_code
        from month_receipts mr
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on mr.receipt_id = ri.receipt_id
    ),
    
    -- Join with brands to get brand information
    receipt_brands as (
        select
            rd.receipt_id,
            rd.scanned_timestamp,
            rd.month_type,
            rd.barcode,
            rd.brand_code,
            b.brand_name,
            b.brand_id,
            b.category
        from receipt_details rd
        left join RAW.PUBLIC_staging.staging_brands b 
            on rd.brand_code = b.brand_code
    )

-- Return the results with brand information
select
    rb.receipt_id,
    rb.scanned_timestamp,
    rb.month_type,
    rb.barcode,
    rb.brand_code,
    rb.brand_name,
    rb.brand_id,
    rb.category
from receipt_brands rb
order by
    case when rb.month_type = 'Current' then 1 else 2 end,
    rb.scanned_timestamp,
    rb.receipt_id
        );
[0m23:05:20.749928 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.559 seconds
[0m23:05:20.769406 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a09b64f8-b7f8-48ad-adeb-8a9185ad1e35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139e68880>]}
[0m23:05:20.769895 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.63s]
[0m23:05:20.770280 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:05:20.771094 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:05:20.771343 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:05:20.771543 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:05:20.848483 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m23:05:20.848881 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m23:05:20.941359 [info ] [MainThread]: 
[0m23:05:20.941985 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.51 seconds (3.51s).
[0m23:05:20.942903 [debug] [MainThread]: Command end result
[0m23:05:20.973031 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:05:20.974694 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:05:20.982405 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:05:20.982692 [info ] [MainThread]: 
[0m23:05:20.983022 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:05:20.983264 [info ] [MainThread]: 
[0m23:05:20.983518 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:05:20.985667 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.752875, "process_in_blocks": "0", "process_kernel_time": 0.686807, "process_mem_max_rss": "167231488", "process_out_blocks": "0", "process_user_time": 3.083797}
[0m23:05:20.986004 [debug] [MainThread]: Command `dbt run` succeeded at 23:05:20.985938 after 4.75 seconds
[0m23:05:20.986303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10543ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1387899a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139468d60>]}
[0m23:05:20.986600 [debug] [MainThread]: Flushing usage events
[0m23:05:21.267249 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:06:58.003700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dace50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c5bfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c5bc40>]}


============================== 23:06:58.006718 | 8a09efff-c73f-4d6c-aba7-80a5cb8f6335 ==============================
[0m23:06:58.006718 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:06:58.007070 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:06:58.491150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8a09efff-c73f-4d6c-aba7-80a5cb8f6335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a3b8610>]}
[0m23:06:58.523120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8a09efff-c73f-4d6c-aba7-80a5cb8f6335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aa7f40>]}
[0m23:06:58.523706 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:06:58.648602 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:06:58.742865 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:06:58.743590 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m23:06:58.888392 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m23:06:58.897875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8a09efff-c73f-4d6c-aba7-80a5cb8f6335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ad28fa0>]}
[0m23:06:58.950354 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:06:58.953209 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:06:58.967225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8a09efff-c73f-4d6c-aba7-80a5cb8f6335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab28610>]}
[0m23:06:58.967628 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:06:58.967849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8a09efff-c73f-4d6c-aba7-80a5cb8f6335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a3ad400>]}
[0m23:06:58.968570 [info ] [MainThread]: 
[0m23:06:58.968803 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:06:58.968972 [info ] [MainThread]: 
[0m23:06:58.969274 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:06:58.969750 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:06:59.045580 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:06:59.045836 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:06:59.046003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:06:59.970068 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.924 seconds
[0m23:06:59.976976 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m23:06:59.977515 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m23:06:59.987771 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:06:59.989897 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:06:59.990263 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:06:59.990517 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:06:59.990870 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:07:00.207124 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.216 seconds
[0m23:07:00.633535 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.643 seconds
[0m23:07:00.635837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8a09efff-c73f-4d6c-aba7-80a5cb8f6335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12acd7280>]}
[0m23:07:00.638262 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:07:00.638633 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:07:00.638958 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m23:07:00.639198 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:07:00.647498 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:07:00.648660 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:07:00.672197 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:07:00.675135 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:07:00.675520 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top brands by receipts scanned for most recent month and previous month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get month ranges for filtering
    month_ranges as (
        select month_start, 'Current' as month_type
        from most_recent_month
        
        union all
        
        select prev_month_start as month_start, 'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipt data with month type indicator
    month_receipts as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            date_trunc('month', r.scanned_timestamp) as receipt_month,
            mr.month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join month_ranges mr
            on date_trunc('month', r.scanned_timestamp) = mr.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Join with receipt items and filter for non-null brand_code
    receipt_details as (
        select
            mr.receipt_id,
            mr.scanned_timestamp,
            mr.month_type,
            ri.barcode,
            ri.brand_code
        from month_receipts mr
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on mr.receipt_id = ri.receipt_id
        where ri.brand_code is not null  -- Only include items with brand_code
    ),
    
    -- Join with brands to get brand information
    receipt_brands as (
        select
            rd.receipt_id,
            rd.scanned_timestamp,
            rd.month_type,
            rd.barcode,
            rd.brand_code,
            b.brand_name,
            b.brand_id,
            b.category
        from receipt_details rd
        left join RAW.PUBLIC_staging.staging_brands b 
            on rd.brand_code = b.brand_code
    )

-- Return the results with brand information
select
    rb.receipt_id,
    rb.scanned_timestamp,
    rb.month_type,
    rb.barcode,
    rb.brand_code,
    rb.brand_name,
    rb.brand_id,
    rb.category
from receipt_brands rb
order by
    case when rb.month_type = 'Current' then 1 else 2 end,
    rb.scanned_timestamp,
    rb.receipt_id
        );
[0m23:07:02.025494 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.349 seconds
[0m23:07:02.066304 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a09efff-c73f-4d6c-aba7-80a5cb8f6335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b433460>]}
[0m23:07:02.067134 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.43s]
[0m23:07:02.067741 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:07:02.069021 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:07:02.069378 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:07:02.069697 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:07:02.169471 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m23:07:02.170065 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m23:07:02.270147 [info ] [MainThread]: 
[0m23:07:02.270851 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.30 seconds (3.30s).
[0m23:07:02.271990 [debug] [MainThread]: Command end result
[0m23:07:02.305878 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:07:02.307909 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:07:02.313886 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:07:02.314177 [info ] [MainThread]: 
[0m23:07:02.314547 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:07:02.314813 [info ] [MainThread]: 
[0m23:07:02.315103 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:07:02.317338 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.356155, "process_in_blocks": "0", "process_kernel_time": 0.644523, "process_mem_max_rss": "170999808", "process_out_blocks": "0", "process_user_time": 3.02527}
[0m23:07:02.317699 [debug] [MainThread]: Command `dbt run` succeeded at 23:07:02.317632 after 4.36 seconds
[0m23:07:02.317999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dace50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aa7f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab28e50>]}
[0m23:07:02.318293 [debug] [MainThread]: Flushing usage events
[0m23:07:02.415626 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:07:14.396894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12006bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120edf070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120edfd60>]}


============================== 23:07:14.399867 | 701128e7-2c63-484f-b23f-7ba72e4868ab ==============================
[0m23:07:14.399867 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:07:14.400223 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:07:14.863030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '701128e7-2c63-484f-b23f-7ba72e4868ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120eb5e50>]}
[0m23:07:14.894828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '701128e7-2c63-484f-b23f-7ba72e4868ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120864e20>]}
[0m23:07:14.895743 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:07:15.018064 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:07:15.113221 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:07:15.113602 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:07:15.122224 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m23:07:15.158035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '701128e7-2c63-484f-b23f-7ba72e4868ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14349ff10>]}
[0m23:07:15.231211 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:07:15.234055 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:07:15.252372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '701128e7-2c63-484f-b23f-7ba72e4868ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1434c35b0>]}
[0m23:07:15.253101 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:07:15.254155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '701128e7-2c63-484f-b23f-7ba72e4868ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1433d1490>]}
[0m23:07:15.255799 [info ] [MainThread]: 
[0m23:07:15.256554 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:07:15.256798 [info ] [MainThread]: 
[0m23:07:15.257196 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:07:15.257887 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:07:15.305409 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:07:15.305740 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:07:15.305940 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:07:15.856020 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.550 seconds
[0m23:07:15.867844 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m23:07:15.868611 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m23:07:15.889921 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:07:15.894393 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:07:15.894765 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:07:15.895107 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:07:15.895521 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:07:16.001730 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.106 seconds
[0m23:07:16.314337 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.418 seconds
[0m23:07:16.320972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '701128e7-2c63-484f-b23f-7ba72e4868ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ef0e80>]}
[0m23:07:16.326276 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:07:16.327254 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:07:16.328049 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m23:07:16.328656 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:07:16.345077 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:07:16.346091 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:07:16.379808 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:07:16.382434 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:07:16.382866 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top brands by receipts scanned for most recent month and previous month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get month ranges for filtering
    month_ranges as (
        select month_start, 'Current' as month_type
        from most_recent_month
        
        union all
        
        select prev_month_start as month_start, 'Previous' as month_type
        from previous_month
    ),
    
    -- Get receipt data with month type indicator
    month_receipts as (
        select 
            r.receipt_id,
            r.scanned_timestamp,
            date_trunc('month', r.scanned_timestamp) as receipt_month,
            mr.month_type
        from RAW.PUBLIC_staging.staging_receipts r
        join month_ranges mr
            on date_trunc('month', r.scanned_timestamp) = mr.month_start
        where r.scanned_timestamp is not null
    ),
    
    -- Join with receipt items and filter for non-null brand_code
    receipt_details as (
        select
            mr.receipt_id,
            mr.scanned_timestamp,
            mr.month_type,
            ri.barcode,
            ri.brand_code
        from month_receipts mr
        join RAW.PUBLIC_staging.staging_receipt_items ri 
            on mr.receipt_id = ri.receipt_id
        where ri.brand_code is not null  -- Only include items with brand_code
    ),
    
    -- Join with brands to get brand information
    receipt_brands as (
        select
            rd.receipt_id,
            rd.scanned_timestamp,
            rd.month_type,
            rd.barcode,
            rd.brand_code,
            b.brand_name,
            b.brand_id,
            b.category
        from receipt_details rd
        left join RAW.PUBLIC_staging.staging_brands b 
            on rd.brand_code = b.brand_code
    )

-- Return the results with brand information
select
    rb.receipt_id,
    rb.scanned_timestamp,
    rb.month_type,
    rb.barcode,
    rb.brand_code,
    rb.brand_name,
    rb.brand_id,
    rb.category
from receipt_brands rb
order by
    case when rb.month_type = 'Current' then 1 else 2 end,
    rb.scanned_timestamp,
    rb.receipt_id
        );
[0m23:07:17.592544 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.209 seconds
[0m23:07:17.629460 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '701128e7-2c63-484f-b23f-7ba72e4868ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143cc4940>]}
[0m23:07:17.630301 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.30s]
[0m23:07:17.630873 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:07:17.632328 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:07:17.632609 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:07:17.632880 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:07:17.725580 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m23:07:17.726147 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m23:07:17.811591 [info ] [MainThread]: 
[0m23:07:17.812387 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.55 seconds (2.55s).
[0m23:07:17.813632 [debug] [MainThread]: Command end result
[0m23:07:17.849659 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:07:17.852349 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:07:17.858921 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:07:17.859237 [info ] [MainThread]: 
[0m23:07:17.859617 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:07:17.859901 [info ] [MainThread]: 
[0m23:07:17.860197 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:07:17.862575 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5092447, "process_in_blocks": "0", "process_kernel_time": 0.693115, "process_mem_max_rss": "162250752", "process_out_blocks": "0", "process_user_time": 2.956291}
[0m23:07:17.862980 [debug] [MainThread]: Command `dbt run` succeeded at 23:07:17.862914 after 3.51 seconds
[0m23:07:17.863312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12006bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107971460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079628e0>]}
[0m23:07:17.863609 [debug] [MainThread]: Flushing usage events
[0m23:07:17.929883 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:10:09.294813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10718feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108040fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108040c40>]}


============================== 23:10:09.299080 | 2496c856-a85a-43aa-9389-edfc4622344b ==============================
[0m23:10:09.299080 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:10:09.299528 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select fct_brands_recent', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:10:09.848869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2496c856-a85a-43aa-9389-edfc4622344b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106266220>]}
[0m23:10:09.880677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2496c856-a85a-43aa-9389-edfc4622344b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aaa070>]}
[0m23:10:09.881363 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:10:10.003933 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:10:10.091199 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:10:10.091605 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m23:10:10.231687 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m23:10:10.240477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2496c856-a85a-43aa-9389-edfc4622344b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1432e8ee0>]}
[0m23:10:10.294463 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:10:10.297068 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:10:10.310074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2496c856-a85a-43aa-9389-edfc4622344b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1430e96a0>]}
[0m23:10:10.310402 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:10:10.310606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2496c856-a85a-43aa-9389-edfc4622344b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d0d0a0>]}
[0m23:10:10.311247 [info ] [MainThread]: 
[0m23:10:10.311450 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:10:10.311620 [info ] [MainThread]: 
[0m23:10:10.311912 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:10:10.312381 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:10:10.386838 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:10:10.387096 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:10:10.387262 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:10:11.445121 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.058 seconds
[0m23:10:11.458262 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m23:10:11.465460 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m23:10:11.483144 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:10:11.486277 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:10:11.486634 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:10:11.486970 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:10:11.487270 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:10:11.670117 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.182 seconds
[0m23:10:11.921056 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.433 seconds
[0m23:10:11.928524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2496c856-a85a-43aa-9389-edfc4622344b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062f4e50>]}
[0m23:10:11.933909 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:10:11.934797 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:10:11.935556 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m23:10:11.936155 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:10:11.952114 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:10:11.953810 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:10:11.985733 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:10:11.988294 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:10:11.988683 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top 5 brands by receipts scanned for most recent month?
-- How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
        where scanned_timestamp is not null
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get data for the last two months
    monthly_data as (
        select
            b.brand_name,
            date_trunc('month', r.scanned_timestamp) as month_start,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri on r.receipt_id = ri.receipt_id
        join RAW.PUBLIC_staging.staging_brands b on ri.brand_code = b.brand_code
        where 
            r.scanned_timestamp is not null
            and b.brand_name is not null
            and date_trunc('month', r.scanned_timestamp) in (
                (select month_start from most_recent_month),
                (select prev_month_start from previous_month)
            )
        group by b.brand_name, date_trunc('month', r.scanned_timestamp)
    ),
    
    -- Rank brands within each month
    ranked_brands as (
        select
            brand_name,
            month_start,
            receipt_count,
            rank() over (
                partition by month_start 
                order by receipt_count desc
            ) as rank_in_month,
            case
                when month_start = (select month_start from most_recent_month) then 'Current'
                else 'Previous'
            end as month_type
        from monthly_data
    )

-- Final results with top 5 brands for each month
select
    brand_name,
    month_start,
    receipt_count,
    rank_in_month,
    month_type
from ranked_brands
where rank_in_month <= 5
order by
    case when month_type = 'Current' then 1 else 2 end,
    rank_in_month
        );
[0m23:10:12.988133 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.999 seconds
[0m23:10:13.017080 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2496c856-a85a-43aa-9389-edfc4622344b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143b9e190>]}
[0m23:10:13.017784 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.08s]
[0m23:10:13.018320 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:10:13.019256 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:10:13.019525 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:10:13.019784 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:10:13.103698 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m23:10:13.104279 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m23:10:13.195874 [info ] [MainThread]: 
[0m23:10:13.196754 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.88 seconds (2.88s).
[0m23:10:13.198158 [debug] [MainThread]: Command end result
[0m23:10:13.234574 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:10:13.237042 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:10:13.243811 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:10:13.244133 [info ] [MainThread]: 
[0m23:10:13.244510 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:10:13.244789 [info ] [MainThread]: 
[0m23:10:13.245084 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:10:13.247367 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.0008492, "process_in_blocks": "0", "process_kernel_time": 0.529771, "process_mem_max_rss": "169066496", "process_out_blocks": "0", "process_user_time": 3.179401}
[0m23:10:13.247731 [debug] [MainThread]: Command `dbt run` succeeded at 23:10:13.247659 after 4.00 seconds
[0m23:10:13.248055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10718feb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107314a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065dedf0>]}
[0m23:10:13.248405 [debug] [MainThread]: Flushing usage events
[0m23:10:13.472566 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:18.876055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102918e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037c7fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037c7c40>]}


============================== 23:14:18.879311 | 219b0d4b-fefb-4de1-944a-7e76f4d7b09f ==============================
[0m23:14:18.879311 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:14:18.879668 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select fct_brands_recent', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:14:19.448622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '219b0d4b-fefb-4de1-944a-7e76f4d7b09f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118a83610>]}
[0m23:14:19.481701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '219b0d4b-fefb-4de1-944a-7e76f4d7b09f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103613f40>]}
[0m23:14:19.482471 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:14:19.605087 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:14:19.693159 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:14:19.693570 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m23:14:19.845784 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m23:14:19.855017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '219b0d4b-fefb-4de1-944a-7e76f4d7b09f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1190dcfa0>]}
[0m23:14:19.906621 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:14:19.909514 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:14:19.923026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '219b0d4b-fefb-4de1-944a-7e76f4d7b09f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118edb610>]}
[0m23:14:19.923375 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:14:19.923578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '219b0d4b-fefb-4de1-944a-7e76f4d7b09f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118a79400>]}
[0m23:14:19.924224 [info ] [MainThread]: 
[0m23:14:19.924432 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:14:19.924598 [info ] [MainThread]: 
[0m23:14:19.924880 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:14:19.925327 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:14:20.006421 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:14:20.006698 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:14:20.006866 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:14:21.021148 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.014 seconds
[0m23:14:21.026866 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m23:14:21.027340 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m23:14:21.036393 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:14:21.038531 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:14:21.038847 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:14:21.039141 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:14:21.039591 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:14:21.154947 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.116 seconds
[0m23:14:21.466689 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.427 seconds
[0m23:14:21.468445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '219b0d4b-fefb-4de1-944a-7e76f4d7b09f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11908a280>]}
[0m23:14:21.470988 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:14:21.471396 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:14:21.471717 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m23:14:21.471935 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:14:21.479209 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:14:21.480320 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:14:21.501745 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:14:21.509480 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:14:21.512669 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question:
-- What are the top 5 brands by receipts scanned for most recent month?
-- How does the ranking of the top 5 brands by receipts scanned for the recent month compare to the previous month?



with 
    -- Find the most recent month
    most_recent_month as (
        select 
            max(date_trunc('month', scanned_timestamp)) as month_start
        from RAW.PUBLIC_staging.staging_receipts
        where scanned_timestamp is not null
    ),
    
    -- Get the last month before the most recent month
    previous_month as (
        select
            dateadd('month', -1, month_start) as prev_month_start
        from most_recent_month
    ),
    
    -- Get data for the last two months
    monthly_data as (
        select
            b.brand_name,  -- Using brand_name from staging_brands
            date_trunc('month', r.scanned_timestamp) as month_start,  -- Using scanned_timestamp from staging_receipts
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri on r.receipt_id = ri.receipt_id
        join RAW.PUBLIC_staging.staging_brands b on ri.brand_code = b.brand_code
        where 
            r.scanned_timestamp is not null
            and b.brand_name is not null
            and date_trunc('month', r.scanned_timestamp) in (
                (select month_start from most_recent_month),
                (select prev_month_start from previous_month)
            )
        group by b.brand_name, date_trunc('month', r.scanned_timestamp)
    ),
    
    -- Rank brands within each month
    ranked_brands as (
        select
            brand_name,
            month_start,
            receipt_count,
            rank() over (
                partition by month_start 
                order by receipt_count desc
            ) as rank_in_month,
            case
                when month_start = (select month_start from most_recent_month) then 'Current'
                else 'Previous'
            end as month_type
        from monthly_data
    )

-- Final results with top 5 brands for each month
select
    brand_name,
    month_start,
    receipt_count,
    rank_in_month,
    month_type
from ranked_brands
where rank_in_month <= 5
order by
    case when month_type = 'Current' then 1 else 2 end,
    rank_in_month
        );
[0m23:14:22.452731 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.938 seconds
[0m23:14:22.478980 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '219b0d4b-fefb-4de1-944a-7e76f4d7b09f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1196d5460>]}
[0m23:14:22.479678 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.01s]
[0m23:14:22.480192 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:14:22.481215 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:14:22.481460 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:14:22.481689 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:14:22.580628 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m23:14:22.580972 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m23:14:22.678322 [info ] [MainThread]: 
[0m23:14:22.678732 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.75 seconds (2.75s).
[0m23:14:22.679233 [debug] [MainThread]: Command end result
[0m23:14:22.694831 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:14:22.696046 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:14:22.701145 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:14:22.701404 [info ] [MainThread]: 
[0m23:14:22.701650 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:14:22.701829 [info ] [MainThread]: 
[0m23:14:22.702018 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:14:22.703522 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8714254, "process_in_blocks": "0", "process_kernel_time": 0.542855, "process_mem_max_rss": "166035456", "process_out_blocks": "0", "process_user_time": 3.071876}
[0m23:14:22.703764 [debug] [MainThread]: Command `dbt run` succeeded at 23:14:22.703717 after 3.87 seconds
[0m23:14:22.703981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102918e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103613f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118edbe50>]}
[0m23:14:22.704194 [debug] [MainThread]: Flushing usage events
[0m23:14:22.921076 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:14:52.218187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105face20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107960fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107960c40>]}


============================== 23:14:52.221276 | 42e92af3-2d56-4937-a33d-f98b591b5acc ==============================
[0m23:14:52.221276 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:14:52.221640 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_brands_recent', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:14:52.703858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '42e92af3-2d56-4937-a33d-f98b591b5acc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792f250>]}
[0m23:14:52.735090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '42e92af3-2d56-4937-a33d-f98b591b5acc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d59b20>]}
[0m23:14:52.735618 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:14:52.858329 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:14:52.943352 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:14:52.943731 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m23:14:53.083372 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m23:14:53.092344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42e92af3-2d56-4937-a33d-f98b591b5acc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1275aaf40>]}
[0m23:14:53.142177 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:14:53.145396 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:14:53.159506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42e92af3-2d56-4937-a33d-f98b591b5acc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127596100>]}
[0m23:14:53.159822 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:14:53.160021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42e92af3-2d56-4937-a33d-f98b591b5acc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12741b3a0>]}
[0m23:14:53.160661 [info ] [MainThread]: 
[0m23:14:53.160861 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:14:53.161030 [info ] [MainThread]: 
[0m23:14:53.161322 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:14:53.161775 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:14:53.234444 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:14:53.234705 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:14:53.234869 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:14:54.183906 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.949 seconds
[0m23:14:54.196828 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m23:14:54.204024 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m23:14:54.213575 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:14:54.216596 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:14:54.217028 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:14:54.217399 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:14:54.218044 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:14:54.328364 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.111 seconds
[0m23:14:54.703410 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.485 seconds
[0m23:14:54.710025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42e92af3-2d56-4937-a33d-f98b591b5acc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1263eda30>]}
[0m23:14:54.714892 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:14:54.715841 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:14:54.716626 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m23:14:54.717159 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:14:54.732255 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:14:54.734513 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:14:54.766474 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:14:54.769488 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:14:54.769861 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Question: 
-- What are the top 5 brands by receipts scanned for most recent month?
-- How does the ranking of the top 5 brands by receipts scanned for the recent month
-- compare to the ranking for the previous month?



with
    monthly_data as (
        select
            b.brand_name,
            date_trunc('month', r.scanned_timestamp) as month_start,
            count(distinct r.receipt_id) as receipt_count
        from RAW.PUBLIC_staging.staging_receipts r
        join RAW.PUBLIC_staging.staging_receipt_items ri on r.receipt_id = ri.receipt_id
        join RAW.PUBLIC_staging.staging_brands b on ri.brand_code = b.brand_code
        where
            date_trunc('month', r.scanned_timestamp) <= dateadd('month', 0, date_trunc('month', current_date()))
            and date_trunc('month', r.scanned_timestamp) >= dateadd('month', -3, date_trunc('month', current_date()))
            and r.scanned_timestamp is not null
            and b.brand_name is not null
        group by b.brand_name, date_trunc('month', r.scanned_timestamp)
    ),
    ranked as (
        select
            brand_name,
            month_start,
            receipt_count,
            rank() over (
                partition by month_start order by receipt_count desc
            ) as rank_in_month
        from monthly_data
    )
select *
from ranked
order by month_start desc, rank_in_month
        );
[0m23:14:55.430668 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.660 seconds
[0m23:14:55.470115 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42e92af3-2d56-4937-a33d-f98b591b5acc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127db4400>]}
[0m23:14:55.470960 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 0.75s]
[0m23:14:55.471573 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:14:55.472762 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:14:55.473108 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:14:55.473425 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:14:55.588036 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m23:14:55.588770 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m23:14:55.677758 [info ] [MainThread]: 
[0m23:14:55.678862 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.52 seconds (2.52s).
[0m23:14:55.680507 [debug] [MainThread]: Command end result
[0m23:14:55.718469 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:14:55.720085 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:14:55.726568 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:14:55.726885 [info ] [MainThread]: 
[0m23:14:55.727271 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:14:55.727547 [info ] [MainThread]: 
[0m23:14:55.727843 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:14:55.730223 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5541294, "process_in_blocks": "0", "process_kernel_time": 0.607765, "process_mem_max_rss": "167804928", "process_out_blocks": "0", "process_user_time": 3.095988}
[0m23:14:55.730635 [debug] [MainThread]: Command `dbt run` succeeded at 23:14:55.730551 after 3.55 seconds
[0m23:14:55.730973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105face20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127596100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c5b610>]}
[0m23:14:55.731319 [debug] [MainThread]: Flushing usage events
[0m23:14:55.836658 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:18:49.133924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10384ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046fcfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046fcc40>]}


============================== 23:18:49.136923 | d4e14f5b-1f97-4ec5-8e7c-282662b585f9 ==============================
[0m23:18:49.136923 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:18:49.137304 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_brands_recent', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:18:49.757694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4e14f5b-1f97-4ec5-8e7c-282662b585f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046cb250>]}
[0m23:18:49.788797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4e14f5b-1f97-4ec5-8e7c-282662b585f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103bf9b20>]}
[0m23:18:49.789369 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:18:49.911104 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:18:49.996352 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:18:49.996724 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m23:18:50.135683 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m23:18:50.144829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd4e14f5b-1f97-4ec5-8e7c-282662b585f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a011fa0>]}
[0m23:18:50.196458 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:18:50.199663 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:18:50.212867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd4e14f5b-1f97-4ec5-8e7c-282662b585f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119e10a90>]}
[0m23:18:50.213200 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:18:50.213403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4e14f5b-1f97-4ec5-8e7c-282662b585f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104161220>]}
[0m23:18:50.214041 [info ] [MainThread]: 
[0m23:18:50.214269 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:18:50.214437 [info ] [MainThread]: 
[0m23:18:50.214726 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:18:50.215178 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:18:50.303766 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:18:50.304041 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:18:50.304215 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:18:51.157178 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.853 seconds
[0m23:18:51.168266 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m23:18:51.175931 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m23:18:51.192958 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:18:51.195173 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:18:51.195524 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:18:51.195858 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:18:51.196158 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:18:51.314889 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.118 seconds
[0m23:18:51.660592 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.464 seconds
[0m23:18:51.667180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4e14f5b-1f97-4ec5-8e7c-282662b585f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119fbf2b0>]}
[0m23:18:51.672307 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:18:51.673250 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:18:51.674016 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m23:18:51.674654 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:18:51.690643 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:18:51.693163 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:18:51.724731 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:18:51.729030 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:18:51.729425 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (-- BI Analyst Questions:
-- 1. Which brand has the most spend among users who were created within the past 6 months?
-- 2. Which brand has the most transactions among users who were created within the past 6 months?



with 
    -- Get users created within the past 6 months
    recent_users as (
        select
            user_id
        from RAW.PUBLIC_staging.staging_users
        where created_timestamp >= dateadd('month', -6, current_date())
    ),
    
    -- Join receipts with users and calculate spend per receipt
    recent_user_receipts as (
        select
            r.receipt_id,
            r.user_id,
            try_to_decimal(r.total_spent, 10, 2) as total_spent,
            r.scanned_timestamp
        from RAW.PUBLIC_staging.staging_receipts r
        inner join recent_users u on r.user_id = u.user_id
        where r.total_spent is not null
    ),
    
    -- Join with receipt items and brands
    receipt_items_with_brands as (
        select
            rur.receipt_id,
            rur.user_id,
            rur.total_spent,
            ri.barcode,
            ri.brand_code,
            b.brand_name,
            b.brand_id,
            b.category
        from recent_user_receipts rur
        inner join RAW.PUBLIC_staging.staging_receipt_items ri on rur.receipt_id = ri.receipt_id
        inner join RAW.PUBLIC_staging.staging_brands b on ri.brand_code = b.brand_code
        where ri.brand_code is not null and b.brand_name is not null
    ),
    
    -- Calculate total spend per brand
    brand_spend as (
        select
            brand_name,
            brand_id,
            category,
            sum(total_spent) as total_spend,
            count(distinct receipt_id) as transaction_count
        from receipt_items_with_brands
        group by brand_name, brand_id, category
    ),
    
    -- Rank brands by total spend
    top_spend_brands as (
        select
            brand_name,
            brand_id,
            category,
            total_spend,
            transaction_count,
            rank() over (order by total_spend desc) as spend_rank,
            rank() over (order by transaction_count desc) as transaction_rank
        from brand_spend
    )

-- Return top brands by spend and transaction count
select
    brand_name,
    brand_id,
    category,
    total_spend,
    transaction_count,
    spend_rank,
    transaction_rank,
    case 
        when spend_rank = 1 then 'Top Brand by Spend'
        when transaction_rank = 1 then 'Top Brand by Transactions'
        else null
    end as top_metric
from top_spend_brands
where spend_rank <= 5 or transaction_rank <= 5
order by 
    case when spend_rank = 1 then 0 
         when transaction_rank = 1 then 1
         else spend_rank + 1 end,
    spend_rank, 
    transaction_rank
        );
[0m23:18:52.391696 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 0.661 seconds
[0m23:18:52.428677 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4e14f5b-1f97-4ec5-8e7c-282662b585f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a5d13a0>]}
[0m23:18:52.429436 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 0.75s]
[0m23:18:52.430030 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:18:52.431110 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:18:52.431422 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:18:52.431713 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:18:52.525705 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m23:18:52.526363 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m23:18:52.630173 [info ] [MainThread]: 
[0m23:18:52.630982 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.42 seconds (2.42s).
[0m23:18:52.632193 [debug] [MainThread]: Command end result
[0m23:18:52.666404 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:18:52.668373 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:18:52.674768 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:18:52.675068 [info ] [MainThread]: 
[0m23:18:52.675437 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:18:52.675710 [info ] [MainThread]: 
[0m23:18:52.675989 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:18:52.678232 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5848815, "process_in_blocks": "0", "process_kernel_time": 0.488217, "process_mem_max_rss": "167034880", "process_out_blocks": "0", "process_user_time": 3.131866}
[0m23:18:52.678594 [debug] [MainThread]: Command `dbt run` succeeded at 23:18:52.678522 after 3.59 seconds
[0m23:18:52.678903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10384ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1198bc850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033cfeb0>]}
[0m23:18:52.679197 [debug] [MainThread]: Flushing usage events
[0m23:18:52.838122 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:20:52.638101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10729ce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10845f0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10845fcd0>]}


============================== 23:20:52.641236 | b170ee2d-2077-4540-9de9-e1fb0db85c34 ==============================
[0m23:20:52.641236 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:20:52.641606 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:20:53.143074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b170ee2d-2077-4540-9de9-e1fb0db85c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108422610>]}
[0m23:20:53.174257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b170ee2d-2077-4540-9de9-e1fb0db85c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084222e0>]}
[0m23:20:53.174810 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:20:53.297055 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:20:53.382849 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:20:53.383241 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m23:20:53.519808 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m23:20:53.528292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b170ee2d-2077-4540-9de9-e1fb0db85c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f8a9ee0>]}
[0m23:20:53.577939 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:20:53.580523 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:20:53.593670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b170ee2d-2077-4540-9de9-e1fb0db85c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f6a7370>]}
[0m23:20:53.594007 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:20:53.594205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b170ee2d-2077-4540-9de9-e1fb0db85c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071023d0>]}
[0m23:20:53.594841 [info ] [MainThread]: 
[0m23:20:53.595046 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:20:53.595219 [info ] [MainThread]: 
[0m23:20:53.595499 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:20:53.595937 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:20:53.673407 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:20:53.673659 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:20:53.673824 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:20:54.560364 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.886 seconds
[0m23:20:54.573209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m23:20:54.580851 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m23:20:54.598287 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:20:54.600588 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:20:54.600929 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:20:54.601261 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:20:54.601559 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:20:54.806672 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.205 seconds
[0m23:20:55.034076 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.432 seconds
[0m23:20:55.039830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b170ee2d-2077-4540-9de9-e1fb0db85c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f8575b0>]}
[0m23:20:55.045168 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:20:55.046108 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:20:55.046872 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_brands_recent)
[0m23:20:55.047474 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:20:55.070617 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:20:55.074584 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:20:55.200478 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:20:55.204086 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:20:55.204526 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (

with recent_users as (
    select 
        user_id,
        created_timestamp
    from RAW.PUBLIC_staging.staging_users
    where created_timestamp >= dateadd('month', -6, current_date())
    and created_timestamp is not null
),

valid_receipts as (
    select 
        r.receipt_id,
        r.user_id,
        -- Handle potential invalid numeric values
        try_cast(nullif(trim(r.total_spent), '') as decimal(18,2)) as total_spent,
        r.scanned_timestamp
    from RAW.PUBLIC_staging.staging_receipts r
    inner join recent_users ru 
        on r.user_id = ru.user_id
    where r.total_spent is not null
      and r.receipt_id is not null
),

brand_metrics as (
    select 
        b.brand_name,
        sum(vr.total_spent) as total_spend,
        count(distinct vr.receipt_id) as transaction_count
    from valid_receipts vr
    inner join RAW.PUBLIC_staging.staging_receipt_items ri 
        on vr.receipt_id = ri.receipt_id
    inner join RAW.PUBLIC_staging.staging_brands b 
        on ri.brand_code = b.brand_code
    where b.brand_name is not null
      and ri.brand_code is not null
    group by b.brand_name
    having sum(vr.total_spent) > 0  -- Filter out zero/negative spend
),

final_rankings as (
    select 
        brand_name,
        total_spend,
        transaction_count,
        rank() over (order by total_spend desc) as spend_rank,
        rank() over (order by transaction_count desc) as transaction_rank
    from brand_metrics
)

select
    brand_name,
    round(total_spend, 2) as total_spend,
    transaction_count,
    spend_rank,
    transaction_rank,
    case 
        when spend_rank = 1 then 'Highest Spend'
        when transaction_rank = 1 then 'Most Transactions'
        else null 
    end as achievement
from final_rankings
where spend_rank <= 5 or transaction_rank <= 5
order by 
    least(spend_rank, transaction_rank),
    total_spend desc
        );
[0m23:20:57.112358 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.907 seconds
[0m23:20:57.140932 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b170ee2d-2077-4540-9de9-e1fb0db85c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1332a9880>]}
[0m23:20:57.141550 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 2.09s]
[0m23:20:57.142077 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:20:57.143040 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:20:57.143348 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:20:57.143623 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:20:57.230746 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m23:20:57.231104 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m23:20:57.305751 [info ] [MainThread]: 
[0m23:20:57.306256 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.71 seconds (3.71s).
[0m23:20:57.307069 [debug] [MainThread]: Command end result
[0m23:20:57.335302 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:20:57.336605 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:20:57.342296 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:20:57.342563 [info ] [MainThread]: 
[0m23:20:57.342866 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:20:57.343092 [info ] [MainThread]: 
[0m23:20:57.343327 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:20:57.345198 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7490606, "process_in_blocks": "0", "process_kernel_time": 0.674291, "process_mem_max_rss": "169410560", "process_out_blocks": "0", "process_user_time": 2.992332}
[0m23:20:57.345498 [debug] [MainThread]: Command `dbt run` succeeded at 23:20:57.345438 after 4.75 seconds
[0m23:20:57.345761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10729ce80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107439be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f6a79a0>]}
[0m23:20:57.346032 [debug] [MainThread]: Flushing usage events
[0m23:20:57.569075 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:39:13.660704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054c8e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063770a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106377c70>]}


============================== 23:39:13.663800 | ce8e330e-d360-4af2-9498-e75dde5a1af8 ==============================
[0m23:39:13.663800 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:39:13.664166 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select fct_brands_recent', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:39:14.330566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce8e330e-d360-4af2-9498-e75dde5a1af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126b48d30>]}
[0m23:39:14.361722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce8e330e-d360-4af2-9498-e75dde5a1af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dd4b80>]}
[0m23:39:14.362238 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m23:39:14.482909 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:39:14.568264 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:39:14.568654 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_brands_recent.sql
[0m23:39:14.706967 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m23:39:14.715671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce8e330e-d360-4af2-9498-e75dde5a1af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1272e9fd0>]}
[0m23:39:14.768800 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:39:14.771736 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:39:14.787150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce8e330e-d360-4af2-9498-e75dde5a1af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126fcf160>]}
[0m23:39:14.787473 [info ] [MainThread]: Found 6 models, 3 sources, 472 macros
[0m23:39:14.787673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce8e330e-d360-4af2-9498-e75dde5a1af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1272265e0>]}
[0m23:39:14.788349 [info ] [MainThread]: 
[0m23:39:14.788563 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:39:14.788731 [info ] [MainThread]: 
[0m23:39:14.789010 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:39:14.789468 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m23:39:14.863473 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m23:39:14.863730 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m23:39:14.863898 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:39:16.147717 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.284 seconds
[0m23:39:16.160972 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m23:39:16.161966 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m23:39:16.177769 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m23:39:16.180621 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m23:39:16.181130 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m23:39:16.181520 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m23:39:16.182198 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:39:16.282341 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.100 seconds
[0m23:39:16.734921 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.553 seconds
[0m23:39:16.740978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce8e330e-d360-4af2-9498-e75dde5a1af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10462ddf0>]}
[0m23:39:16.743436 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_brands_recent
[0m23:39:16.743888 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_brands_recent .......................... [RUN]
[0m23:39:16.744325 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_brands_recent)
[0m23:39:16.744745 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_brands_recent
[0m23:39:16.754182 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_brands_recent"
[0m23:39:16.755677 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_brands_recent
[0m23:39:16.777585 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_brands_recent"
[0m23:39:16.779973 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_brands_recent"
[0m23:39:16.780305 [debug] [Thread-1  ]: On model.fetch_analytics.fct_brands_recent: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_brands_recent"} */
create or replace transient table RAW.PUBLIC.fct_brands_recent
         as
        (

select
    b.brand_id,
    b.brand_name,
    count(distinct r.receipt_id) as total_transactions,
    sum(r.total_spent) as total_spent
from RAW.PUBLIC_staging.staging_users u
inner join RAW.PUBLIC_staging.staging_receipts r
    on u.user_id = r.user_id
inner join RAW.PUBLIC_staging.staging_receipt_items ri
    on r.receipt_id = ri.receipt_id
inner join RAW.PUBLIC_staging.staging_brands b
    on ri.barcode = b.barcode
where 
    u.created_timestamp >= dateadd(month, -6, '2021-03-01 00:00:00.000')
    and b.brand_name is not null
group by 
    b.brand_id,
    b.brand_name
order by 
    total_spent desc,
    total_transactions desc
        );
[0m23:39:18.708188 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.926 seconds
[0m23:39:18.730169 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce8e330e-d360-4af2-9498-e75dde5a1af8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127ae2490>]}
[0m23:39:18.730908 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_brands_recent ..................... [[32mSUCCESS 1[0m in 1.98s]
[0m23:39:18.731329 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_brands_recent
[0m23:39:18.732671 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:39:18.732872 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_brands_recent' was left open.
[0m23:39:18.733066 [debug] [MainThread]: On model.fetch_analytics.fct_brands_recent: Close
[0m23:39:18.921554 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m23:39:18.924075 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m23:39:19.020338 [info ] [MainThread]: 
[0m23:39:19.020766 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.23 seconds (4.23s).
[0m23:39:19.021557 [debug] [MainThread]: Command end result
[0m23:39:19.045630 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m23:39:19.047623 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m23:39:19.052853 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m23:39:19.053096 [info ] [MainThread]: 
[0m23:39:19.053382 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:39:19.053578 [info ] [MainThread]: 
[0m23:39:19.053811 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:39:19.055867 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.438622, "process_in_blocks": "0", "process_kernel_time": 0.798956, "process_mem_max_rss": "167821312", "process_out_blocks": "0", "process_user_time": 2.946485}
[0m23:39:19.056207 [debug] [MainThread]: Command `dbt run` succeeded at 23:39:19.056157 after 5.44 seconds
[0m23:39:19.056498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054c8e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057ca2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126ba4880>]}
[0m23:39:19.056728 [debug] [MainThread]: Flushing usage events
[0m23:39:19.217025 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:47:51.435991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055d8e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064870a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106487c70>]}


============================== 10:47:51.439188 | 796b29bf-04e6-4135-9771-f0a78fb088af ==============================
[0m10:47:51.439188 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:47:51.439605 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_receipt_status', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:47:52.107866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '796b29bf-04e6-4135-9771-f0a78fb088af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c1c8d30>]}
[0m10:47:52.140326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '796b29bf-04e6-4135-9771-f0a78fb088af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ee3b80>]}
[0m10:47:52.141034 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m10:47:52.269801 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:47:52.362045 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m10:47:52.362433 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://models/reporting/fct_reciept_status.sql
[0m10:47:52.502589 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts.reporting
- models.fetch_analytics.marts
[0m10:47:52.511216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '796b29bf-04e6-4135-9771-f0a78fb088af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c84b130>]}
[0m10:47:52.561776 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:47:52.564718 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:47:52.578034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '796b29bf-04e6-4135-9771-f0a78fb088af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c83b1c0>]}
[0m10:47:52.578388 [info ] [MainThread]: Found 7 models, 3 sources, 472 macros
[0m10:47:52.578591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '796b29bf-04e6-4135-9771-f0a78fb088af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c68df10>]}
[0m10:47:52.578952 [warn ] [MainThread]: The selection criterion 'fct_receipt_status' does not match any enabled nodes
[0m10:47:52.579435 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:47:52.579730 [debug] [MainThread]: Command end result
[0m10:47:52.632147 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:47:52.633073 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:47:52.634941 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m10:47:52.636575 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.2487195, "process_in_blocks": "0", "process_kernel_time": 0.520212, "process_mem_max_rss": "156352512", "process_out_blocks": "0", "process_user_time": 2.935038}
[0m10:47:52.636825 [debug] [MainThread]: Command `dbt run` succeeded at 10:47:52.636775 after 1.25 seconds
[0m10:47:52.637047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055d8e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c662a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c662490>]}
[0m10:47:52.637268 [debug] [MainThread]: Flushing usage events
[0m10:47:52.870808 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:48:24.977175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103103eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fb3fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fb3c40>]}


============================== 10:48:24.980980 | 24869c5b-1034-4749-9e34-3d70c5d9e203 ==============================
[0m10:48:24.980980 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:48:24.981407 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select fct_reciept_status', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:48:25.674862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '24869c5b-1034-4749-9e34-3d70c5d9e203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1021da220>]}
[0m10:48:25.706696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '24869c5b-1034-4749-9e34-3d70c5d9e203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a1e070>]}
[0m10:48:25.707604 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m10:48:25.839729 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:48:25.925693 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:48:25.926085 [debug] [MainThread]: Partial parsing: updated file: fetch_analytics://models/reporting/fct_reciept_status.sql
[0m10:48:26.067947 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m10:48:26.077953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24869c5b-1034-4749-9e34-3d70c5d9e203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a2e5130>]}
[0m10:48:26.126282 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:48:26.128465 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:48:26.141542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24869c5b-1034-4749-9e34-3d70c5d9e203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128bf7280>]}
[0m10:48:26.141879 [info ] [MainThread]: Found 7 models, 3 sources, 472 macros
[0m10:48:26.142095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24869c5b-1034-4749-9e34-3d70c5d9e203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a2e5340>]}
[0m10:48:26.142779 [info ] [MainThread]: 
[0m10:48:26.142996 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:48:26.143167 [info ] [MainThread]: 
[0m10:48:26.143456 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:48:26.143943 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m10:48:26.216415 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m10:48:26.216696 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m10:48:26.216873 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:48:27.231064 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.014 seconds
[0m10:48:27.244829 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC_staging)
[0m10:48:27.245951 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC'
[0m10:48:27.261729 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m10:48:27.264893 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m10:48:27.265476 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m10:48:27.265859 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m10:48:27.266656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:48:27.384126 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.118 seconds
[0m10:48:27.759633 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.493 seconds
[0m10:48:27.764570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24869c5b-1034-4749-9e34-3d70c5d9e203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102268e50>]}
[0m10:48:27.766891 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_reciept_status
[0m10:48:27.767333 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_reciept_status ......................... [RUN]
[0m10:48:27.767830 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC_staging, now model.fetch_analytics.fct_reciept_status)
[0m10:48:27.768279 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_reciept_status
[0m10:48:27.780272 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_reciept_status"
[0m10:48:27.781066 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_reciept_status
[0m10:48:27.828274 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_reciept_status"
[0m10:48:27.831241 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_reciept_status"
[0m10:48:27.832099 [debug] [Thread-1  ]: On model.fetch_analytics.fct_reciept_status: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_reciept_status"} */
create or replace transient table RAW.PUBLIC.fct_reciept_status
         as
        (

with receipt_metrics as (
    select
        rewards_receipt_status,
        
        -- Handle potential parsing issues with total_spent
        try_cast(total_spent as decimal(18,2)) as parsed_total_spent,
        
        purchased_item_count
    from RAW.PUBLIC_staging.staging_receipts
    where 
        -- Filter for accepted/rejected receipts
        rewards_receipt_status in ('FINISHED', 'REJECTED')
        
        -- Ensure data quality
        and total_spent is not null
        and purchased_item_count is not null
)

select
    rewards_receipt_status,
    
    -- Average spend metrics
    avg(parsed_total_spent) as avg_total_spent,
    
    -- Count metrics
    sum(purchased_item_count) as total_items_purchased,
    count(*) as receipt_count,
    
    -- Derived metrics
    sum(parsed_total_spent) as total_spent,
    sum(parsed_total_spent) / sum(purchased_item_count) as avg_item_price
from receipt_metrics
group by rewards_receipt_status
order by rewards_receipt_status
        );
[0m10:48:29.738004 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.905 seconds
[0m10:48:29.779973 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24869c5b-1034-4749-9e34-3d70c5d9e203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9f78e0>]}
[0m10:48:29.781104 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_reciept_status .................... [[32mSUCCESS 1[0m in 2.01s]
[0m10:48:29.781802 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_reciept_status
[0m10:48:29.783569 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:48:29.783916 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_reciept_status' was left open.
[0m10:48:29.784195 [debug] [MainThread]: On model.fetch_analytics.fct_reciept_status: Close
[0m10:48:29.867650 [debug] [MainThread]: Connection 'list_RAW_PUBLIC' was left open.
[0m10:48:29.867985 [debug] [MainThread]: On list_RAW_PUBLIC: Close
[0m10:48:29.943286 [info ] [MainThread]: 
[0m10:48:29.944077 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.80 seconds (3.80s).
[0m10:48:29.945418 [debug] [MainThread]: Command end result
[0m10:48:29.966416 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:48:29.969759 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:48:29.975402 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m10:48:29.975680 [info ] [MainThread]: 
[0m10:48:29.975961 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:48:29.976145 [info ] [MainThread]: 
[0m10:48:29.976372 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:48:29.978436 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.051675, "process_in_blocks": "0", "process_kernel_time": 0.70297, "process_mem_max_rss": "163692544", "process_out_blocks": "0", "process_user_time": 3.137844}
[0m10:48:29.978784 [debug] [MainThread]: Command `dbt run` succeeded at 10:48:29.978729 after 5.05 seconds
[0m10:48:29.979127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103103eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102552df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12895f3a0>]}
[0m10:48:29.979419 [debug] [MainThread]: Flushing usage events
[0m10:48:30.068776 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:48:49.858459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103128e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fd70a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fd7c70>]}


============================== 10:48:49.861431 | ec661e6c-fbe9-47cb-9108-2661ecd86836 ==============================
[0m10:48:49.861431 [info ] [MainThread]: Running with dbt=1.9.3
[0m10:48:49.861790 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/abbiegalie/fetch-analytics-project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/abbiegalie/fetch-analytics-project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select fct_receipt_status', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:48:50.348363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ec661e6c-fbe9-47cb-9108-2661ecd86836', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123448d30>]}
[0m10:48:50.379558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ec661e6c-fbe9-47cb-9108-2661ecd86836', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a34b80>]}
[0m10:48:50.380395 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m10:48:50.502342 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m10:48:50.581777 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m10:48:50.582112 [debug] [MainThread]: Partial parsing: added file: fetch_analytics://models/reporting/fct_receipt_status.sql
[0m10:48:50.582286 [debug] [MainThread]: Partial parsing: deleted file: fetch_analytics://models/reporting/fct_reciept_status.sql
[0m10:48:50.717451 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.fetch_analytics.marts
- models.fetch_analytics.marts.reporting
[0m10:48:50.725983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec661e6c-fbe9-47cb-9108-2661ecd86836', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123be7130>]}
[0m10:48:50.776619 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:48:50.779452 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:48:50.791992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec661e6c-fbe9-47cb-9108-2661ecd86836', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12337c7c0>]}
[0m10:48:50.792348 [info ] [MainThread]: Found 7 models, 3 sources, 472 macros
[0m10:48:50.792553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec661e6c-fbe9-47cb-9108-2661ecd86836', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123baf460>]}
[0m10:48:50.793280 [info ] [MainThread]: 
[0m10:48:50.793523 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:48:50.793702 [info ] [MainThread]: 
[0m10:48:50.793992 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:48:50.794459 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW'
[0m10:48:50.867518 [debug] [ThreadPool]: Using snowflake connection "list_RAW"
[0m10:48:50.867777 [debug] [ThreadPool]: On list_RAW: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW"} */
show terse schemas in database RAW
    limit 10000
[0m10:48:50.867943 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:48:51.820898 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.953 seconds
[0m10:48:51.834436 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_RAW, now list_RAW_PUBLIC)
[0m10:48:51.844473 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_RAW_PUBLIC_staging'
[0m10:48:51.906521 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC_staging"
[0m10:48:51.907369 [debug] [ThreadPool]: Using snowflake connection "list_RAW_PUBLIC"
[0m10:48:51.910326 [debug] [ThreadPool]: On list_RAW_PUBLIC_staging: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC_staging"} */
show objects in RAW.PUBLIC_staging limit 10000;
[0m10:48:51.910833 [debug] [ThreadPool]: On list_RAW_PUBLIC: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_RAW_PUBLIC"} */
show objects in RAW.PUBLIC limit 10000;
[0m10:48:51.911749 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:48:52.014055 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.101 seconds
[0m10:48:52.220185 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.308 seconds
[0m10:48:52.224924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec661e6c-fbe9-47cb-9108-2661ecd86836', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123b89250>]}
[0m10:48:52.228205 [debug] [Thread-1  ]: Began running node model.fetch_analytics.fct_receipt_status
[0m10:48:52.228904 [info ] [Thread-1  ]: 1 of 1 START sql table model PUBLIC.fct_receipt_status ......................... [RUN]
[0m10:48:52.229514 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_RAW_PUBLIC, now model.fetch_analytics.fct_receipt_status)
[0m10:48:52.229900 [debug] [Thread-1  ]: Began compiling node model.fetch_analytics.fct_receipt_status
[0m10:48:52.240797 [debug] [Thread-1  ]: Writing injected SQL for node "model.fetch_analytics.fct_receipt_status"
[0m10:48:52.241821 [debug] [Thread-1  ]: Began executing node model.fetch_analytics.fct_receipt_status
[0m10:48:52.270032 [debug] [Thread-1  ]: Writing runtime sql for node "model.fetch_analytics.fct_receipt_status"
[0m10:48:52.272197 [debug] [Thread-1  ]: Using snowflake connection "model.fetch_analytics.fct_receipt_status"
[0m10:48:52.272933 [debug] [Thread-1  ]: On model.fetch_analytics.fct_receipt_status: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "default", "target_name": "dev", "node_id": "model.fetch_analytics.fct_receipt_status"} */
create or replace transient table RAW.PUBLIC.fct_receipt_status
         as
        (

with receipt_metrics as (
    select
        rewards_receipt_status,
        
        -- Handle potential parsing issues with total_spent
        try_cast(total_spent as decimal(18,2)) as parsed_total_spent,
        
        purchased_item_count
    from RAW.PUBLIC_staging.staging_receipts
    where 
        -- Filter for accepted/rejected receipts
        rewards_receipt_status in ('FINISHED', 'REJECTED')
        
        -- Ensure data quality
        and total_spent is not null
        and purchased_item_count is not null
)

select
    rewards_receipt_status,
    
    -- Average spend metrics
    avg(parsed_total_spent) as avg_total_spent,
    
    -- Count metrics
    sum(purchased_item_count) as total_items_purchased,
    count(*) as receipt_count,
    
    -- Derived metrics
    sum(parsed_total_spent) as total_spent,
    sum(parsed_total_spent) / sum(purchased_item_count) as avg_item_price
from receipt_metrics
group by rewards_receipt_status
order by rewards_receipt_status
        );
[0m10:48:53.454793 [debug] [Thread-1  ]: SQL status: SUCCESS 1 in 1.180 seconds
[0m10:48:53.485209 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec661e6c-fbe9-47cb-9108-2661ecd86836', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1242f9670>]}
[0m10:48:53.487477 [info ] [Thread-1  ]: 1 of 1 OK created sql table model PUBLIC.fct_receipt_status .................... [[32mSUCCESS 1[0m in 1.25s]
[0m10:48:53.489719 [debug] [Thread-1  ]: Finished running node model.fetch_analytics.fct_receipt_status
[0m10:48:53.496434 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:48:53.497000 [debug] [MainThread]: Connection 'model.fetch_analytics.fct_receipt_status' was left open.
[0m10:48:53.497223 [debug] [MainThread]: On model.fetch_analytics.fct_receipt_status: Close
[0m10:48:53.589528 [debug] [MainThread]: Connection 'list_RAW_PUBLIC_staging' was left open.
[0m10:48:53.589911 [debug] [MainThread]: On list_RAW_PUBLIC_staging: Close
[0m10:48:53.683294 [info ] [MainThread]: 
[0m10:48:53.684106 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.89 seconds (2.89s).
[0m10:48:53.685464 [debug] [MainThread]: Command end result
[0m10:48:53.707925 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/abbiegalie/fetch-analytics-project/target/manifest.json
[0m10:48:53.709978 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/abbiegalie/fetch-analytics-project/target/semantic_manifest.json
[0m10:48:53.715659 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/abbiegalie/fetch-analytics-project/target/run_results.json
[0m10:48:53.715980 [info ] [MainThread]: 
[0m10:48:53.716346 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:48:53.716615 [info ] [MainThread]: 
[0m10:48:53.716874 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:48:53.719375 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.906215, "process_in_blocks": "0", "process_kernel_time": 0.712014, "process_mem_max_rss": "165101568", "process_out_blocks": "0", "process_user_time": 2.837457}
[0m10:48:53.719878 [debug] [MainThread]: Command `dbt run` succeeded at 10:48:53.719811 after 3.91 seconds
[0m10:48:53.720267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103128e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12337c7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032cf3d0>]}
[0m10:48:53.720590 [debug] [MainThread]: Flushing usage events
[0m10:48:53.795508 [debug] [MainThread]: An error was encountered while trying to flush usage events
